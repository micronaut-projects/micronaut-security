<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut Security</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#whatsNew"><strong>3</strong><span>What's New</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#breaks"><strong>4</strong><span>Breaking Changes</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#security-installation"><strong>5</strong><span>Installation</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#securityFilter"><strong>6</strong><span>How It Works - Security Filter</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#exceptionHandlers"><strong>7</strong><span>Exception Handlers</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#endpoints"><strong>8</strong><span>Endpoints</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#securityConfiguration"><strong>9</strong><span>Security Configuration</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#authenticationProviders"><strong>10</strong><span>Reactive Authentication Providers</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#authenticationStrategies"><strong>11</strong><span>Authorization Strategies</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#rejection"><strong>12</strong><span>Rejection Handling</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#tokenPropagation"><strong>13</strong><span>Token Propagation</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#tokenendpoints"><strong>14</strong><span>Built-In Security Token Controllers</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#retrievingAuthenticatedUser"><strong>15</strong><span>Retrieve the authenticated user</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#dataAuditing"><strong>16</strong><span>Data Change Auditing</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#securityEvents"><strong>17</strong><span>Security Events</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#oauth"><strong>18</strong><span>OAuth 2.0</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#aot"><strong>19</strong><span>Ahead-of-time optimizations</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>20</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-whatsNew"><a href="#whatsNew"><strong>3</strong><span>What's New</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-breaks"><a href="#breaks"><strong>4</strong><span>Breaking Changes</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-security-installation"><a href="#security-installation"><strong>5</strong><span>Installation</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-securityFilter"><a href="#securityFilter"><strong>6</strong><span>How It Works - Security Filter</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-builtInAuthenticationFetchers"><a href="#builtInAuthenticationFetchers"><strong>6.1</strong><span>Built-In Authentication Fetchers</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-basicAuthAuthenticationFetcher"><a href="#basicAuthAuthenticationFetcher"><strong>6.1.1</strong><span>Basic-Auth Authentication Fetcher</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-tokenAuthenticationFetcher"><a href="#tokenAuthenticationFetcher"><strong>6.1.2</strong><span>Token Authentication Fetcher</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-tokenReaders"><a href="#tokenReaders"><strong>6.1.2.1</strong><span>Token Readers</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-bearerTokenReader"><a href="#bearerTokenReader"><strong>6.1.2.1.1</strong><span>Bearer Token Reader</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-cookieTokenReader"><a href="#cookieTokenReader"><strong>6.1.2.1.2</strong><span>Cookie Token Reader</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-securityRule"><a href="#securityRule"><strong>6.2</strong><span>Security Rules</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-ipPattern"><a href="#ipPattern"><strong>6.2.1</strong><span>IP Pattern Rule</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-secured"><a href="#secured"><strong>6.2.2</strong><span>Secured Annotation</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-jakartaAnnotations"><a href="#jakartaAnnotations"><strong>6.2.2.1</strong><span>Jakarta Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-securedExpression"><a href="#securedExpression"><strong>6.2.2.2</strong><span>Secured with expressions</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-interceptUrlMap"><a href="#interceptUrlMap"><strong>6.2.3</strong><span>Intercept URL Map</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-builtInEndpointsAccess"><a href="#builtInEndpointsAccess"><strong>6.2.4</strong><span>Built-In Endpoints Security</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-exceptionHandlers"><a href="#exceptionHandlers"><strong>7</strong><span>Exception Handlers</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-endpoints"><a href="#endpoints"><strong>8</strong><span>Endpoints</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-login"><a href="#login"><strong>8.1</strong><span>Login Controller</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-loginHandler"><a href="#loginHandler"><strong>8.1.1</strong><span>Login Handler</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-logout"><a href="#logout"><strong>8.2</strong><span>Logout Controller</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-logoutHandler"><a href="#logoutHandler"><strong>8.2.1</strong><span>Logout Handler</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-builtInHandlers"><a href="#builtInHandlers"><strong>8.3</strong><span>Built-in Login and Logout Handlers</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-securityConfiguration"><a href="#securityConfiguration"><strong>9</strong><span>Security Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-rejectNotFound"><a href="#rejectNotFound"><strong>9.1</strong><span>Reject Not Found Routes</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-authenticationStrategy"><a href="#authenticationStrategy"><strong>9.2</strong><span>Authentication Strategy</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-noRedirection"><a href="#noRedirection"><strong>9.3</strong><span>Handlers without redirection</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-redirection"><a href="#redirection"><strong>9.4</strong><span>Redirection Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-authenticationProviders"><a href="#authenticationProviders"><strong>10</strong><span>Reactive Authentication Providers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-imperativeAuthenticationProviders"><a href="#imperativeAuthenticationProviders"><strong>10.1</strong><span>Authentication Provider</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-authenticationProvidersUseCases"><a href="#authenticationProvidersUseCases"><strong>10.2</strong><span>Authentication Providers Use Cases</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-builtInAuthenticationProviders"><a href="#builtInAuthenticationProviders"><strong>10.3</strong><span>Built-In Authentication Providers</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-authenticationStrategies"><a href="#authenticationStrategies"><strong>11</strong><span>Authorization Strategies</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-basicAuth"><a href="#basicAuth"><strong>11.1</strong><span>Basic Authentication</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-session"><a href="#session"><strong>11.2</strong><span>Session Authorization</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jwt"><a href="#jwt"><strong>11.3</strong><span>JSON Web Token</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-reader"><a href="#reader"><strong>11.3.1</strong><span>Reading JWT Token</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-bearerToken"><a href="#bearerToken"><strong>11.3.1.1</strong><span>Bearer Token Reader</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-cookieToken"><a href="#cookieToken"><strong>11.3.1.2</strong><span>Cookie Token Reader</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jwtParser"><a href="#jwtParser"><strong>11.3.2</strong><span>JWT Parser</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jwtValidation"><a href="#jwtValidation"><strong>11.3.3</strong><span>JWT Signature Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-jwks"><a href="#jwks"><strong>11.3.3.1</strong><span>Remote JWKS</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-staticJwks"><a href="#staticJwks"><strong>11.3.3.1.1</strong><span>Local JWKS</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jsonWebTokenValidator"><a href="#jsonWebTokenValidator"><strong>11.3.4</strong><span>JWT Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jwtGenerator"><a href="#jwtGenerator"><strong>11.3.5</strong><span>JWT Token Generation</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-jwtGeneratorSignature"><a href="#jwtGeneratorSignature"><strong>11.3.5.1</strong><span>Signed JWT Generation</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-jwtGeneratorSecret"><a href="#jwtGeneratorSecret"><strong>11.3.5.2</strong><span>Example of JWT Signed with Secret</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-jwtGeneratorRSA"><a href="#jwtGeneratorRSA"><strong>11.3.5.3</strong><span>Example of JWT Signed with RSA</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jwtEncryption"><a href="#jwtEncryption"><strong>11.3.6</strong><span>JWT Encryption</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-jwtGeneratorEncryption"><a href="#jwtGeneratorEncryption"><strong>11.3.6.1</strong><span>Example of JWT Signed with Secret and Encrypted with RSA</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-claimsGeneration"><a href="#claimsGeneration"><strong>11.3.7</strong><span>Claims Generation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-claimsValidation"><a href="#claimsValidation"><strong>11.3.8</strong><span>Claims Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-render"><a href="#render"><strong>11.3.9</strong><span>Token Render</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-jwtGuides"><a href="#jwtGuides"><strong>11.3.10</strong><span>Guides</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-ldap"><a href="#ldap"><strong>11.4</strong><span>LDAP Authentication</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-configuration"><a href="#configuration"><strong>11.4.1</strong><span>Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-extending"><a href="#extending"><strong>11.4.2</strong><span>Extending Default Behavior</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-x509"><a href="#x509"><strong>11.5</strong><span>X.509 Certificate Authentication</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-custom"><a href="#custom"><strong>11.6</strong><span>Custom Authorization Strategies</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-rejection"><a href="#rejection"><strong>12</strong><span>Rejection Handling</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-tokenPropagation"><a href="#tokenPropagation"><strong>13</strong><span>Token Propagation</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-tokenendpoints"><a href="#tokenendpoints"><strong>14</strong><span>Built-In Security Token Controllers</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-refresh"><a href="#refresh"><strong>14.1</strong><span>Refresh Controller</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-keys"><a href="#keys"><strong>14.2</strong><span>Keys Controller</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-introspectionendpoint"><a href="#introspectionendpoint"><strong>14.3</strong><span>Introspection Endpoint</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-retrievingAuthenticatedUser"><a href="#retrievingAuthenticatedUser"><strong>15</strong><span>Retrieve the authenticated user</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-customAuthenticatedUser"><a href="#customAuthenticatedUser"><strong>15.1</strong><span>Custom Binding</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-securityService"><a href="#securityService"><strong>15.2</strong><span>User outside of a controller</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-dataAuditing"><a href="#dataAuditing"><strong>16</strong><span>Data Change Auditing</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-annotations"><a href="#annotations"><strong>16.1</strong><span>Auditing Annotations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-identityMapping"><a href="#identityMapping"><strong>16.2</strong><span>Custom Authentication Mapping</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-securityEvents"><a href="#securityEvents"><strong>17</strong><span>Security Events</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-oauth"><a href="#oauth"><strong>18</strong><span>OAuth 2.0</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-installation"><a href="#installation"><strong>18.1</strong><span>Installation</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-openid"><a href="#openid"><strong>18.2</strong><span>OpenID Connect</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-flows"><a href="#flows"><strong>18.3</strong><span>Flows</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-authorization-code"><a href="#authorization-code"><strong>18.3.1</strong><span>Authorization Code</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-oauth2-authorization-code"><a href="#oauth2-authorization-code"><strong>18.3.1.1</strong><span>OAuth 2.0</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-oauth2-configuration"><a href="#oauth2-configuration"><strong>18.3.1.1.1</strong><span>Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-oauth2-user-details"><a href="#oauth2-user-details"><strong>18.3.1.1.2</strong><span>User Details Mapper</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-openid-authorization-code"><a href="#openid-authorization-code"><strong>18.3.1.2</strong><span>OpenID Connect</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-openid-configuration"><a href="#openid-configuration"><strong>18.3.1.2.1</strong><span>Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-openid-user-details"><a href="#openid-user-details"><strong>18.3.1.2.2</strong><span>OAuth 2.0 Authentication Mapper</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-openid-auth-parameters"><a href="#openid-auth-parameters"><strong>18.3.1.2.3</strong><span>Parameters</span></a></div>
        
        <div class="toc-item" style="margin-left:50px" id="toc-item-nonce"><a href="#nonce"><strong>18.3.1.2.3.1</strong><span>Nonce</span></a></div>
        
        <div class="toc-item" style="margin-left:50px" id="toc-item-login-hint"><a href="#login-hint"><strong>18.3.1.2.3.2</strong><span>Login Hint</span></a></div>
        
        <div class="toc-item" style="margin-left:50px" id="toc-item-id-token-hint"><a href="#id-token-hint"><strong>18.3.1.2.3.3</strong><span>ID Token Hint</span></a></div>
        
        <div class="toc-item" style="margin-left:40px" id="toc-item-token-validation"><a href="#token-validation"><strong>18.3.1.2.4</strong><span>Token Validation</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-state"><a href="#state"><strong>18.3.1.3</strong><span>State Parameter</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-pkce"><a href="#pkce"><strong>18.3.1.4</strong><span>PKCE</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-clientcredentials"><a href="#clientcredentials"><strong>18.3.2</strong><span>Client Credentials</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-clientecredentialshttpclient"><a href="#clientecredentialshttpclient"><strong>18.3.2.1</strong><span>HTTP Client Filter for Client Credentials</span></a></div>
        
        <div class="toc-item" style="margin-left:30px" id="toc-item-clientCredentialGuides"><a href="#clientCredentialGuides"><strong>18.3.2.2</strong><span>Guides</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-password"><a href="#password"><strong>18.3.3</strong><span>Password</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-oauth-endpoints"><a href="#oauth-endpoints"><strong>18.4</strong><span>Endpoints</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-endsession"><a href="#endsession"><strong>18.4.1</strong><span>OpenID End Session</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-introspection"><a href="#introspection"><strong>18.4.2</strong><span>Introspection</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-revocation"><a href="#revocation"><strong>18.4.3</strong><span>Revocation</span></a></div>
        
        <div class="toc-item" style="margin-left:20px" id="toc-item-user-info"><a href="#user-info"><strong>18.4.4</strong><span>OpenID User Info</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-custom-client"><a href="#custom-client"><strong>18.5</strong><span>Custom Clients</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-oauthGuides"><a href="#oauthGuides"><strong>18.6</strong><span>Guides</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-aot"><a href="#aot"><strong>19</strong><span>Ahead-of-time optimizations</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-aotConfiguration"><a href="#aotConfiguration"><strong>19.1</strong><span>Micronaut Security AOT Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-aotOpenidConfiguration"><a href="#aotOpenidConfiguration"><strong>19.2</strong><span>OpenID Configuration Optimization</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-aotJwks"><a href="#aotJwks"><strong>19.3</strong><span>JWKS Optimization</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>20</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut Security</h1>
        <p></p>
        <p>Official Security Solution for Micronaut</p>
        <p><strong>Version:</strong> 4.10.2 </p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Security is a fully featured and customizable security solution for your applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut Security 3.x requires Micronaut 3.x.
</td>
</tr>
</table>
</div>

<h1 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>2 Release History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this project, you can find a list of releases (with release notes) here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-security/releases">https://github.com/micronaut-projects/micronaut-security/releases</a></p>
</div>

<h1 id="whatsNew"><a class="anchor" href="#whatsNew"></a>3 What's New</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/whatsNew.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Security includes the following new features and improvements.</p>
</div>
<div class="sect1">
<h2 id="_whats_new_in_micronaut_security_3">What&#8217;s New in Micronaut Security 3</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Improvements to many APIs</p>
</li>
<li>
<p>Consolidated authentication state into a single interface</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a> API is now reactive</p>
</li>
<li>
<p>A <code>getRoles</code> method was added to <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a></p>
</li>
<li>
<p>New static methods on <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> and <a href="../api/io/micronaut/security/authentication/AuthenticationResponse.html">AuthenticationResponse</a> have been added to help create authentication related objects</p>
</li>
</ul>
</div>
</div>
</div>

<h1 id="breaks"><a class="anchor" href="#breaks"></a>4 Breaking Changes</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/breaks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section will document breaking changes that may happen during milestone or release candidate releases, as well as major releases eg (1.x.x &#8594; 2.x.x).</p>
</div>
<div class="sect1">
<h2 id="_micronaut_security_4_0_breaking_changes">Micronaut Security 4.0 breaking changes</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a> <code>check</code> method no longer contains the argument <code>RouteMatch</code>. You can easily retrieve a <code>RouteMatch</code>
with the <code>HttpRequest</code> method argument with <code>request.getAttribute(HttpAttributes.ROUTE_MATCH).orElse(null)</code>.</p>
</li>
<li>
<p>For applications with <code>micronaut.security.authentication</code> set to <code>cookie</code> and <code>micronaut.security.redirect.enabled</code> set to <code>false</code>, the server responds with 401 HTTP Status code instead of 200 for login failed attempts.</p>
</li>
<li>
<p><code>micronaut.security.intercept-url-map-prepend-pattern-with-context-path</code> defaults to <code>true</code>. Thus intercept url patterns are be prepended with the server context path if it is set.</p>
</li>
<li>
<p>Micronaut Security APIs have been decoupled from HTTP. Many APIs now have generics instead of HTTP-related types such as <code>HttpRequest</code>.
For example,  instead of <code>AuthenticationProvider</code>, you should use <code>AuthenticationProvider&lt;HttpRequest&lt;?&gt;&gt;</code>.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuration_changes">Configuration Changes</h3>
<div class="paragraph">
<p>Some configuration keys have changed.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old</th>
<th class="tableblock halign-left valign-top">New</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.generator.access-token.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.generator.access-token.expiration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.enabled</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.cookie-max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-max-age</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.cookie-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-path</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.cookie-domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-domain</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.cookie.cookie-same-site</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-same-site</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.bearer.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.enabled</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_classes_relocated">Classes relocated</h3>
<div class="paragraph">
<p>Some classes have been renamed and moved from <code>io.micronaut.security:micronaut-security-jwt</code> to <code>io.micronaut.security:micronaut.security</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old Pkg</th>
<th class="tableblock halign-left valign-top">New Pkg</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.endpoints.TokenRefreshRequest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.endpoints.TokenRefreshRequest</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.render.AccessRefreshToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.render.AccessRefreshToken</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.render.BearerAccessRefreshToken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.render.BearerAccessRefreshToken</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.endpoints.OauthController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.endpoints.OauthController</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.endpoints.OauthControllerConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.endpoints.OauthControllerConfiguration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.endpoints.OauthControllerConfigurationProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.endpoints.OauthControllerConfigurationProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.DefaultAccessRefreshTokenGenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.generator.DefaultAccessRefreshTokenGenerator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.AccessTokenCookieConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.AccessTokenCookieConfiguration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.CookieLoginHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.CookieLoginHandler</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.bearer.AccessRefreshTokenLoginHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.bearer.AccessRefreshTokenLoginHandler</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.bearer.BearerTokenConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.bearer.BearerTokenConfiguration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.bearer.BearerTokenConfigurationProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.bearer.BearerTokenConfigurationProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.bearer.BearerTokenReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.bearer.BearerTokenReader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.render.TokenRenderer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.render.TokenRenderer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.render.BearerTokenRenderer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.render.BearerTokenRenderer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.JwtCookieTokenReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.CookieTokenReader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.RefreshTokenCookieConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.RefreshTokenCookieConfiguration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.RefreshTokenCookieConfigurationProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.RefreshTokenCookieConfigurationProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.JwtCookieClearerLogoutHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.TokenCookieClearerLogoutHandler</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.JwtCookieLoginHandler</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.TokenCookieLoginHandler</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.JwtCookieTokenReader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.TokenCookieTokenReader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.AccessRefreshTokenGenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.generator.AccessRefreshTokenGenerator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.AccessTokenConfiguration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.generator.AccessTokenConfiguration</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.AccessTokenConfigurationProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.generator.AccessTokenConfigurationProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.claims.ClaimsGenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.claims.ClaimsGenerator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.claims.ClaimsAudienceProvider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.claims.ClaimsAudienceProvider</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.AbstractAccessTokenCookieConfigurationProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.AbstractAccessTokenCookieConfigurationProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.cookie.JwtCookieConfigurationProperties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.cookie.TokenCookieConfigurationProperties</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.claims.JwtIdGenerator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.claims.JtiGenerator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.jwt.generator.claims.JwtClaims</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>io.micronaut.security.token.Claims</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_annotation_mappers_removed">Annotation Mappers Removed</h3>
<div class="paragraph">
<p>The mappers for <code>javax.annotation.security</code> annotations – <code>DenyAll</code>, <code>PermitAll</code>, <code>RolesAllowed</code> – have been removed. Use the Jakarta versions for <code>jakarta.annotation.security</code> annotations instead.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Removed</th>
<th class="tableblock halign-left valign-top">Retained</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.annotation.DenyAllAnnotationMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.annotation.JakartaDenyAllAnnotationMapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.annotation.PermitAllAnnotationMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.annotation.JakartaPermitAllAnnotationMapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.annotation.RolesAllowedAnnotationMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.annotation.JakartaRolesAllowedAnnotationMapper</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_reactive_openidauthenticationmapper">Reactive OpenIdAuthenticationMapper</h3>
<div class="paragraph">
<p>The return type of the <code>OpenIdAuthenticationMapper.createAuthenticationResponse</code> has changed to return a <code>Publisher</code> to be consistent with the <code>OauthAuthenticationMapper</code> interface. Because the method now returns a Publisher, blocking operations can be offloaded to another thread pool using the reactive streams implementation of your choice.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_micronaut_security_3_4_breaking_changes">Micronaut Security 3.4 breaking changes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sensitive endpoints will now respond with an error unless a replacement for the <a href="../api/io/micronaut/security/rules/SensitiveEndpointRule.html">SensitiveEndpointRule</a> is bound.</p>
</div>
<div class="paragraph">
<p>The following code snippet illustrates how to restore the previous functionality:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The previous functionality allows any authenticated user, no matter their role to view sensitive endpoints.
</td>
</tr>
</table>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Replaces;
import io.micronaut.context.annotation.Requires;
import io.micronaut.core.annotation.NonNull;
import io.micronaut.http.HttpRequest;
import io.micronaut.inject.ExecutableMethod;
import io.micronaut.management.endpoint.EndpointSensitivityProcessor;
import io.micronaut.security.authentication.Authentication;
import io.micronaut.security.rules.SecurityRuleResult;
import io.micronaut.security.rules.SensitiveEndpointRule;
import jakarta.inject.Singleton;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;

@Singleton
@Replaces(SensitiveEndpointRule.class)
class SensitiveEndpointRuleReplacement extends SensitiveEndpointRule {
    SensitiveEndpointRuleReplacement(EndpointSensitivityProcessor endpointSensitivityProcessor) {
        super(endpointSensitivityProcessor);
    }

    @Override
    @NonNull
    protected Publisher&lt;SecurityRuleResult&gt; checkSensitiveAuthenticated(@NonNull HttpRequest&lt;?&gt; request,
                                                                        @NonNull Authentication authentication,
                                                                        @NonNull ExecutableMethod&lt;?, ?&gt; method) {
        return Mono.just(SecurityRuleResult.ALLOWED);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Replaces
import io.micronaut.context.annotation.Requires
import io.micronaut.core.annotation.NonNull
import io.micronaut.http.HttpRequest
import io.micronaut.inject.ExecutableMethod
import io.micronaut.management.endpoint.EndpointSensitivityProcessor
import io.micronaut.security.authentication.Authentication
import io.micronaut.security.rules.SecurityRuleResult
import io.micronaut.security.rules.SensitiveEndpointRule
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono

@Singleton
@Replaces(SensitiveEndpointRule.class)
class SensitiveEndpointRuleReplacement extends SensitiveEndpointRule {
    SensitiveEndpointRuleReplacement(EndpointSensitivityProcessor endpointSensitivityProcessor) {
        super(endpointSensitivityProcessor);
    }

    @Override
    @NonNull
    protected Publisher&lt;SecurityRuleResult&gt; checkSensitiveAuthenticated(@NonNull HttpRequest&lt;?&gt; request,
                                                                        @NonNull Authentication authentication,
                                                                        @NonNull ExecutableMethod&lt;?, ?&gt; method) {
        return Mono.just(SecurityRuleResult.ALLOWED);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Replaces
import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpRequest
import io.micronaut.inject.ExecutableMethod
import io.micronaut.management.endpoint.EndpointSensitivityProcessor
import io.micronaut.security.authentication.Authentication
import io.micronaut.security.rules.SecurityRuleResult
import io.micronaut.security.rules.SensitiveEndpointRule
import io.micronaut.security.token.RolesFinder
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono

@Replaces(SensitiveEndpointRule::class)
@Singleton
class SensitiveEndpointRuleReplacement(endpointSensitivityProcessor: EndpointSensitivityProcessor) : SensitiveEndpointRule(endpointSensitivityProcessor) {
    override fun checkSensitiveAuthenticated(
        request: HttpRequest&lt;*&gt;,
        authentication: Authentication,
        method: ExecutableMethod&lt;*, *&gt;
    ): Publisher&lt;SecurityRuleResult&gt; = Mono.just(SecurityRuleResult.ALLOWED)
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_micronaut_security_3_1_breaking_changes">Micronaut Security 3.1 breaking changes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micronaut security no longer exposes <code>micronaut-management</code> dependency.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_micronaut_security_3_0_breaking_changes">Micronaut Security 3.0 breaking changes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_user_details_removal">User Details Removal</h3>
<div class="paragraph">
<p>The <code>UserDetails</code> class has been removed and all usages should be replaced with <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>.</p>
</div>
<div class="sect3">
<h4 id="_affected_apis">Affected APIs</h4>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/security/authentication/AuthenticationFailed.html">AuthenticationFailed</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/authentication/AuthenticationResponse.html">AuthenticationResponse</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/rules/AbstractSecurityRule.html">AbstractSecurityRule</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/rules/SensitiveEndpointRule.html">SensitiveEndpointRule</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/event/RefreshTokenGeneratedEvent.html">RefreshTokenGeneratedEvent</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/generator/RefreshTokenGenerator.html">RefreshTokenGenerator</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/generator/TokenGenerator.html">TokenGenerator</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/jwt/cookie/CookieLoginHandler.html">CookieLoginHandler</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/jwt/generator/AccessRefreshTokenGenerator.html">AccessRefreshTokenGenerator</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/jwt/generator/claims/ClaimsGenerator.html">ClaimsGenerator</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/jwt/render/TokenRenderer.html">TokenRenderer</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/security/token/refresh/RefreshTokenPersistence.html">RefreshTokenPersistence</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_classes_renamed">Classes Renamed</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Old</th>
<th class="tableblock halign-left valign-top">New</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.oauth2.endpoint.token.response.OauthUserDetailsMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.oauth2.endpoint.token.response.OauthAuthenticationMapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.oauth2.endpoint.token.response.OpenIdUserDetailsMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.oauth2.endpoint.token.response.DefaultOpenIdUserDetailsMapper</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">io.micronaut.security.oauth2.endpoint.token.response.DefaultOpenIdAuthenticationMapper</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_other_changes">Other Changes</h4>
<div class="ulist">
<ul>
<li>
<p>The <a href="../api/io/micronaut/security/event/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a> that gets emitted when a user logs in will now be created with an instance of <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>.</p>
</li>
<li>
<p>The <code>AuthenticationUserDetailsAdapter</code> class has been deleted.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_securityrule_changes">SecurityRule Changes</h3>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a> API has changed. The last argument to the method was a map that represented the user attributes. Instead that argument was replaced with a reference to the <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>. This has the benefit of rules now having access to the username of the logged in user as well as access to the convenience method <code>getRoles()</code>.</p>
</div>
<div class="paragraph">
<p>In addition, the return type of the method has changed to return a <code>Publisher</code>. This was necessary because the security rules execute as part of the security filter which may be on a non blocking thread. Because the method now returns a <code>Publisher</code>, blocking operations can be offloaded to another thread pool using the reactive streams implementation of your choice.</p>
</div>
<div class="paragraph">
<p>Micronaut 2 API:</p>
</div>
<div class="paragraph">
<p><code>SecurityRuleResult check(HttpRequest&lt;?&gt; request, @Nullable RouteMatch&lt;?&gt; routeMatch, @Nullable Map&lt;String, Object&gt; claims);</code></p>
</div>
<div class="paragraph">
<p>Micronaut 3 API:</p>
</div>
<div class="paragraph">
<p><code>Publisher&lt;SecurityRuleResult&gt; check(HttpRequest&lt;?&gt; request, @Nullable RouteMatch&lt;?&gt; routeMatch, @Nullable Authentication authentication);</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_package_change">LDAP Package Change</h3>
<div class="paragraph">
<p>All classes in the <code>io.micronaut.configuration.security.ldap</code> have been moved to the <code>io.micronaut.security.ldap</code> package.</p>
</div>
</div>
<div class="sect2">
<h3 id="_securityfilter">SecurityFilter</h3>
<div class="paragraph">
<p>The security filter no longer extends deprecated <code>OncePerRequestHttpServerFilter</code> because it has been deprecated in Micronaut 3.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cookie_secure_configuration">Cookie Secure Configuration</h3>
<div class="paragraph">
<p>The following properties' default value has been removed in Micronaut Security 3.0.0:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-secure</code></p>
</li>
<li>
<p><code>micronaut.security.oauth2.state.cookie.cookie-secure</code></p>
</li>
<li>
<p><code>micronaut.security.token.jwt.cookie.cookie-secure</code></p>
</li>
<li>
<p><code>micronaut.security.token.refresh.cookie.cookie-secure`</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the <code>cookie-secure</code> setting is not set, cookies will be secure if the request is determined to be HTTPS.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_deprecations_removal">Deprecations Removal</h3>
<div class="paragraph">
<p>Most if not all deprecated classes constructors, and methods have been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_other_changes_2">Other Changes</h3>
<div class="ulist">
<ul>
<li>
<p>The constructor of <a href="../api/io/micronaut/security/token/jwt/validator/DefaultJwtAuthenticationFactory.html">DefaultJwtAuthenticationFactory</a> has changed</p>
</li>
<li>
<p>The constructor of <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/IdTokenLoginHandler.html">IdTokenLoginHandler</a> has changed</p>
</li>
<li>
<p>The constructor of <a href="../api/io/micronaut/security/session/SessionLoginHandler.html">SessionLoginHandler</a> has changed</p>
</li>
<li>
<p>The constructor of <a href="../api/io/micronaut/security/authentication/BasicAuthAuthenticationFetcher.html">BasicAuthAuthenticationFetcher</a> has changed</p>
</li>
<li>
<p>The <a href="../api/io/micronaut/security/token/RolesFinder.html">RolesFinder</a> method <code>findInClaims</code> has been deprecated and usages should be replaced with <code>resolveRoles(@Nullable Map&lt;String, Object&gt; attributes)</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>

<h1 id="security-installation"><a class="anchor" href="#security-installation"></a>5 Installation</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/security-installation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply either <code>security,</code> <code>security-jwt</code> or <code>security-session</code> features configure the security support in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features security</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s security capabilities you must have the <code>security</code> dependency on your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.security:micronaut-security-annotations")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-security-annotations&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-security")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-security&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>micronaut-security-annotations</code> dependency is only required to use JSR 250 annotations
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default Micronaut returns HTTP Status Unauthorized (401) for any endpoint invocation. Routes must be explicitly allowed through the provided mechanisms.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/secured_by_default.svg" alt="secured by default">
</div>
</div>

<h1 id="securityFilter"><a class="anchor" href="#securityFilter"></a>6 How It Works - Security Filter</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you add the <code>micronaut-security</code> dependency, it contributes a <a href="https://docs.micronaut.io/latest/guide/#filters">Micronaut HTTP Server Filter</a> - the <a href="../api/io/micronaut/security/filters/SecurityFilter.html">SecurityFilter</a>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/securityfilter.png" alt="securityfilter">
</div>
</div>
<div class="paragraph">
<p>For each request, the filter evaluates the request against every bean of type <a href="../api/io/micronaut/security/filters/AuthenticationFetcher.html">AuthenticationFetcher</a>. That evaluation may result in an instance of type <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> being resolved.</p>
</div>
<div class="paragraph">
<p>Then, the optional authentication is evaluated against every bean of type <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a> to determine if the request is authorized. If not authorized, an <a href="../api/io/micronaut/security/authentication/AuthorizationException.html">AuthorizationException</a> is thrown.</p>
</div>

<h2 id="builtInAuthenticationFetchers"><a class="anchor" href="#builtInAuthenticationFetchers"></a>6.1 Built-In Authentication Fetchers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/builtInAuthenticationFetchers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can write your own bean of type <a href="../api/io/micronaut/security/filters/AuthenticationFetcher.html">AuthenticationFetcher</a>. However, Micronaut Security ships with several built-in authentication fetchers:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/authentication/BasicAuthAuthenticationFetcher.html">BasicAuthAuthenticationFetcher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It parses the credentials from an HTTP Request, which uses Basic Authentication. Then, it invokes every Authentication Provider using the parsed credentials.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/TokenAuthenticationFetcher.html">TokenAuthenticationFetcher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It attempts to retrieve a token from the HTTP Request, and then it tries to validate the token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/session/SessionAuthenticationFetcher.html">SessionAuthenticationFetcher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It attempts to retrieve an <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> from an HTTP session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/x509/X509AuthenticationFetcher.html">X509AuthenticationFetcher</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates an <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> if an X.509 client certificate is present and a name (CN) can be extracted.</p></td>
</tr>
</tbody>
</table>

<h2 id="basicAuthAuthenticationFetcher"><a class="anchor" href="#basicAuthAuthenticationFetcher"></a>6.1.1 Basic-Auth Authentication Fetcher</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/builtInAuthenticationFetchers/basicAuthAuthenticationFetcher.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="../api/io/micronaut/security/authentication/BasicAuthAuthenticationFetcher.html">BasicAuthAuthenticationFetcher</a> parses the credentials
from an HTTP Request using <a href="https://en.wikipedia.org/wiki/Basic_access_authentication">Basic Authentication</a>. Then,
it invokes every <a href="#authenticationProviders">Authentication Provider</a> using the parsed credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/basicAuthAuthenticationFetcher.png" alt="basicAuthAuthenticationFetcher">
</div>
</div>

<h2 id="tokenAuthenticationFetcher"><a class="anchor" href="#tokenAuthenticationFetcher"></a>6.1.2 Token Authentication Fetcher</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/builtInAuthenticationFetchers/tokenAuthenticationFetcher.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="../api/io/micronaut/security/token/TokenAuthenticationFetcher.html">TokenAuthenticationFetcher</a> attempts to retrieve a token from the HTTP Request via the <a href="../api/io/micronaut/security/token/reader/TokenResolver.html">TokenResolver</a> API,
and then it tries to validate the token via the <a href="../api/io/micronaut/security/token/validator/TokenValidator.html">TokenValidator</a> API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/tokenAuthenticationFetcher.png" alt="tokenAuthenticationFetcher">
</div>
</div>

<h2 id="tokenReaders"><a class="anchor" href="#tokenReaders"></a>6.1.2.1 Token Readers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/builtInAuthenticationFetchers/tokenAuthenticationFetcher/tokenReaders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can write your own bean of type <a href="../api/io/micronaut/security/token/reader/TokenReader.html">TokenReader</a>. However, Micronaut Security ships with several built-in beans of type <a href="../api/io/micronaut/security/token/reader/TokenReader.html">TokenReader</a>.</p>
</div>

<h2 id="bearerTokenReader"><a class="anchor" href="#bearerTokenReader"></a>6.1.2.1.1 Bearer Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/builtInAuthenticationFetchers/tokenAuthenticationFetcher/tokenReaders/bearerTokenReader.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="../api/io/micronaut/security/token/bearer/BearerTokenReader.html">BearerTokenReader</a> attempts to read a <a href="https://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a>.</p>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize how the Bearer Token will be read:</p>
</div>
<a id="io.micronaut.security.token.bearer.BearerTokenConfigurationProperties" href="#io.micronaut.security.token.bearer.BearerTokenConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/bearer/BearerTokenConfigurationProperties.html">BearerTokenConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set whether to enable bearer token authentication. Default value true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the prefix to use for the auth token. Default value Bearer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.header-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the header name to use. Default value Authorization.</p></td>
</tr>
</tbody>
</table>

<h2 id="cookieTokenReader"><a class="anchor" href="#cookieTokenReader"></a>6.1.2.1.2 Cookie Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/builtInAuthenticationFetchers/tokenAuthenticationFetcher/tokenReaders/cookieTokenReader.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="../api/io/micronaut/security/token/cookie/CookieTokenReader.html">CookieTokenReader</a> attempts to read token from a request cookie.</p>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize how the token will be read from a cookie:</p>
</div>
<a id="io.micronaut.security.token.cookie.TokenCookieConfigurationProperties" href="#io.micronaut.security.token.cookie.TokenCookieConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/cookie/TokenCookieConfigurationProperties.html">TokenCookieConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-http-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-secure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-same-site</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/SameSite.html">SameSite</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the same-site setting of the cookie. Default value null. Value is case sensitive. Allowed values: <code>Strict</code>, <code>Lax</code> or <code>None</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether JWT cookie configuration is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cookie Name. Default value ("JWT").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path of the cookie. Default value ("/").</p></td>
</tr>
</tbody>
</table>

<h2 id="securityRule"><a class="anchor" href="#securityRule"></a>6.2 Security Rules</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityRule.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The decision to allow access to a particular endpoint to anonymous or authenticated users is determined by a collection of
Security Rules which are executed from the <a href="../api/io/micronaut/security/filters/SecurityFilter.html">SecurityFilter</a>. Micronaut ships with several built-in security rules. If they don&#8217;t fulfil your needs,
you can implement your own <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a>.</p>
</div>
<div class="paragraph">
<p>Security rules return a publisher that should emit a single <a href="../api/io/micronaut/security/rules/SecurityRuleResult.html">SecurityRuleResult</a>. See the following table for a description of each result.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Result</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/rules/SecurityRuleResult.html#ALLOWED">ALLOWED</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to the resource should be granted and <strong>no further rules will be considered</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/rules/SecurityRuleResult.html#REJECTED">REJECTED</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access to the resource should be rejected and <strong>no further rules will be considered</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/rules/SecurityRuleResult.html#UNKNOWN">UNKNOWN</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rule doesn&#8217;t apply to the request resource, or it cannot be determined either way. This result will cause other security rules to be considered.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If all security rules return <code>UNKNOWN</code>, the request will be rejected!
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<a href="../api/io/micronaut/security/filters/SecurityFilter.html">SecurityFilter</a> evaluates security rules in order. <strong>The remaining rules are not evaluated once a rule returns <code>ALLOWED</code> or <code>REJECTED</code></strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Security rules implement the ordered interface and so all of the existing rules have a static variable <code>ORDER</code> that stores the order of that rule. The rules they are executed in order from lower to higher values. You can use those variables to place your custom rule before or after any of the existing rules.</p>
</div>
<div class="paragraph">
<p>In the following table you can find the order and a short description of the behavior of built-in security rules. You can find more details about theese rules in their own guide sections.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Rule</th>
<th class="tableblock halign-left valign-top">Order</th>
<th class="tableblock halign-left valign-top">ACCEPT condition</th>
<th class="tableblock halign-left valign-top">REJECT condition</th>
<th class="tableblock halign-left valign-top">UNKNOWN confition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#ipPattern">IpPatternsRule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Never</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None of the IP patterns matched the hostaddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The address matches at least one of the patterns or no address could be resolved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#secured">SecuredAnnotationRule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one required role is granted to the authenticated user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None of the required roles is granted to the authenticated user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No secured annotation is specified on the requested method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#interceptUrlMap">ConfigurationInterceptUrlMapRule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-100</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one required role is granted to the authenticated user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None of the required roles is granted to the authenticated user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No path pattern is matched</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#builtInEndpointsAccess">SensitiveEndpointRule</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User is authenticated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User is not authenticated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path is not a sensitive one</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not execute any blocking operations in the rule implementation without offloading those operations to another thread pool.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Since version 2.5, the Micronaut Framework executes the filters and then it reads the HTTP Request&#8217;s body.
<a href="../api/io/micronaut/security/filter/SecurityFilter.html">SecurityFilter</a> evaluates the beans of type <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a>.
Because of that, <a href="../api/io/micronaut/security/rules/SecurityRule.html">SecurityRule</a> cannot rely on HTTP Request&#8217;s body because the Micronaut Framework has not read the body yet.
</td>
</tr>
</table>
</div>

<h2 id="ipPattern"><a class="anchor" href="#ipPattern"></a>6.2.1 IP Pattern Rule</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/securityRule/ipPattern.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you turn on security, traffic coming from any ip address is allowed by default.</p>
</div>
<div class="paragraph">
<p>You can however reject traffic not coming from a white list of IP Patterns as illustrated below:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.ip-patterns[0]=127.0.0.1
micronaut.security.ip-patterns[1]=192.168.1.*</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    ip-patterns:
      - 127.0.0.1
      - 192.168.1.*</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    ip-patterns=[
      "127.0.0.1",
      "192.168.1.*"
    ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    ipPatterns = ["127.0.0.1", "192.168.1.*"]
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      ip-patterns = ["127.0.0.1", "192.168.1.*"]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "ip-patterns": ["127.0.0.1", "192.168.1.*"]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In the previous code, the <a href="../api/io/micronaut/security/rules/IpPatternsRule.html">IpPatternsRule</a> rejects traffic not coming
either <code>127.0.0.1</code> or <code>192.168.1.*</code> range.</p>
</div>
<div class="paragraph">
<p>The IP patterns rule never explicitly allows requests, it only rejects requests if the address does not match. There must be other security rules that determine whether a resource should be accessed.</p>
</div>
<div class="paragraph">
<p>If the desired behavior is to allow access to all resources as long as the address matches, create a security rule that executes after this one that returns <code>ALLOWED</code>.</p>
</div>

<h2 id="secured"><a class="anchor" href="#secured"></a>6.2.2 Secured Annotation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/securityRule/secured.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>As illustrated below, you can use the <a href="../api/io/micronaut/security/annotation/Secured.html">@Secured</a> annotation to control
access to controllers or controller methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/example")
@Secured(SecurityRule.IS_AUTHENTICATED) <i class="conum" data-value="1"></i><b>(1)</b>
public class ExampleController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/admin")
    @Secured({"ROLE_ADMIN", "ROLE_X"}) <i class="conum" data-value="2"></i><b>(2)</b>
    public String withroles() {
        return "You have ROLE_ADMIN or ROLE_X roles";
    }

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/anonymous")
    @Secured(SecurityRule.IS_ANONYMOUS)  <i class="conum" data-value="3"></i><b>(3)</b>
    public String anonymous() {
        return "You are anonymous";
    }

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/authenticated") <i class="conum" data-value="1"></i><b>(1)</b>
    public String authenticated(Authentication authentication) {
        return authentication.getName() + " is authenticated";
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Authenticated users are able to access <code>authenticated</code> Controller&#8217;s action.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Users granted role <code>ROLE_ADMIN</code> or <code>ROLE_X</code> roles can access <code>withroles</code> Controller&#8217;s action.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Anonymous users (authenticated and not authenticated users) can access <code>anonymous</code> Controller&#8217;s action.</td>
</tr>
</table>
</div>

<h2 id="jakartaAnnotations"><a class="anchor" href="#jakartaAnnotations"></a>6.2.2.1 Jakarta Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/securityRule/secured/jakartaAnnotations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Alternatively, you can use <a href="https://jakarta.ee/specifications/annotations/2.1/annotations-spec-2.1.html">Jakarta Annotations</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>jakarta.annotation.security.PermitAll</code></p>
</li>
<li>
<p><code>jakarta.annotation.security.RolesAllowed</code></p>
</li>
<li>
<p><code>jakarta.annotation.security.DenyAll</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/example")
public class ExampleController {

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/admin")
    @RolesAllowed({"ROLE_ADMIN", "ROLE_X"}) <i class="conum" data-value="1"></i><b>(1)</b>
    public String withroles() {
        return "You have ROLE_ADMIN or ROLE_X roles";
    }

    @Produces(MediaType.TEXT_PLAIN)
    @Get("/anonymous")
    @PermitAll  <i class="conum" data-value="2"></i><b>(2)</b>
    public String anonymous() {
        return "You are anonymous";
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Users granted role <code>ROLE_ADMIN</code> or <code>ROLE_X</code> roles can access <code>withroles</code> Controller&#8217;s action.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Anonymous users (authenticated and not authenticated users) can access <code>anonymous</code> Controller&#8217;s action.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The use of JSR 250 annotations requires <code>io.micronaut.security:micronaut-security-annotations</code> to be in the annotation processor classpath (<code>annotationProcessor</code>, <code>kapt</code>, <code>compileOnly</code>) respectively for Java, Kotlin, Groovy.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <a href="../api/io/micronaut/security/annotation/Secured.html">@Secured</a> annotation has a set of roles, the <a href="#secured">SecuredAnnotationRule</a> grants access to a user if they have <strong>any</strong> of the roles.
</td>
</tr>
</table>
</div>

<h2 id="securedExpression"><a class="anchor" href="#securedExpression"></a>6.2.2.2 Secured with expressions</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/securityRule/secured/securedExpression.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In combination with <a href="../api/io/micronaut/security/annotation/Secured.html">@Secured</a>, you can use <a href="https://docs.micronaut.io/4.0.0-M2/guide/#evaluatedExpressions">expressions</a>, introduced in Micronaut Framework 4.0, to access the authenticated user:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Controller("/authenticated")
public class ExampleController {

    @Secured("#{ user?.attributes?.get('email') == 'sherlock@micronaut.example' }")
    @Produces(MediaType.TEXT_PLAIN)
    @Get("/email")
    public String authenticationByEmail(Principal principal) {
        return principal.getName() + " is authenticated";
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Controller("/authenticated")
class ExampleController {

    @Secured("#{ user?.attributes?.get('email') == 'sherlock@micronaut.example' }")
    @Produces(MediaType.TEXT_PLAIN)
    @Get("/email")
    String authenticationByEmail(Principal principal) {
        "${principal.name} is authenticated"
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Controller("/authenticated")
class ExampleController {
    @Secured("#{ user?.attributes?.get('email') == 'sherlock@micronaut.example' }")
    @Produces(MediaType.TEXT_PLAIN)
    @Get("/email")
    fun authenticationByEmail(principal: Principal) = "${principal.name} is authenticated"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>user</code> is of type <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a></p>
</div>

<h2 id="interceptUrlMap"><a class="anchor" href="#interceptUrlMap"></a>6.2.3 Intercept URL Map</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/securityRule/interceptUrlMap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Moreover, you can configure endpoint authentication and authorization access with an Intercept URL Map:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.intercept-url-map[0].pattern=/images/*
micronaut.security.intercept-url-map[0].http-method=GET
micronaut.security.intercept-url-map[0].access[0]=isAnonymous()
micronaut.security.intercept-url-map[1].pattern=/books
micronaut.security.intercept-url-map[1].access[0]=isAuthenticated()
micronaut.security.intercept-url-map[2].pattern=/books/grails
micronaut.security.intercept-url-map[2].http-method=POST
micronaut.security.intercept-url-map[2].access[0]=ROLE_GRAILS
micronaut.security.intercept-url-map[2].access[1]=ROLE_GROOVY
micronaut.security.intercept-url-map[3].pattern=/books/grails
micronaut.security.intercept-url-map[3].http-method=PUT
micronaut.security.intercept-url-map[3].access[0]=ROLE_ADMIN</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    intercept-url-map:
      -
        pattern: /images/*
        http-method: GET
        access:
          - isAnonymous()
      -
        pattern: /books
        access:
          - isAuthenticated()
      -
        pattern: /books/grails
        http-method: POST
        access:
          - ROLE_GRAILS
          - ROLE_GROOVY
      -
        pattern: /books/grails
        http-method: PUT
        access:
          - ROLE_ADMIN</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [[micronaut.security.intercept-url-map]]
      pattern="/images/*"
      http-method="GET"
      access=[
        "isAnonymous()"
      ]
    [[micronaut.security.intercept-url-map]]
      pattern="/books"
      access=[
        "isAuthenticated()"
      ]
    [[micronaut.security.intercept-url-map]]
      pattern="/books/grails"
      http-method="POST"
      access=[
        "ROLE_GRAILS",
        "ROLE_GROOVY"
      ]
    [[micronaut.security.intercept-url-map]]
      pattern="/books/grails"
      http-method="PUT"
      access=[
        "ROLE_ADMIN"
      ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    interceptUrlMap = [{
        pattern = "/images/*"
        httpMethod = "GET"
        access = ["isAnonymous()"]
      }, {
        pattern = "/books"
        access = ["isAuthenticated()"]
      }, {
        pattern = "/books/grails"
        httpMethod = "POST"
        access = ["ROLE_GRAILS", "ROLE_GROOVY"]
      }, {
        pattern = "/books/grails"
        httpMethod = "PUT"
        access = ["ROLE_ADMIN"]
      }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      intercept-url-map = [{
          pattern = "/images/*"
          http-method = "GET"
          access = ["isAnonymous()"]
        }, {
          pattern = "/books"
          access = ["isAuthenticated()"]
        }, {
          pattern = "/books/grails"
          http-method = "POST"
          access = ["ROLE_GRAILS", "ROLE_GROOVY"]
        }, {
          pattern = "/books/grails"
          http-method = "PUT"
          access = ["ROLE_ADMIN"]
        }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "intercept-url-map": [{
          "pattern": "/images/*",
          "http-method": "GET",
          "access": ["isAnonymous()"]
        }, {
          "pattern": "/books",
          "access": ["isAuthenticated()"]
        }, {
          "pattern": "/books/grails",
          "http-method": "POST",
          "access": ["ROLE_GRAILS", "ROLE_GROOVY"]
        }, {
          "pattern": "/books/grails",
          "http-method": "PUT",
          "access": ["ROLE_ADMIN"]
        }]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>pattern <code>/images/*</code> enables access to authenticated and not authenticated users</p>
</li>
<li>
<p>pattern <code>/books</code> enables access for everyone authenticated</p>
</li>
<li>
<p>pattern <code>/books/grails</code> enables access for users who are granted any of the specified roles.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As you see in the previous code listing, any endpoint is identified by a combination of pattern
and an optional HTTP method.</p>
</div>
<div class="paragraph">
<p>If a given request URI matches more than one intercept url map, the one that specifies an http method that matches the request method will be used. If there are multiple mappings that do not specify a method and match the request URI, then the first mapping will be used. For example:</p>
</div>
<div class="paragraph">
<p>The example below defines that all HTTP requests to URIs matching the pattern <code>/v1/myResource/**</code> and using HTTP method <code>GET</code> will be accessible to everyone. Requests matching the same URI pattern but using a different HTTP method than <code>GET</code> require fully authenticated access.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.intercept-url-map[0].pattern=/v1/myResource/**
micronaut.security.intercept-url-map[0].httpMethod=GET
micronaut.security.intercept-url-map[0].access[0]=isAnonymous()
micronaut.security.intercept-url-map[1].pattern=/v1/myResource/**
micronaut.security.intercept-url-map[1].access[0]=isAuthenticated()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    intercept-url-map:
      - pattern: /v1/myResource/**
        httpMethod: GET
        access:
          - isAnonymous()
      - pattern: /v1/myResource/**
        access:
          - isAuthenticated()</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [[micronaut.security.intercept-url-map]]
      pattern="/v1/myResource/**"
      httpMethod="GET"
      access=[
        "isAnonymous()"
      ]
    [[micronaut.security.intercept-url-map]]
      pattern="/v1/myResource/**"
      access=[
        "isAuthenticated()"
      ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    interceptUrlMap = [{
        pattern = "/v1/myResource/**"
        httpMethod = "GET"
        access = ["isAnonymous()"]
      }, {
        pattern = "/v1/myResource/**"
        access = ["isAuthenticated()"]
      }]
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      intercept-url-map = [{
          pattern = "/v1/myResource/**"
          httpMethod = "GET"
          access = ["isAnonymous()"]
        }, {
          pattern = "/v1/myResource/**"
          access = ["isAuthenticated()"]
        }]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "intercept-url-map": [{
          "pattern": "/v1/myResource/**",
          "httpMethod": "GET",
          "access": ["isAnonymous()"]
        }, {
          "pattern": "/v1/myResource/**",
          "access": ["isAuthenticated()"]
        }]
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>accessing <code>/v1/myResource/**</code> with a GET request does not require authentication</p>
</li>
<li>
<p>accessing <code>/v1/myResource/**</code> with a request that isn&#8217;t GET requires authentication</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When the <a href="../api/io/micronaut/security/annotation/Secured.html">@Secured</a> annotation has a set of roles, the <a href="#secured">SecuredAnnotationRule</a> grants access to a user if they have <strong>any</strong> of the roles.
</td>
</tr>
</table>
</div>

<h2 id="builtInEndpointsAccess"><a class="anchor" href="#builtInEndpointsAccess"></a>6.2.4 Built-In Endpoints Security</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityFilter/securityRule/builtInEndpointsAccess.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you turn on security, <a href="https://docs.micronaut.io/latest/guide/index.html#providedEndpoints">Built-in endpoints</a> are secured depending on their sensitive value.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">endpoints.beans.enabled=true
endpoints.beans.sensitive=true
endpoints.info.enabled=true
endpoints.info.sensitive=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">endpoints:
  beans:
    enabled: true
    sensitive: true
  info:
    enabled: true
    sensitive: false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[endpoints]
  [endpoints.beans]
    enabled=true
    sensitive=true
  [endpoints.info]
    enabled=true
    sensitive=false</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">endpoints {
  beans {
    enabled = true
    sensitive = true
  }
  info {
    enabled = true
    sensitive = false
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  endpoints {
    beans {
      enabled = true
      sensitive = true
    }
    info {
      enabled = true
      sensitive = false
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "endpoints": {
    "beans": {
      "enabled": true,
      "sensitive": true
    },
    "info": {
      "enabled": true,
      "sensitive": false
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>the <code>/beans</code> endpoint is secured</p>
</li>
<li>
<p>the <code>/info</code> endpoint is open for unauthenticated access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You need to replace the default implementation <a href="../api/io/micronaut/security/rules/SensitiveEndpointRule.html">SensitiveEndpointRule</a> and implement <code>SensitiveEndpointRule::checkSensitiveAuthenticated</code> to allow authenticated users access to sensitive endpoints. For example, you may want to restrict access to users with a specific role:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Replaces;
import io.micronaut.context.annotation.Requires;
import io.micronaut.core.annotation.NonNull;
import io.micronaut.http.HttpRequest;
import io.micronaut.inject.ExecutableMethod;
import io.micronaut.management.endpoint.EndpointSensitivityProcessor;
import io.micronaut.security.authentication.Authentication;
import io.micronaut.security.rules.SecurityRuleResult;
import io.micronaut.security.rules.SensitiveEndpointRule;
import io.micronaut.security.token.RolesFinder;
import jakarta.inject.Singleton;
import java.util.Collections;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;

@Replaces(SensitiveEndpointRule.class)
@Singleton
public class SensitiveEndpointRuleReplacement extends SensitiveEndpointRule {
    private final RolesFinder rolesFinder;

    public SensitiveEndpointRuleReplacement(EndpointSensitivityProcessor endpointSensitivityProcessor,
                                            RolesFinder rolesFinder) {
        super(endpointSensitivityProcessor);
        this.rolesFinder = rolesFinder;
    }

    @Override
    @NonNull
    protected Publisher&lt;SecurityRuleResult&gt; checkSensitiveAuthenticated(@NonNull HttpRequest&lt;?&gt; request,
                                                                        @NonNull Authentication authentication,
                                                                        @NonNull ExecutableMethod&lt;?, ?&gt; method) {
        return Mono.just(rolesFinder.hasAnyRequiredRoles(Collections.singletonList("ROLE_SYSTEM"), authentication.getRoles())
                ? SecurityRuleResult.ALLOWED : SecurityRuleResult.REJECTED);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import org.reactivestreams.Publisher
import reactor.core.publisher.Mono


@Replaces(SensitiveEndpointRule.class)
@Singleton
class SensitiveEndpointRuleReplacement extends SensitiveEndpointRule {
    private final RolesFinder rolesFinder;

    SensitiveEndpointRuleReplacement(EndpointSensitivityProcessor endpointSensitivityProcessor,
                                     RolesFinder rolesFinder) {
        super(endpointSensitivityProcessor)
        this.rolesFinder = rolesFinder
    }

    @Override
    @NonNull
    protected Publisher&lt;SecurityRuleResult&gt; checkSensitiveAuthenticated(@NonNull HttpRequest&lt;?&gt; request,
                                                                        @NonNull Authentication authentication,
                                                                        @NonNull ExecutableMethod&lt;?, ?&gt; method) {
        Mono.just(rolesFinder.hasAnyRequiredRoles(["ROLE_SYSTEM"], authentication.roles)
                ? SecurityRuleResult.ALLOWED : SecurityRuleResult.REJECTED)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Replaces
import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpRequest
import io.micronaut.inject.ExecutableMethod
import io.micronaut.management.endpoint.EndpointSensitivityProcessor
import io.micronaut.security.authentication.Authentication
import io.micronaut.security.rules.SecurityRuleResult
import io.micronaut.security.rules.SensitiveEndpointRule
import io.micronaut.security.token.RolesFinder
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Mono


@Replaces(SensitiveEndpointRule::class)
@Singleton
class SensitiveEndpointRuleReplacement(endpointSensitivityProcessor: EndpointSensitivityProcessor,
                                       private val rolesFinder: RolesFinder) : SensitiveEndpointRule(endpointSensitivityProcessor) {
    override fun checkSensitiveAuthenticated(
        request: HttpRequest&lt;*&gt;,
        authentication: Authentication,
        method: ExecutableMethod&lt;*, *&gt;
    ): Publisher&lt;SecurityRuleResult&gt; {
        return Mono.just(
            if (rolesFinder.hasAnyRequiredRoles(listOf("ROLE_SYSTEM"), authentication.roles)) SecurityRuleResult.ALLOWED
            else SecurityRuleResult.REJECTED
        )
    }
}</code></pre>
</div>
</div>

<h1 id="exceptionHandlers"><a class="anchor" href="#exceptionHandlers"></a>7 Exception Handlers</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/exceptionHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Security ships with several built-in <a href="https://docs.micronaut.io/latest/guide/#exceptionHandler">Exception Handlers</a>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/authentication/AuthenticationException.html">AuthenticationException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/authentication/AuthenticationExceptionHandler.html">AuthenticationExceptionHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/authentication/AuthorizationException.html">AuthorizationException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/authentication/DefaultAuthorizationExceptionHandler.html">DefaultAuthorizationExceptionHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/response/AuthorizationErrorResponseException.html">AuthorizationErrorResponseException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/response/AuthorizationErrorResponseExceptionHandler.html">AuthorizationErrorResponseExceptionHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/errors/OauthErrorResponseException.html">OauthErrorResponseException</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/errors/OauthErrorResponseExceptionHandler.html">OauthErrorResponseExceptionHandler</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You may need to <a href="https://docs.micronaut.io/latest/guide/#replaces">replace</a> some of those beans to customize Micronaut Security exception handling to your needs.</p>
</div>

<h1 id="endpoints"><a class="anchor" href="#endpoints"></a>8 Endpoints</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/endpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="#securityFilter">Security Filter</a> section describes how for each request an <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> maybe resolved. It maybe a token placed in an HTTP Header, in a cookie, or an HTTP session.
How do you obtain such a token or how is the user saved into the HTTP Session in the first place?. In a Micronaut application, you can expose the <a href="#loginController">LoginController</a>.</p>
</div>

<h2 id="login"><a class="anchor" href="#login"></a>8.1 Login Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/endpoints/login.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To enable the <a href="../api/io/micronaut/security/endpoints/LoginController.html">LoginController</a>, you need to have a bean of type <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a>. A custom implementation can, of course, be provided. However, several <a href="#loginHandler">Login Handlers</a> implementations are available out of the box.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/loginController.png" alt="loginController">
</div>
</div>
<div class="paragraph">
<p>You can configure the <code>LoginController</code> with:</p>
</div>
<a id="io.micronaut.security.endpoints.LoginControllerConfigurationProperties" href="#io.micronaut.security.endpoints.LoginControllerConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/endpoints/LoginControllerConfigurationProperties.html">LoginControllerConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.login.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables <a href="../api/io/micronaut/security/endpoints/LoginController.html">LoginController</a>. Default value true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.login.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the <a href="../api/io/micronaut/security/endpoints/LoginController.html">LoginController</a>. Default value "/login"</p></td>
</tr>
</tbody>
</table>

<h2 id="loginHandler"><a class="anchor" href="#loginHandler"></a>8.1.1 Login Handler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/endpoints/login/loginHandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> API defines how to respond to a successful or failed login attempt. For example, with the <a href="#login">Login Controller</a> or with <a href="#oauth">OAuth 2.0</a> support.</p>
</div>

<h2 id="logout"><a class="anchor" href="#logout"></a>8.2 Logout Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/endpoints/logout.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To enable the logout controller you need a bean of type <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a>. The behaviour of the controller is delegated to it.
A custom implementation can, of course, be provided. However, several <a href="#logoutHandler">Logout Handler</a>s implementations are available out of the box.</p>
</div>
<div class="paragraph">
<p>You can configure the logout endpoint with:</p>
</div>
<a id="io.micronaut.security.endpoints.LogoutControllerConfigurationProperties" href="#io.micronaut.security.endpoints.LogoutControllerConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/endpoints/LogoutControllerConfigurationProperties.html">LogoutControllerConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.logout.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.logout.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the <a href="../api/io/micronaut/security/endpoints/LogoutController.html">LogoutController</a>. Default value "/logout".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.logout.get-allowed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are using JWT authentication not stored in a cookie, you may not need to invoke the <code>/logout</code> endpoint. Since logging out normally means simply deleting the JWT token in the client.
</td>
</tr>
</table>
</div>

<h2 id="logoutHandler"><a class="anchor" href="#logoutHandler"></a>8.2.1 Logout Handler</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/endpoints/logout/logoutHandler.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a> API defines how to respond to a logout attempt. For example, with the <a href="#logout">Logout Controller</a>.</p>
</div>

<h2 id="builtInHandlers"><a class="anchor" href="#builtInHandlers"></a>8.3 Built-in Login and Logout Handlers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/endpoints/builtInHandlers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can provide your own implementations of <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> and <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a>.
However, Micronaut security modules ship with several implementations which you can enable by setting the configuration <code>micronaut.security.authentication</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><code>micronaut.security.authentication</code> Value</th>
<th class="tableblock halign-left valign-top">Required Module</th>
<th class="tableblock halign-left valign-top">Login Handler</th>
<th class="tableblock halign-left valign-top">Logout Handler</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cookie</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut-jwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/cookie/TokenCookieLoginHandler.html">TokenCookieLoginHandler</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/cookie/JwtCookieClearerLogoutHandler.html">JwtCookieClearerLogoutHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut-session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/session/SessionLoginHandler.html">SessionLoginHandler</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/session/SessionLogoutHandler.html">SessionLogoutHandler</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bearer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut-jwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/bearer/AccessRefreshTokenLoginHandler.html">AccessRefreshTokenLoginHandler</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>idtoken</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut-oauth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/token/response/IdTokenLoginHandler.html">IdTokenLoginHandler</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/cookie/JwtCookieClearerLogoutHandler.html">JwtCookieClearerLogoutHandler</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These handlers allow you to set the following scenarios:</p>
</div>
<div class="sect3">
<h4 id="_micronaut_security_authentication_bearer">Micronaut Security Authentication Bearer</h4>
<div class="paragraph">
<p>When you set <code>micronaut.security.authentication=bearer</code>, <a href="../api/io/micronaut/security/token/bearer/AccessRefreshTokenLoginHandler.html">AccessRefreshTokenLoginHandler</a> a bean of type  <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> is enabled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/micronaut-security-authentication-bearer.png" alt="micronaut security authentication bearer">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_security_authentication_cookie">Micronaut Security Authentication Cookie</h4>
<div class="paragraph">
<p>When you set <code>micronaut.security.authentication=cookie</code>, <a href="../api/io/micronaut/security/token/cookie/TokenCookieLoginHandler.html">TokenCookieLoginHandler</a> a bean of type <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> and <a href="../api/io/micronaut/security/token/jwt/cookie/JwtCookieClearerLogoutHandler.html">JwtCookieClearerLogoutHandler</a> a bean of type <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a> are enabled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/micronaut-security-authentication-cookie.png" alt="micronaut security authentication cookie">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_security_authentication_sessionloginhandler">Micronaut Security Authentication SessionLoginHandler</h4>
<div class="paragraph">
<p>When you set <code>micronaut.security.authentication=session</code>, <a href="../api/io/micronaut/security/session/SessionLoginHandler.html">SessionLoginHandler</a> a bean of type <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> and <a href="../api/io/micronaut/security/session/SessionLogoutHandler.html">SessionLogoutHandler</a> a bean of type <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a> are enabled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/micronaut-security-authentication-session.png" alt="micronaut security authentication session">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_micronaut_security_authentication_id_token">Micronaut Security Authentication ID Token</h4>
<div class="paragraph">
<p>When you set <code>micronaut.security.authentication=idtoken</code>, <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/IdTokenLoginHandler.html">IdTokenLoginHandler</a> a bean of type <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> and <a href="../api/io/micronaut/security/token/jwt/cookie/JwtCookieClearerLogoutHandler.html">JwtCookieClearerLogoutHandler</a> a bean of type <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a> are enabled.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/micronaut-security-authentication-idtoken.png" alt="micronaut security authentication idtoken">
</div>
</div>
</div>

<h1 id="securityConfiguration"><a class="anchor" href="#securityConfiguration"></a>9 Security Configuration</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following global configuration options are available:</p>
</div>
<a id="io.micronaut.security.config.SecurityConfigurationProperties" href="#io.micronaut.security.config.SecurityConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/config/SecurityConfigurationProperties.html">SecurityConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.authentication</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/authentication/AuthenticationMode.html">AuthenticationMode</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines which authentication to use. Defaults to null. Possible values bearer, session, cookie, idtoken. Should
 only be supplied if the service handles login and logout requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If Security is enabled. Default value true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.intercept-url-map</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map that defines the interception patterns.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ip-patterns</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allowed IP patterns. Default value (["0.0.0.0"])</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.intercept-url-map-prepend-pattern-with-context-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the intercept URL patterns should be prepended with context path if defined. Defaults to true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.authentication-provider-strategy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/config/AuthenticationStrategy.html">AuthenticationStrategy</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines how authentication providers should be processed. Default value ANY. Possible values: ANY or ALL.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.reject-not-found</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the server should respond with 401 for requests that do not match any routes on the server, if you set it to false, it will return 404 for requests that do not match any routes on the server. Default value (true).</p></td>
</tr>
</tbody>
</table>

<h2 id="rejectNotFound"><a class="anchor" href="#rejectNotFound"></a>9.1 Reject Not Found Routes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityConfiguration/rejectNotFound.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default, when you include Micronaut security the app returns 401 or 403 even for non existing routes. The behavior prevents attackers from discovering what endpoints are available in your application. However, if you wish to return 404 for non found routes you can set <code>micronaut.security.reject-not-found: false</code> in your configuration.</p>
</div>

<h2 id="authenticationStrategy"><a class="anchor" href="#authenticationStrategy"></a>9.2 Authentication Strategy</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityConfiguration/authenticationStrategy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default, Micronaut requires just one <a href="#authenticationProviders">Authentication Provider</a> to return a successful authentication response. You can set <code>micronaut.security.authentication-provider-strategy: ALL</code> to require all <a href="../api/io/micronaut/security/authentication/AuthenticationProvider.html">AuthenticationProvider</a>s to return a successful authentication response.</p>
</div>

<h2 id="noRedirection"><a class="anchor" href="#noRedirection"></a>9.3 Handlers without redirection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityConfiguration/noRedirection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Some built-in handlers respond with a 303 (See other) response to the urls defined in the <a href="#redirection">Redirection Configuration</a>
If you disable redirection configuration with by setting <code>micronaut.security.redirect.enabled</code> to <code>false</code>, these handlers respond with 200 responses instead.</p>
</div>

<h2 id="redirection"><a class="anchor" href="#redirection"></a>9.4 Redirection Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityConfiguration/redirection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Several security flows (e.g. session based authentication, Cookie Token authentication) may involve redirection after the user logs in.</p>
</div>
<div class="paragraph">
<p>You can configure the redirection destinations with:</p>
</div>
<a id="io.micronaut.security.config.RedirectConfigurationProperties" href="#io.micronaut.security.config.RedirectConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/config/RedirectConfigurationProperties.html">RedirectConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.login-success</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the user is redirected to after a successful login. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.login-failure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the user is redirected to after a failed login. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.logout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user is redirected after logout. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.prior-to-login</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the user should be redirected back to the unauthorized
 request that initiated the login flow. Supersedes the &lt;code&gt;login-success&lt;/code&gt;
 configuration for those cases. Default value false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether Redirection configuration enabled. Default value (true).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.config.RedirectConfigurationProperties$ForbiddenRedirectConfigurationProperties" href="#io.micronaut.security.config.RedirectConfigurationProperties$ForbiddenRedirectConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/config/RedirectConfigurationProperties.ForbiddenRedirectConfigurationProperties.html">RedirectConfigurationProperties$ForbiddenRedirectConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.forbidden.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the user is redirected to after trying to access a secured route which he is forbidden to access. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.forbidden.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether it should redirect on forbidden rejections. Default value (true).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.config.RedirectConfigurationProperties$UnauthorizedRedirectConfigurationProperties" href="#io.micronaut.security.config.RedirectConfigurationProperties$UnauthorizedRedirectConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Configuration Properties for <a href="../api/io/micronaut/security/config/RedirectConfigurationProperties.UnauthorizedRedirectConfigurationProperties.html">RedirectConfigurationProperties$UnauthorizedRedirectConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.unauthorized.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the user is redirected to after trying to access a secured route. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.unauthorized.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether it should redirect on unauthorized rejections. Default value (true).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Use the API <a href="../api/io/micronaut/security/config/RedirectService.html">RedirectService</a>, which prepends the context path, if defined, to the redirect URLs.
</td>
</tr>
</table>
</div>

<h1 id="authenticationProviders"><a class="anchor" href="#authenticationProviders"></a>10 Reactive Authentication Providers</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationProviders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To authenticate users you must provide implementations of <a href="../api/io/micronaut/security/authentication/provider/ReactiveAuthenticationProvider.html">ReactiveAuthenticationProvider</a> or <a href="../api/io/micronaut/security/authentication/provider/HttpRequestReactiveAuthenticationProvider.html">HttpRequestReactiveAuthenticationProvider</a>.</p>
</div>
<div class="paragraph">
<p>The following code snippet illustrates a naive implementation:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
class CustomAuthenticationProvider&lt;B&gt; implements HttpRequestReactiveAuthenticationProvider&lt;B&gt; {
    @Override
    @SingleResult
    public Publisher&lt;AuthenticationResponse&gt; authenticate(HttpRequest&lt;B&gt; requestContext, AuthenticationRequest&lt;String, String&gt; authRequest) {
        AuthenticationResponse rsp = authRequest.getIdentity().equals("user") &amp;&amp; authRequest.getSecret().equals("password")
                ? AuthenticationResponse.success("user")
                : AuthenticationResponse.failure(AuthenticationFailureReason.CREDENTIALS_DO_NOT_MATCH);
        return Mono.create(emitter -&gt; {
            emitter.success(rsp);
        });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class CustomAuthenticationProvider&lt;B&gt; implements HttpRequestReactiveAuthenticationProvider&lt;B&gt; {
    @Override
    @SingleResult
    Publisher&lt;AuthenticationResponse&gt; authenticate(@Nullable HttpRequest&lt;B&gt; httpRequest,
                                                   @NonNull AuthenticationRequest&lt;String, String&gt; authRequest) {
        AuthenticationResponse rsp = (authRequest.identity == "user" &amp;&amp; authRequest.secret == "password")
                ? AuthenticationResponse.success("user")
                : AuthenticationResponse.failure(AuthenticationFailureReason.CREDENTIALS_DO_NOT_MATCH)
        return Mono.create(emitter -&gt; {
            emitter.success(rsp)
        })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class CustomAuthenticationProvider&lt;Any&gt; :
    HttpRequestReactiveAuthenticationProvider&lt;Any&gt; {
    override fun authenticate(
        requestContext: HttpRequest&lt;Any&gt;?,
        authenticationRequest: AuthenticationRequest&lt;String, String&gt;
    ): Publisher&lt;AuthenticationResponse&gt; {
        val rsp = if (authenticationRequest.identity == "user" &amp;&amp; authenticationRequest.secret == "password")
            AuthenticationResponse.success("user")
        else AuthenticationResponse.failure(AuthenticationFailureReason.CREDENTIALS_DO_NOT_MATCH)
        return Mono.create { emitter -&gt; emitter.success(rsp) }
    }
}</code></pre>
</div>
</div>

<h2 id="imperativeAuthenticationProviders"><a class="anchor" href="#imperativeAuthenticationProviders"></a>10.1 Authentication Provider</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationProviders/imperativeAuthenticationProviders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/authentication/provider/ReactiveAuthenticationProvider.html">ReactiveAuthenticationProvider</a> interface is a reactive API. If you prefer an imperative style, you can instead implement the <a href="../api/io/micronaut/security/authentication/provider/AuthenticationProvider.html">AuthenticationProvider</a> or <a href="../api/io/micronaut/security/authentication/provider/HttpRequestAuthenticationProvider.html">HttpRequestAuthenticationProvider</a> interface:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
class CustomAuthenticationProvider&lt;B&gt; implements HttpRequestAuthenticationProvider&lt;B&gt; {

    @Override
    public AuthenticationResponse authenticate(HttpRequest&lt;B&gt; requestContext, AuthenticationRequest&lt;String, String&gt; authRequest) {
        return (authRequest.getIdentity().equals("user") &amp;&amp; authRequest.getSecret().equals("password"))
                ? AuthenticationResponse.success("user")
                : AuthenticationResponse.failure(AuthenticationFailureReason.CREDENTIALS_DO_NOT_MATCH);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Singleton
class CustomAuthenticationProviderCustomAuthenticationProvider&lt;B&gt; implements HttpRequestAuthenticationProvider&lt;B&gt; {
    @Override
    AuthenticationResponse authenticate(HttpRequest&lt;B&gt; requestContext, AuthenticationRequest&lt;String, String&gt; authRequest) {
        authRequest.identity == "user" &amp;&amp; authRequest.secret == "password"
                ? AuthenticationResponse.success("user")
                : AuthenticationResponse.failure(AuthenticationFailureReason.CREDENTIALS_DO_NOT_MATCH)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">@Singleton
class CustomAuthenticationProvider :
    HttpRequestAuthenticationProvider&lt;Any&gt; {
    override fun authenticate(
        requestContext: HttpRequest&lt;Any&gt;?,
        authRequest: AuthenticationRequest&lt;String, String&gt;
    ): AuthenticationResponse {
        return if (authRequest.identity == "user" &amp;&amp; authRequest.secret == "password")
            AuthenticationResponse.success("user")
        else AuthenticationResponse.failure(AuthenticationFailureReason.CREDENTIALS_DO_NOT_MATCH)
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If your implementation is blocking (e.g., you fetch the user credentials from a database in a blocking way to check against the supplied authentication request), implement the <a href="../api/io/micronaut/security/authentication/provider/ExecutorAuthenticationProvider.html">ExecutorAuthenticationProvider</a> or <a href="../api/io/micronaut/security/authentication/provider/HttpRequestExecutorAuthenticationProvider.html">HttpRequestExecutorAuthenticationProvider</a> interface. Those APIs specify the executor name, by default <code>TaskExecutors.BLOCKING</code>, where the code gets executed to avoid blocking the main reactive flow.
</td>
</tr>
</table>
</div>

<h2 id="authenticationProvidersUseCases"><a class="anchor" href="#authenticationProvidersUseCases"></a>10.2 Authentication Providers Use Cases</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationProviders/authenticationProvidersUseCases.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The built-in <a href="#login">Login Controller</a> uses every available authentication provider. The first provider that returns a successful authentication response will have its value used as the basis for the JWT token or session state.</p>
</div>
<div class="paragraph">
<p>Basic authentication which is implemented as an <a href="../api/io/micronaut/security/filters/AuthenticationFetcher.html">AuthenticationFetcher</a> will also trigger the available <a href="../api/io/micronaut/security/authentication/AuthenticationProvider.html">AuthenticationProvider</a>s.</p>
</div>

<h2 id="builtInAuthenticationProviders"><a class="anchor" href="#builtInAuthenticationProviders"></a>10.3 Built-In Authentication Providers</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationProviders/builtInAuthenticationProviders.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut comes with authentication providers for LDAP (<a href="../api/io/micronaut/security/ldap/LdapAuthenticationProvider.html">LdapAuthenticationProvider</a>) and the OAuth 2.0 password grant authentication flow (<a href="../api/io/micronaut/security/oauth2/endpoint/token/request/password/OauthPasswordAuthenticationProvider.html">OauthPasswordAuthenticationProvider</a> and <a href="../api/io/micronaut/security/oauth2/endpoint/token/request/password/OpenIdPasswordAuthenticationProvider.html">OpenIdPasswordAuthenticationProvider</a>). For any custom authentication, an authentication provider must be created.</p>
</div>

<h1 id="authenticationStrategies"><a class="anchor" href="#authenticationStrategies"></a>11 Authorization Strategies</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="basicAuth"><a class="anchor" href="#basicAuth"></a>11.1 Basic Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/basicAuth.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Out-of-the-box, Micronaut supports <a href="https://tools.ietf.org/html/rfc7617">RFC7617</a> which defines the "Basic" Hypertext Transfer Protocol (HTTP) authentication scheme, which transmits credentials as user-id/password pairs, encoded using Base64. Basic authentication is enabled by default. You can disable it by setting <code>micronaut.security.basic-auth.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/basicauth.svg" alt="basicauth">
</div>
</div>
<div class="paragraph">
<p>Below is a sample of a cURL command using basic auth:</p>
</div>
<div class="listingblock">
<div class="title">cURL command using Basic Auth</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl "http://localhost:8080/info" \
     -u 'user:password'</code></pre>
</div>
</div>
<div class="paragraph">
<p>After credentials are read from the HTTP Header, they are feed into an <a href="../api/io/micronaut/security/authentication/Authenticator.html">Authenticator</a>
which attempts to validate them.</p>
</div>
<div class="paragraph">
<p>The code snippet below illustrates how to send credentials using the <code>basicAuth</code> method from <a href="https://micronaut-projects.github.io/micronaut-core/latest/api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> method:</p>
</div>
<div class="listingblock">
<div class="title">Accessing a protected resource using an Authorization request header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">HttpRequest request = HttpRequest.GET("/home").basicAuth('sherlock', 'password')</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="https://guides.micronaut.io/latest/micronaut-security-basicauth.html">Basic Authentication Micronaut Guide</a> to learn more.
</td>
</tr>
</table>
</div>

<h2 id="session"><a class="anchor" href="#session"></a>11.2 Session Authorization</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/session.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports Session based authentication.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply either the <code>security-session</code> feature to configure session security in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features security-session</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s session based authentication capabilities you must have the <code>security-session</code> dependency on your classpath. For example:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.security:micronaut-security-annotations")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-security-annotations&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-security-session")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-security-session&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>micronaut-security-annotations</code> dependency is only required to use JSR 250 annotations
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/sesssion_based_auth.svg" alt="sesssion based auth">
</div>
</div>
<div class="paragraph">
<p>Check the <a href="#redirection">Redirection configuration</a> to customize session based authentication behaviour.</p>
</div>
<div class="sect1">
<h2 id="_example_of_session_based_authentication_configuration">Example of Session-Based Authentication configuration</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.authentication=session
micronaut.security.redirect.login-failure=/login/authFailed</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    authentication: session
    redirect:
      login-failure: /login/authFailed</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    authentication="session"
    [micronaut.security.redirect]
      login-failure="/login/authFailed"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    authentication = "session"
    redirect {
      loginFailure = "/login/authFailed"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      authentication = "session"
      redirect {
        login-failure = "/login/authFailed"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "authentication": "session",
      "redirect": {
        "login-failure": "/login/authFailed"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Read the following guides to learn more abut session based authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-security-session.html">Session-Based Authentication Micronaut Guide</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-security-session-database-authentication.html">Database Authentication</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_session_based_authentication_without_redirection">Session-based authentication without redirection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you set <code>micronaut.security.authentication</code> to <code>session</code>, you enable <a href="../api/io/micronaut/security/session/SessionLoginHandler.html">SessionLoginHandler</a> and <a href="../api/io/micronaut/security/session/SessionLogoutHandler.html">SessionLogoutHandler</a>.</p>
</div>
<div class="paragraph">
<p>These handlers return 303 responses to the urls defined in the <a href="#redirection">Redirection Configuration</a>. Disable redirection configuration with <code>micronaut.security.redirection.enabled=false</code> to respond with 200 responses instead.</p>
</div>
</div>
</div>

<h2 id="jwt"><a class="anchor" href="#jwt"></a>11.3 JSON Web Token</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The following configuration properties are available to customize token based authentication:</p>
</div>
<a id="io.micronaut.security.token.config.TokenConfigurationProperties" href="#io.micronaut.security.token.config.TokenConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/config/TokenConfigurationProperties.html">TokenConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the configuration is enabled. Default value true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.roles-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.name-key</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.roles-separator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the entry used for the roles in the <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> attributes map is a String, you can use the separator to split its value into multiple roles. Default value <a href="../api/io/micronaut/security/token/config/TokenConfiguration.html#DEFAULT_ROLES_SEPARATOR">DEFAULT_ROLES_SEPARATOR</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Micronaut ships with security capabilities based on <a href="https://jwt.io/">Json Web Token (JWT)</a>.
JWT is an <a href="https://tools.ietf.org/html/rfc7519">IETF standard</a> which defines a secure way to encapsulate arbitrary data that can be sent over unsecure URL’s.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>security-jwt</code> feature to configure JWT support in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features security-jwt</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To use the Micronaut&#8217;s JWT based authentication capabilities you must have the <code>security-jwt</code> dependency on your classpath. For example:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">annotationProcessor(<span class="hljs-string">"io.micronaut.security:micronaut-security-annotations")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;annotationProcessorPaths&gt;
    &lt;path&gt;
        &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-security-annotations&lt;/artifactId&gt;
    &lt;/path&gt;
&lt;/annotationProcessorPaths&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-security-jwt")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-security-jwt&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>micronaut-security-annotations</code> dependency is only required to use JSR 250 annotations
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize JWT based authentication behaviour:</p>
</div>
<a id="io.micronaut.security.token.jwt.config.JwtConfigurationProperties" href="#io.micronaut.security.token.jwt.config.JwtConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/token/jwt/config/JwtConfigurationProperties.html">JwtConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether JWT security is enabled. Default value (true).</p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_what_does_a_jwt_look_like">What does a JWT look like?</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../img/jwt.png" alt="jwt">
</div>
</div>
<div class="sect2">
<h3 id="_header">Header</h3>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">JWT header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "alg": "HS256",
    "typ": "JWT"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_claims">Claims</h3>
<div class="paragraph">
<p>A base64-encoded JSON like:</p>
</div>
<div class="listingblock">
<div class="title">JWT claims</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
    "exp": 1422990129,
    "sub": "jimi",
    "roles": [
        "ROLE_ADMIN",
        "ROLE_USER"
    ],
    "iat": 1422986529
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_signature">Signature</h3>
<div class="paragraph">
<p>Depends on the algorithm specified on the header, it can be a digital signature of the base64-encoded header and claims, or an encryption of them.</p>
</div>
</div>
</div>
</div>

<h2 id="reader"><a class="anchor" href="#reader"></a>11.3.1 Reading JWT Token</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/reader.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="bearerToken"><a class="anchor" href="#bearerToken"></a>11.3.1.1 Bearer Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/reader/bearerToken.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports the <a href="https://tools.ietf.org/html/rfc6750">RFC 6750 Bearer Token</a> specification for transmitting JWT tokens. The following sequence illustrates the RFC 6750 authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/jwt-bearer-token.svg" alt="jwt bearer token">
</div>
</div>
<div class="paragraph">
<p>The following configuration properties are available to customize how the Bearer Token will be read:</p>
</div>
<a id="io.micronaut.security.token.bearer.BearerTokenConfigurationProperties" href="#io.micronaut.security.token.bearer.BearerTokenConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/bearer/BearerTokenConfigurationProperties.html">BearerTokenConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set whether to enable bearer token authentication. Default value true.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the prefix to use for the auth token. Default value Bearer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.bearer.header-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the header name to use. Default value Authorization.</p></td>
</tr>
</tbody>
</table>
<div class="sect1">
<h2 id="_sending_tokens_in_the_request">Sending tokens in the request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The code snippet below illustrates how to send a JWT token in the <code>Authorization</code> request header, using the <code>bearerAuth</code> method from <a href="https://micronaut-projects.github.io/micronaut-core/latest/api/io/micronaut/http/MutableHttpRequest.html">MutableHttpRequest</a> method:</p>
</div>
<div class="listingblock">
<div class="title">Accessing a protected resource using an Authorization request header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">String accessToken = rsp.body().accessToken
List&lt;Book&gt; books = gatewayClient.toBlocking().retrieve(HttpRequest.GET("/api/gateway")
        .bearerAuth(accessToken), Argument.listOf(Book))</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example of HTTP GET request using Authorization request header</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">GET /protectedResource HTTP/1.1
Host: micronaut.example`
Authorization: Bearer eyJhbGciOiJIUzI1NiJ9.eyJleHAiOjE0MjI5OTU5MjIsInN1YiI6ImppbWkiLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImlhdCI6MTQyMjk5MjMyMn0.rA7A2Gwt14LaYMpxNRtrCdO24RGrfHtZXY9fIjV8x8o</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Check out the <a href="https://guides.micronaut.io/latest/micronaut-security-jwt.html">Micronaut JWT authentication</a> for a tutorial on Micronaut&#8217;s JWT support.
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="cookieToken"><a class="anchor" href="#cookieToken"></a>11.3.1.2 Cookie Token Reader</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/reader/cookieToken.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can send/read a JWT token from a Cookie too.</p>
</div>
<div class="paragraph">
<p>The following sequence illustrates the authentication flow:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/jwt-cookie.svg" alt="jwt cookie">
</div>
</div>
<div class="paragraph">
<p>Reading tokens from Cookies is disabled by default. Note that using JWT tokens from cookies requires JWT Authentication to be enabled.</p>
</div>
<a id="io.micronaut.security.token.cookie.TokenCookieConfigurationProperties" href="#io.micronaut.security.token.cookie.TokenCookieConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/cookie/TokenCookieConfigurationProperties.html">TokenCookieConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-http-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-secure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-same-site</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/cookie/SameSite.html">SameSite</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the same-site setting of the cookie. Default value null. Value is case sensitive. Allowed values: <code>Strict</code>, <code>Lax</code> or <code>None</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether JWT cookie configuration is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cookie Name. Default value ("JWT").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.cookie.cookie-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path of the cookie. Default value ("/").</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="https://guides.micronaut.io/latest/micronaut-security-jwt-cookie.html">Micronaut JWT Authentication with Cookies</a> to learn more.
</td>
</tr>
</table>
</div>

<h2 id="jwtParser"><a class="anchor" href="#jwtParser"></a>11.3.2 JWT Parser</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtParser.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can inject a bean of type The <a href="../api/io/micronaut/security/token/jwt/validator/JsonWebTokenParser.html">JsonWebTokenParser</a> to parse a JWT token.
The parser decrypts the token if encrypted.</p>
</div>

<h2 id="jwtValidation"><a class="anchor" href="#jwtValidation"></a>11.3.3 JWT Signature Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut security capabilities use signed JWT’s as specified by the
<a href="https://tools.ietf.org/html/rfc7515">JSON Web Signature</a> specification.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s JWT validation supports multiple signature configurations. Thus, you can validate JSON Web tokens signed by different issuers in the same application.</p>
</div>
<div class="paragraph">
<p>To verify the signature of JWT tokens, you need beans of type
<a href="../api/io/micronaut/security/token/jwt/signature/SignatureConfiguration.html">SignatureConfiguration</a> or <a href="../api/io/micronaut/security/token/jwt/signature/ReactiveSignatureConfiguration.html">ReactiveSignatureConfiguration</a></p>
</div>
<div class="paragraph">
<p>The easiest way is to create a bean of type <a href="../api/io/micronaut/security/token/jwt/signature/SignatureConfiguration.html">SignatureConfiguration</a> is to have in your app a bean of type <a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureConfiguration.html">RSASignatureConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureConfiguration.html">ECSignatureConfiguration</a>, or
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> which must be <a href="https://docs.micronaut.io/latest/guide/index.html#qualifiers">qualified</a> with <code>@Named</code> since the configuration beans are used by factories (<a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureFactory.html/.html">html</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureConfiguration.html">ECSignatureConfiguration</a>) or other beans (<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignature.html">SecretSignature</a>)  which use
<a href="https://docs.micronaut.io/latest/guide/index.html#eachBean">@EachBean</a> to drive configuration.</p>
</div>
<div class="paragraph">
<p>The APIs
<a href="../api/io/micronaut/security/token/jwt/validator/JsonWebTokenSignatureValidator.html">JsonWebTokenSignatureValidator</a>,
and <a href="../api/io/micronaut/security/token/jwt/validator/ReactiveJsonWebTokenSignatureValidator.html">ReactiveJsonWebTokenSignatureValidator</a>
allows you to validate the signature of a JWT token.</p>
</div>
<div class="paragraph">
<p><code>ReactiveJsonWebTokenSignatureValidator</code> validates the signature using both <a href="../api/io/micronaut/security/token/jwt/signature/SignatureConfiguration.html">SignatureConfiguration</a> or <a href="../api/io/micronaut/security/token/jwt/signature/ReactiveSignatureConfiguration.html">ReactiveSignatureConfiguration</a>.</p>
</div>
<div class="paragraph">
<p><code>JsonWebTokenSignatureValidator</code> validates the signature using beans of type <a href="../api/io/micronaut/security/token/jwt/signature/SignatureConfiguration.html">SignatureConfiguration</a>.</p>
</div>

<h2 id="jwks"><a class="anchor" href="#jwks"></a>11.3.3.1 Remote JWKS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtValidation/jwks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A <a href="https://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a> is a JSON object that represents a cryptographic key. You can use a remote JWK Set, A JSON object that represents a set of JWKs, to validate JWT signatures.</p>
</div>
<div class="paragraph">
<p>You can configure a remote JWKS as a signature validator:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.signatures.jwks.awscognito.url=https://cognito-idp.eu-west-1.amazonaws.com/eu-west-XXXX/.well-known/jwks.json</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    token:
      jwt:
        signatures:
          jwks:
            awscognito:
              url: 'https://cognito-idp.eu-west-1.amazonaws.com/eu-west-XXXX/.well-known/jwks.json'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.jwks]
            [micronaut.security.token.jwt.signatures.jwks.awscognito]
              url="https://cognito-idp.eu-west-1.amazonaws.com/eu-west-XXXX/.well-known/jwks.json"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        signatures {
          jwks {
            awscognito {
              url = "https://cognito-idp.eu-west-1.amazonaws.com/eu-west-XXXX/.well-known/jwks.json"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          signatures {
            jwks {
              awscognito {
                url = "https://cognito-idp.eu-west-1.amazonaws.com/eu-west-XXXX/.well-known/jwks.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "jwks": {
              "awscognito": {
                "url": "https://cognito-idp.eu-west-1.amazonaws.com/eu-west-XXXX/.well-known/jwks.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The previous snippet creates a <a href="../api/io/micronaut/security/token/jwt/signature/jwks/ReactiveJwksSignature.html">ReactiveJwksSignature</a> bean with a <code>awscognito</code> name qualifier.</p>
</div>
<div class="paragraph">
<p>If you have the <a href="https://docs.micronaut.io/latest/guide/#httpClient">Micronaut HTTP Client</a> on the classpath, then it will be used to retrieve the remote JWK Set. This allows for the configuration settings of the HTTP Client to be applied when fetching the resource. If a named service-specific client exists and the name of the service matches the name of the configured JWKS provider name, then that specific client instance will be used, otherwise a default Http Client instance (with any global configuration settings from <code>micronaut.http.client.*</code> applied) will be used. If the Micronaut HTTP Client is not on the classpath, then the implementation will fall back to the internal resource fetching mechanism of the external JWT library dependency.</p>
</div>
<div class="paragraph">
<p>For example, to use an HTTP proxy for the fetching of the JWK Set from the above example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.http.services.awscognito.url=https://cognito-idp.eu-west-1.amazonaws.com
micronaut.http.services.awscognito.proxy-type=http
micronaut.http.services.awscognito.proxy-address=proxy.company.net:8080
micronaut.security.token.jwt.signatures.jwks.awscognito.url=/eu-west-XXXX/.well-known/jwks.json</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  http:
    services:
      awscognito:
        url: 'https://cognito-idp.eu-west-1.amazonaws.com'
        proxy-type: 'http'
        proxy-address: 'proxy.company.net:8080'
  security:
    token:
      jwt:
        signatures:
          jwks:
            awscognito:
              url: '/eu-west-XXXX/.well-known/jwks.json'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.http]
    [micronaut.http.services]
      [micronaut.http.services.awscognito]
        url="https://cognito-idp.eu-west-1.amazonaws.com"
        proxy-type="http"
        proxy-address="proxy.company.net:8080"
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.jwks]
            [micronaut.security.token.jwt.signatures.jwks.awscognito]
              url="/eu-west-XXXX/.well-known/jwks.json"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  http {
    services {
      awscognito {
        url = "https://cognito-idp.eu-west-1.amazonaws.com"
        proxyType = "http"
        proxyAddress = "proxy.company.net:8080"
      }
    }
  }
  security {
    token {
      jwt {
        signatures {
          jwks {
            awscognito {
              url = "/eu-west-XXXX/.well-known/jwks.json"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    http {
      services {
        awscognito {
          url = "https://cognito-idp.eu-west-1.amazonaws.com"
          proxy-type = "http"
          proxy-address = "proxy.company.net:8080"
        }
      }
    }
    security {
      token {
        jwt {
          signatures {
            jwks {
              awscognito {
                url = "/eu-west-XXXX/.well-known/jwks.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "http": {
      "services": {
        "awscognito": {
          "url": "https://cognito-idp.eu-west-1.amazonaws.com",
          "proxy-type": "http",
          "proxy-address": "proxy.company.net:8080"
        }
      }
    },
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "jwks": {
              "awscognito": {
                "url": "/eu-west-XXXX/.well-known/jwks.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that the same approach will be applied when using a <code>jwks_uri</code> supplied via <a href="#openid-authorization-code">Open ID Connect</a> metadata.</p>
</div>
<div class="paragraph">
<p>The <a href="https://docs.micronaut.io/latest/guide/#httpClient">Micronaut HTTP Client</a> based implementation can be explicitly disabled in favor of the JWT library&#8217;s internal resource fetching implementation by explicitly setting <code>micronaut.security.token.jwt.signatures.jwks-client.http-client.enabled=false</code>. For example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.signatures.jwks-client.http-client.enabled=false
micronaut.security.token.jwt.signatures.jwks.awscognito.url=/eu-west-XXXX/.well-known/jwks.json</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    token:
      jwt:
        signatures:
          jwks-client:
            http-client:
              enabled: false
          jwks:
            awscognito:
              url: '/eu-west-XXXX/.well-known/jwks.json'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.jwks-client]
            [micronaut.security.token.jwt.signatures.jwks-client.http-client]
              enabled=false
          [micronaut.security.token.jwt.signatures.jwks]
            [micronaut.security.token.jwt.signatures.jwks.awscognito]
              url="/eu-west-XXXX/.well-known/jwks.json"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        signatures {
          jwksClient {
            httpClient {
              enabled = false
            }
          }
          jwks {
            awscognito {
              url = "/eu-west-XXXX/.well-known/jwks.json"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          signatures {
            jwks-client {
              http-client {
                enabled = false
              }
            }
            jwks {
              awscognito {
                url = "/eu-west-XXXX/.well-known/jwks.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "jwks-client": {
              "http-client": {
                "enabled": false
              }
            },
            "jwks": {
              "awscognito": {
                "url": "/eu-west-XXXX/.well-known/jwks.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to expose your own JWK Set, read the <a href="#keys">Keys Controller</a> section.</p>
</div>

<h2 id="staticJwks"><a class="anchor" href="#staticJwks"></a>11.3.3.1.1 Local JWKS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtValidation/jwks/staticJwks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can specify a path starting with <code>classpath:</code> or <code>file:</code> to serve a JSON JWKS from anywhere on disk or in the classpath. For example to serve static resources from <code>src/main/resources/jwks/certs.json</code>, you would use <code>classpath:jwks/certs.json</code> as the path.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.signatures.jwks-static.google.path=classpath:jwks/certs.json</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    token:
      jwt:
        signatures:
          jwks-static:
            google:
              path: 'classpath:jwks/certs.json'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.jwks-static]
            [micronaut.security.token.jwt.signatures.jwks-static.google]
              path="classpath:jwks/certs.json"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        signatures {
          jwksStatic {
            google {
              path = "classpath:jwks/certs.json"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          signatures {
            jwks-static {
              google {
                path = "classpath:jwks/certs.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "jwks-static": {
              "google": {
                "path": "classpath:jwks/certs.json"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="jsonWebTokenValidator"><a class="anchor" href="#jsonWebTokenValidator"></a>11.3.4 JWT Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jsonWebTokenValidator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The APIs <a href="../api/io/micronaut/security/token/jwt/validator/JsonWebTokenValidator.html">JsonWebTokenValidator</a>, and <a href="../api/io/micronaut/security/token/jwt/validator/ReactiveJsonWebTokenValidator.html">ReactiveJsonWebTokenValidator</a> allows you to validate a JWT token.</p>
</div>
<div class="paragraph">
<p>The validation performs the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>- Parses the Token (if encrypted, it decrypts).</p>
</li>
<li>
<p>- Validates the Signature</p>
</li>
<li>
<p>- Validates the Claims with beans of type <a href="../api/io/micronaut/security/token/jwt/validator/GenericJwtClaimsValidator.html">GenericJwtClaimsValidator</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>JsonWebTokenValidator</code>  will not use remote signature configuration. E.g. it will not validate the signature with remote JWKs.
Only, <a href="../api/io/micronaut/security/token/jwt/validator/ReactiveJsonWebTokenValidator.html">ReactiveJsonWebTokenValidator</a> implements
<a href="../api/io/micronaut/security/token/validator/TokenValidator.html">TokenValidator</a>.</p>
</div>

<h2 id="jwtGenerator"><a class="anchor" href="#jwtGenerator"></a>11.3.5 JWT Token Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut relies on <a href="https://connect2id.com/products/nimbus-jose-jwt">Nimbus JOSE + JWT</a> library to provide JWT token signature and encryption.</p>
</div>
<div class="paragraph">
<p>The following configuration options are available:</p>
</div>
<a id="io.micronaut.security.token.generator.AccessTokenConfigurationProperties" href="#io.micronaut.security.token.generator.AccessTokenConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/generator/AccessTokenConfigurationProperties.html">AccessTokenConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.generator.access-token.expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access token expiration. Default value (3600).</p></td>
</tr>
</tbody>
</table>

<h2 id="jwtGeneratorSignature"><a class="anchor" href="#jwtGeneratorSignature"></a>11.3.5.1 Signed JWT Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorSignature.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To generate a signed JWT you need to have in your app a bean of type
<a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureGeneratorConfiguration.html">RSASignatureGeneratorConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureGeneratorConfiguration.html">ECSignatureGeneratorConfiguration</a>,
, or
<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> which must be <strong> <a href="https://docs.micronaut.io/latest/guide/index.html#qualifiers">qualified</a> with <code>@Named</code> <code>generator</code></strong>  since the configuration beans are used by factories (
<a href="../api/io/micronaut/security/token/jwt/signature/rsa/RSASignatureGeneratorFactory.html">RSASignatureGeneratorFactory</a>,
<a href="../api/io/micronaut/security/token/jwt/signature/ec/ECSignatureGeneratorConfiguration.html">ECSignatureGeneratorFactory</a>) or other beans (<a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignature.html">SecretSignature</a>)  which use
<a href="https://docs.micronaut.io/latest/guide/index.html#eachBean">@EachBean</a> to drive configuration.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Remember to qualify with <code>@Named</code> <code>generator</code> your signature configuration beans which you wish to use to sign your JSON web tokens.
</td>
</tr>
</table>
</div>

<h2 id="jwtGeneratorSecret"><a class="anchor" href="#jwtGeneratorSecret"></a>11.3.5.2 Example of JWT Signed with Secret</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorSecret.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can setup a <a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> qualified with <code>@Named</code> <code>generator</code> easily via configuration:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.signatures.secret.generator.secret=pleaseChangeThisSecretForANewOne
micronaut.security.token.jwt.signatures.secret.generator.jws-algorithm=HS256</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    token:
      jwt:
        signatures:
          secret:
            generator:
              secret: pleaseChangeThisSecretForANewOne
              jws-algorithm: HS256</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.secret]
            [micronaut.security.token.jwt.signatures.secret.generator]
              secret="pleaseChangeThisSecretForANewOne"
              jws-algorithm="HS256"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        signatures {
          secret {
            generator {
              secret = "pleaseChangeThisSecretForANewOne"
              jwsAlgorithm = "HS256"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          signatures {
            secret {
              generator {
                secret = "pleaseChangeThisSecretForANewOne"
                jws-algorithm = "HS256"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "secret": {
              "generator": {
                "secret": "pleaseChangeThisSecretForANewOne",
                "jws-algorithm": "HS256"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Change the <code>secret</code> property to your own secret and keep it safe</strong>.</p>
</li>
<li>
<p><code>jws-algorithm</code> specifies the Json Web Token Signature name. In this example, HMAC using SHA-256 hash algorithm.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can supply the secret with Base64 encoding.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.signatures.secret.generator.secret=cGxlYXNlQ2hhbmdlVGhpc1NlY3JldEZvckFOZXdPbmU=
micronaut.security.token.jwt.signatures.secret.generator.base64=true
micronaut.security.token.jwt.signatures.secret.generator.jws-algorithm=HS256</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    token:
      jwt:
        signatures:
          secret:
            generator:
              secret: 'cGxlYXNlQ2hhbmdlVGhpc1NlY3JldEZvckFOZXdPbmU='
              base64: true
              jws-algorithm: HS256</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.secret]
            [micronaut.security.token.jwt.signatures.secret.generator]
              secret="cGxlYXNlQ2hhbmdlVGhpc1NlY3JldEZvckFOZXdPbmU="
              base64=true
              jws-algorithm="HS256"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        signatures {
          secret {
            generator {
              secret = "cGxlYXNlQ2hhbmdlVGhpc1NlY3JldEZvckFOZXdPbmU="
              base64 = true
              jwsAlgorithm = "HS256"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          signatures {
            secret {
              generator {
                secret = "cGxlYXNlQ2hhbmdlVGhpc1NlY3JldEZvckFOZXdPbmU="
                base64 = true
                jws-algorithm = "HS256"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "secret": {
              "generator": {
                "secret": "cGxlYXNlQ2hhbmdlVGhpc1NlY3JldEZvckFOZXdPbmU=",
                "base64": true,
                "jws-algorithm": "HS256"
              }
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This example of <code>secret</code> is Base64 encoded</p>
</li>
<li>
<p>Set <code>base64</code> to signal that the secret is Base64 encoded</p>
</li>
</ul>
</div>

<h2 id="jwtGeneratorRSA"><a class="anchor" href="#jwtGeneratorRSA"></a>11.3.5.3 Example of JWT Signed with RSA</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtGenerator/jwtGeneratorRSA.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A programmatic setup of a RSA signature generation may look like</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Factory
class MySignatureGeneratorConfigurationFactory {
    @Bean
    @Named("generator") <i class="conum" data-value="1"></i><b>(1)</b>
    SignatureGeneratorConfiguration signatureGeneratorConfiguration(RSASignatureGeneratorConfiguration configuration) {<i class="conum" data-value="2"></i><b>(2)</b>
        return new RSASignatureGenerator(configuration)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Name the SignatureGeneratorConfiguration <code>generator</code> to make it participate in JWT token generation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Register an additional bean of type RSASignatureGeneratorConfiguration which is injected here</td>
</tr>
</table>
</div>

<h2 id="jwtEncryption"><a class="anchor" href="#jwtEncryption"></a>11.3.6 JWT Encryption</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtEncryption.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Signed claims prevent an attacker from tampering with its contents to introduce malicious data or try a privilege escalation by adding more roles. However, the claims can be decoded just by using Base 64.</p>
</div>
<div class="paragraph">
<p>If the claims contain sensitive information, you can use a JSON Web Encryption algorithm to prevent them from being decoded.</p>
</div>
<div class="paragraph">
<p>Micronaut&#8217;s JWT validation supports multiple encryption configurations.</p>
</div>
<div class="paragraph">
<p>Beans of type <a href="../api/io/micronaut/security/token/jwt/encryption/rsa/RSAEncryptionConfiguration.html">RSAEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/ec/ECEncryptionConfiguration.html">ECEncryptionConfiguration</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/secret/SecretEncryptionConfiguration.html">SecretEncryptionConfiguration</a> participate as encryption configurations in the JWT validation.</p>
</div>
<div class="paragraph">
<p>Those beans need to be <a href="https://docs.micronaut.io/latest/guide/index.html#qualifiers">qualified</a> with <code>@Named</code> since the configuration beans are used by factories (<a href="../api/io/micronaut/security/token/jwt/encryption/rsa/RSAEncryptionFactory.html">RSAEncryptionFactory</a>,
<a href="../api/io/micronaut/security/token/jwt/encryption/ec/ECEncryptionFactory.html">ECEncryptionFactory</a>) or other beans (<a href="../api/io/micronaut/security/token/jwt/encryption/secret/SecretEncryptionFactory.html">SecretEncryptionFactory</a>)  which use
<a href="https://docs.micronaut.io/latest/guide/index.html#eachBean">@EachBean</a> to drive configuration.</p>
</div>
<div class="paragraph">
<p>Use <code>generator</code> as the <code>@Named</code> qualifier if you want to use encryption configuration in the tokens your app generates.</p>
</div>
<div class="paragraph">
<p>The API <a href="../api/io/micronaut/security/token/jwt/validator/JsonWebTokenEncryption.html">JsonWebTokenEncryption</a> allows you to decrypt an encrypted token.</p>
</div>

<h2 id="jwtGeneratorEncryption"><a class="anchor" href="#jwtGeneratorEncryption"></a>11.3.6.1 Example of JWT Signed with Secret and Encrypted with RSA</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtEncryption/jwtGeneratorEncryption.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Setup a <a href="../api/io/micronaut/security/token/jwt/signature/secret/SecretSignatureConfiguration.html">SecretSignatureConfiguration</a> through configuration properties</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.signatures.secret.generator.secret=pleaseChangeThisSecretForANewOne
micronaut.security.token.jwt.signatures.secret.generator.jws-algorithm=HS256
pem.path=/home/user/rsa-2048bit-key-pair.pem</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    token:
      jwt:
        signatures:
          secret:
            generator:
              secret: pleaseChangeThisSecretForANewOne
              jws-algorithm: HS256
pem:
  path: /home/user/rsa-2048bit-key-pair.pem #<b class="conum">(2)</b></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.secret]
            [micronaut.security.token.jwt.signatures.secret.generator]
              secret="pleaseChangeThisSecretForANewOne"
              jws-algorithm="HS256"
[pem]
  path="/home/user/rsa-2048bit-key-pair.pem"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        signatures {
          secret {
            generator {
              secret = "pleaseChangeThisSecretForANewOne"
              jwsAlgorithm = "HS256"
            }
          }
        }
      }
    }
  }
}
pem {
  path = "/home/user/rsa-2048bit-key-pair.pem"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          signatures {
            secret {
              generator {
                secret = "pleaseChangeThisSecretForANewOne"
                jws-algorithm = "HS256"
              }
            }
          }
        }
      }
    }
  }
  pem {
    path = "/home/user/rsa-2048bit-key-pair.pem"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "secret": {
              "generator": {
                "secret": "pleaseChangeThisSecretForANewOne",
                "jws-algorithm": "HS256"
              }
            }
          }
        }
      }
    }
  },
  "pem": {
    "path": "/home/user/rsa-2048bit-key-pair.pem"
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Name the Signature configuration <code>generator</code> to make it participate in JWT token generation.</p>
</li>
<li>
<p><code>pem.path</code> specifies the location of PEM file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Generate a 2048-bit RSA private + public key pair:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">openssl genrsa -out rsa-2048bit-key-pair.pem 2048</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Named("generator") <i class="conum" data-value="1"></i><b>(1)</b>
@Singleton
class RSAOAEPEncryptionConfiguration implements RSAEncryptionConfiguration {

    private RSAPrivateKey rsaPrivateKey
    private RSAPublicKey rsaPublicKey
    JWEAlgorithm jweAlgorithm = JWEAlgorithm.RSA_OAEP_256
    EncryptionMethod encryptionMethod = EncryptionMethod.A128GCM

    RSAOAEPEncryptionConfiguration(@Value('${pem.path}') String pemPath) {
        Optional&lt;KeyPair&gt; keyPair = KeyPairProvider.keyPair(pemPath)
        if (keyPair.isPresent()) {
            this.rsaPublicKey = (RSAPublicKey) keyPair.get().getPublic()
            this.rsaPrivateKey = (RSAPrivateKey) keyPair.get().getPrivate()
        }
    }

    @Override
    RSAPublicKey getPublicKey() {
        return rsaPublicKey
    }

    @Override
    RSAPrivateKey getPrivateKey() {
        return rsaPrivateKey
    }

    @Override
    JWEAlgorithm getJweAlgorithm() {
        return jweAlgorithm
    }

    @Override
    EncryptionMethod getEncryptionMethod() {
        return encryptionMethod
    }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Name Bean <code>generator</code> to designate this bean as participant in the JWT Token Generation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To parse the PEM key, use a collaborator as described in <a href="https://connect2id.com/products/nimbus-jose-jwt/openssl-key-generation">OpenSSL key generation</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">@Slf4j
class KeyPairProvider {
    /**
     *
     * @param pemPath Full path to PEM file.
     * @return returns KeyPair if successfully for PEM files.
     */
    static Optional&lt;KeyPair&gt; keyPair(String pemPath) {
        // Load BouncyCastle as JCA provider
        Security.addProvider(new BouncyCastleProvider())

        // Parse the EC key pair
        PEMParser pemParser
        try {
            pemParser = new PEMParser(new InputStreamReader(Files.newInputStream(Paths.get(pemPath))))
            PEMKeyPair pemKeyPair = (PEMKeyPair) pemParser.readObject()

            // Convert to Java (JCA) format
            JcaPEMKeyConverter converter = new JcaPEMKeyConverter()
            KeyPair keyPair = converter.getKeyPair(pemKeyPair)
            pemParser.close()

            return Optional.of(keyPair)

        } catch (FileNotFoundException e) {
            log.warn("file not found: {}", pemPath)

        } catch (PEMException e) {
            log.warn("PEMException {}", e.getMessage())

        } catch (IOException e) {
            log.warn("IOException {}", e.getMessage())
        }
        return Optional.empty()
    }
}</code></pre>
</div>
</div>

<h2 id="claimsGeneration"><a class="anchor" href="#claimsGeneration"></a>11.3.7 Claims Generation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/claimsGeneration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If the built-in
<a href="../api/io/micronaut/security/token/jwt/generator/claims/JWTClaimsSetGenerator.html">JWTClaimsSetGenerator</a>, does not
fulfil your needs you can provide your own <a href="https://micronaut-projects.github.io/micronaut-core/latest/guide/#replaces">replacement</a> of <a href="../api/io/micronaut/security/token/jwt/generator/claims/ClaimsGenerator.html">ClaimsGenerator</a>.</p>
</div>

<h2 id="claimsValidation"><a class="anchor" href="#claimsValidation"></a>11.3.8 Claims Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/claimsValidation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The claims of a JSON Web Token are validated using every bean of type <a href="../api/io/micronaut/security/token/jwt/validator/GenericJwtClaimsValidator.html">GenericJwtClaimsValidator</a>.</p>
</div>
<div class="paragraph">
<p>Micronaut Security includes some validators by default:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/validator/AudienceJwtClaimsValidator.html">AudienceJwtClaimsValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT <code>aud</code> claim includes an expected value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when the <code>micronaut.security.token.jwt.claims-validators.audience</code> property is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/validator/ExpirationJwtClaimsValidator.html">ExpirationJwtClaimsValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT is not expired. It uses the <code>exp</code> claim.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default. You can disable it by setting <code>micronaut.security.token.jwt.claims-validators.expiration</code> to false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/validator/IssuerJwtClaimsValidator.html">IssuerJwtClaimsValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT <code>iss</code> claim is set to an expected value.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled when the <code>micronaut.security.token.jwt.claims-validators.issuer</code> property is set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/validator/NotBeforeJwtClaimsValidator.html">NotBeforeJwtClaimsValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the JWT <code>nbf</code> claim is set, the token should only be valid if the current date is not before the provided date.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled by default.  Enabled when the <code>micronaut.security.token.jwt.claims-validators.not-before</code> property is set to <code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/jwt/validator/SubjectNotNullJwtClaimsValidator.html">SubjectNotNullJwtClaimsValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT <code>sub</code> claim is not null.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled by default. You can disable it by setting <code>micronaut.security.token.jwt.claims-validators.subject</code> to false.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you are using <code>micronaut.security.authentication: idtoken</code>, <a href="../api/io/micronaut/security/oauth2/client/IdTokenClaimsValidator.html">IdTokenClaimsValidator</a>, a bean of type <a href="../api/io/micronaut/security/token/jwt/validator/GenericJwtClaimsValidator.html">GenericJwtClaimsValidator</a>, is registered in the bean context as well. <code>IdTokenClaimsValidator</code> validates points 2-5 of the <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">ID Token Validation</a> section of the OpenID Connect Spec. You can disable it by setting <code>micronaut.security.token.jwt.claims-validators.openid-idtoken</code> to false.</p>
</div>

<h2 id="render"><a class="anchor" href="#render"></a>11.3.9 Token Render</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/render.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you use <a href="#loginHandler"><code>bearer</code> authentication</a> and the built-in <a href="#login">LoginController</a>,
the JWT tokens are returned to the client as part of an OAuth 2.0 <a href="https://tools.ietf.org/html/RFC6749">RFC6749</a> access token response.</p>
</div>
<div class="paragraph">
<p>An example of such a response is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-store
Pragma: no-cache
{
    "access_token":"eyJhbGciOiJIUzI1NiJ9...",
    "token_type":"Bearer",
    "expires_in":3600,
    "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA...",
    "username": "euler",
    "roles": [
        "ROLE_USER"
    ],
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you wish to customize the previous JSON payload, you may want to provide a bean replacement for <a href="../api/io/micronaut/security/token/jwt/render/BearerTokenRenderer.html">BearerTokenRenderer</a>. If that is not enough, check the <a href="../api/io/micronaut/security/token/jwt/bearer/AccessRefreshTokenLoginHandler.html">AccessRefreshTokenLoginHandler</a> to accommodate it to your needs.</p>
</div>

<h2 id="jwtGuides"><a class="anchor" href="#jwtGuides"></a>11.3.10 Guides</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/jwt/jwtGuides.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Read the following guides to learn more about JSON Web Token and JSON Web Keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-cli-jwkgen.html">JWK generation with a micronaut command line application</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-security-keys-jwks.html">JWK keys endpoint</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-security-jwt.html">Micronaut JWT authentication</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-security-jwt-cookie.html">Micronaut JWT authentication via cookies</a></p>
</li>
</ul>
</div>

<h2 id="ldap"><a class="anchor" href="#ldap"></a>11.4 LDAP Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/ldap.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports authentication with LDAP out of the box. To get started, add the <code>security-ldap</code> dependency to your application.</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">compile "io.micronaut.security:micronaut-security-ldap"</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="https://guides.micronaut.io/latest/micronaut-database-authentication-provider.html">LDAP and Database authentication providers</a> to see an example.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>LDAP authentication can be globally disabled by setting <code>micronaut.security.ldap.enabled</code> to <code>false</code>, or on a provider
basis, eg <code>micronaut.security.ldap.default.enabled: false</code>.</p>
</div>

<h2 id="configuration"><a class="anchor" href="#configuration"></a>11.4.1 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/ldap/configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The LDAP authentication in Micronaut supports configuration of one or more LDAP servers to authenticate with. Each server has it&#8217;s own settings and can be enabled or disabled.</p>
</div>
<a id="io.micronaut.security.ldap.configuration.LdapConfiguration" href="#io.micronaut.security.ldap.configuration.LdapConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/ldap/configuration/LdapConfiguration.html">LdapConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether this configuration is enabled. Default true.</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.ldap.configuration.LdapConfiguration$ContextConfiguration" href="#io.micronaut.security.ldap.configuration.LdapConfiguration$ContextConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/ldap/configuration/LdapConfiguration.ContextConfiguration.html">LdapConfiguration$ContextConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.context.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.context.manager-dn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.context.manager-password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.context.factory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.context.properties</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.ldap.configuration.LdapConfiguration$SearchConfiguration" href="#io.micronaut.security.ldap.configuration.LdapConfiguration$SearchConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Configuration Properties for <a href="../api/io/micronaut/security/ldap/configuration/LdapConfiguration.SearchConfiguration.html">LdapConfiguration$SearchConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.search.subtree</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.search.base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.search.filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.search.attributes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.ldap.configuration.LdapConfiguration$GroupConfiguration" href="#io.micronaut.security.ldap.configuration.LdapConfiguration$GroupConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Configuration Properties for <a href="../api/io/micronaut/security/ldap/configuration/LdapConfiguration.GroupConfiguration.html">LdapConfiguration$GroupConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.groups.subtree</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.groups.base</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.groups.filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.groups.attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.groups.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets if group search is enabled. Default false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.ldap.*.groups.filter-attribute</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The argument to pass to the search filter.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To connect to an LDAP server with SSL, set the standard Java system properties to the values appropriate for your server.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-Djavax.net.ssl.trustStore="&lt;path to truststore file&gt;"
-Djavax.net.ssl.trustStorePassword="&lt;passphrase for truststore&gt;"</code></pre>
</div>
</div>

<h2 id="extending"><a class="anchor" href="#extending"></a>11.4.2 Extending Default Behavior</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/ldap/extending.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This section will outline some common requirements that will require custom code to implement and describe what to do in those cases.</p>
</div>
<div class="sect1">
<h2 id="_authentication_data">Authentication Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The authentication object returned from a successful authentication request is by default an instance of <code>Authentication</code>, which only contains the username and any roles associated with the user. You can use <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> <code>attributes</code> to store additional data. Replace <a href="../api/io/micronaut/security/ldap/DefaultContextAuthenticationMapper.html">DefaultContextAuthenticationMapper</a> and provide your own implementation.</p>
</div>
<div class="listingblock">
<div class="title">MyContextAuthenticationMapper.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultContextAuthenticationMapper.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class MyContextAuthenticationMapper implements ContextAuthenticationMapper {

    @Override
    public AuthenticationResponse map(ConvertibleValues&lt;Object&gt; attributes, String username, Set&lt;String&gt; groups) {
        // return an Authentication instance (Authentication::build methods) or an AuthenticationFailed object
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The usage of @Replaces will allow your bean to replace the default implementation in the context</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_groups">Groups</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default the groups found in LDAP, if enabled, will be returned as is without any processing. No additional groups from any other sources will be added to the list. It is a common requirement to retrieve additional groups from other sources, or to normalize the names of the groups in a specific format.</p>
</div>
<div class="paragraph">
<p>To extend this behavior, it is necessary to create your own implementation of <a href="../api/io/micronaut/security/ldap/group/LdapGroupProcessor.html">LdapGroupProcessor</a>. Likely it will be desired to extend the default implementation because it has the logic for querying the groups from LDAP and executes the other methods to process the groups and query for additional groups.</p>
</div>
<div class="listingblock">
<div class="title">MyLdapGroupProcessor.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultLdapGroupProcessor.class) <i class="conum" data-value="1"></i><b>(1)</b>
public class MyLdapGroupProcessor extends DefaultLdapGroupProcessor {

    Set&lt;String&gt; getAdditionalGroups(LdapSearchResult result) { <i class="conum" data-value="2"></i><b>(2)</b>
        //Use the result to query another source for additional groups (database, etc)
    }

    Optional&lt;String&gt; processGroup(String group) { <i class="conum" data-value="3"></i><b>(3)</b>
        //convert "Admin" to "ROLE_ADMIN" for example
        //return an empty optional to exclude the group
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The usage of @Replaces will allow your bean to replace the default implementation in the context</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../api/io/micronaut/security/ldap/group/LdapGroupProcessor.html#getAdditionalGroups-io.micronaut.security.ldap.context.LdapSearchResult-">getAdditionalGroups</a> method allows you to add groups from other sources</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="../api/io/micronaut/security/ldap/group/LdapGroupProcessor.html#processGroup-java.lang.String-">processGroup</a> method allows you to transform the name of the group, or exclude it</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_search_logic">Search Logic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To customize how LDAP searches are done, replace the default implementation with your own. See <a href="../api/io/micronaut/security/ldap/context/LdapSearchService.html">LdapSearchService</a>.</p>
</div>
<div class="listingblock">
<div class="title">MyLdapSearchService.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultLdapSearchService.class)
public class MyLdapSearchService implements LdapSearchService {

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_context_building">Context Building</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To customize how the LDAP context is built, replace the default implementation with your own. See <a href="../api/io/micronaut/security/ldap/context/ContextBuilder.html">ContextBuilder</a>.</p>
</div>
<div class="listingblock">
<div class="title">MyContextBuilder.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
@Replaces(DefaultContextBuilder.class)
public class MyContextBuilder implements ContextBuilder {

}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read <a href="https://guides.micronaut.io/latest/micronaut-database-authentication-provider.html">LDAP and database authentication providers</a> to learn more about LDAP Authentication:
</td>
</tr>
</table>
</div>
</div>
</div>

<h2 id="x509"><a class="anchor" href="#x509"></a>11.5 X.509 Certificate Authentication</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/x509.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Security supports using <a href="https://en.wikipedia.org/wiki/X.509#Certificates">X.509 client certificates</a> with HTTPS to enable <a href="https://en.wikipedia.org/wiki/Mutual_authentication">mutual authentication</a>.</p>
</div>
<div class="paragraph">
<p>Once you have <a href="https://docs.micronaut.io/latest/guide/#https">configured HTTPS</a> in your application, users can install X.509 browser certificates to provide authentication information and access restricted URLs.</p>
</div>
<div class="paragraph">
<p>When X.509 is enabled, in addition to the client (e.g. browser or API client) verifying that the server certificate is valid (i.e. that it was issued and signed by a trusted certificate authority (CA)), the server can also verify the client with the certificate from the client SSL handshake. If the client certificate is valid and contains a username/principal that corresponds to an application user, access will be granted.</p>
</div>
<div class="sect2">
<h3 id="_configuration">Configuration</h3>
<div class="paragraph">
<p>There are two configuration options as seen in the following table:</p>
</div>
<a id="io.micronaut.security.x509.X509ConfigurationProperties" href="#io.micronaut.security.x509.X509ConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/x509/X509ConfigurationProperties.html">X509ConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.x509.subject-dn-regex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the Subject DN regex. Default value "CN=(.*?)(?:,</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">$)".</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.x509.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use <code>micronaut.security.x509.enabled</code> to enable X.509 support, or enable per-environment.</p>
</div>
<div class="paragraph">
<p>Use the <code>micronaut.security.x509.subject-dn-regex</code> property to override the default regular expression used to extract the principal (username) from the certificate. Typically, the principal is stored in the <code>CN</code> (Common Name) property, prefixed with <code>"CN="</code>. The default regular expression <code>"CN=(.*?)(?:,|$)"</code> will extract the text after <code>"CN="</code> and up to the next (optional) delimiter, but if your certificates are configured differently, override the regex as needed.</p>
</div>
<div class="paragraph">
<p>In addition to X.509-specific configuration, you must also <a href="https://docs.micronaut.io/latest/guide/#https">configure HTTPS</a> for your server, and configure requesting client certificates during the SSL handshake. Set the value of the property <code>micronaut.server.ssl.client-authentication</code> to <code>want</code> or <code>need</code> (depending on whether client certificates are optional or required).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a sample configuration enabling and configuring HTTPS and X.509:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=your_application_name
micronaut.security.x509.enabled=true
micronaut.ssl.enabled=true
micronaut.server.ssl.client-authentication=want
micronaut.server.ssl.key-store.path=classpath:ssl/keystore.p12
micronaut.server.ssl.key-store.password=your_keystore_password
micronaut.server.ssl.key-store.type=PKCS12
micronaut.server.ssl.trust-store.path=classpath:ssl/truststore.jks
micronaut.server.ssl.trust-store.password=your_truststore_password
micronaut.server.ssl.trust-store.type=JKS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  application:
    name: your_application_name
  security:
    x509:
      enabled: true
  ssl:
    enabled: true
  server:
    ssl:
      client-authentication: want # or 'need'
      key-store:
        path: classpath:ssl/keystore.p12
        password: your_keystore_password
        type: PKCS12
      trust-store:
        path: classpath:ssl/truststore.jks
        password: your_truststore_password
        type: JKS</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="your_application_name"
  [micronaut.security]
    [micronaut.security.x509]
      enabled=true
  [micronaut.ssl]
    enabled=true
  [micronaut.server]
    [micronaut.server.ssl]
      client-authentication="want"
      [micronaut.server.ssl.key-store]
        path="classpath:ssl/keystore.p12"
        password="your_keystore_password"
        type="PKCS12"
      [micronaut.server.ssl.trust-store]
        path="classpath:ssl/truststore.jks"
        password="your_truststore_password"
        type="JKS"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "your_application_name"
  }
  security {
    x509 {
      enabled = true
    }
  }
  ssl {
    enabled = true
  }
  server {
    ssl {
      clientAuthentication = "want"
      keyStore {
        path = "classpath:ssl/keystore.p12"
        password = "your_keystore_password"
        type = "PKCS12"
      }
      trustStore {
        path = "classpath:ssl/truststore.jks"
        password = "your_truststore_password"
        type = "JKS"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "your_application_name"
    }
    security {
      x509 {
        enabled = true
      }
    }
    ssl {
      enabled = true
    }
    server {
      ssl {
        client-authentication = "want"
        key-store {
          path = "classpath:ssl/keystore.p12"
          password = "your_keystore_password"
          type = "PKCS12"
        }
        trust-store {
          path = "classpath:ssl/truststore.jks"
          password = "your_truststore_password"
          type = "JKS"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "your_application_name"
    },
    "security": {
      "x509": {
        "enabled": true
      }
    },
    "ssl": {
      "enabled": true
    },
    "server": {
      "ssl": {
        "client-authentication": "want",
        "key-store": {
          "path": "classpath:ssl/keystore.p12",
          "password": "your_keystore_password",
          "type": "PKCS12"
        },
        "trust-store": {
          "path": "classpath:ssl/truststore.jks",
          "password": "your_truststore_password",
          "type": "JKS"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="https://guides.micronaut.io/latest/micronaut-security-x509.html">X.509 Authentication Micronaut Guide</a> to learn about configuring applications to use X.509 and how to create the various certificates for testing.
</td>
</tr>
</table>
</div>
</div>

<h2 id="custom"><a class="anchor" href="#custom"></a>11.6 Custom Authorization Strategies</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/authenticationStrategies/custom.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All authorization strategies implement the <a href="../api/io/micronaut/security/filters/AuthenticationFetcher.html">AuthenticationFetcher</a> interface. The contract is designed to return an <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> from the request. To implement custom logic to retrieve the currently logged in user, simply create a bean that implements the contract and it will be picked up automatically.</p>
</div>
<div class="paragraph">
<p>For example, if you use a product like <a href="https://www.broadcom.com/products/cyber-security/identity/siteminder">SiteMinder</a> that handles authentication for you, you can trust that users access your application are authenticated, and you can access their username via the <code>SM_USER</code> request header and build an <code>Authentication</code> from that:</p>
</div>
<div class="listingblock">
<div class="title">SiteMinder Authentication Fetcher</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.core.util.StringUtils;
import io.micronaut.http.HttpRequest;
import io.micronaut.security.authentication.Authentication;
import io.micronaut.security.filters.AuthenticationFetcher;
import jakarta.inject.Singleton;
import java.util.Collection;
import java.util.Collections;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Mono;
@Singleton
public class SiteminderAuthenticationFetcher implements AuthenticationFetcher&lt;HttpRequest&lt;?&gt;&gt; {

    public static final String SITEMINDER_USER_HEADER = "SM_USER";

    @Override
    public Publisher&lt;Authentication&gt; fetchAuthentication(HttpRequest&lt;?&gt; request) {
        return Mono.&lt;Authentication&gt;create(emitter -&gt; {
            String siteminderUser = request.getHeaders().get(SITEMINDER_USER_HEADER);
            if (StringUtils.isEmpty(siteminderUser)) {
                emitter.success();
                return;
            }

            Collection&lt;String&gt; roles = Collections.singleton("ROLE_USER");
            emitter.success(Authentication.build(siteminderUser, roles));
        });
    }
}</code></pre>
</div>
</div>

<h1 id="rejection"><a class="anchor" href="#rejection"></a>12 Rejection Handling</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/rejection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut allows the customization of the response that is sent when a request is not authorized to access a resource, or is not authenticated and the resource requires authentication.</p>
</div>
<div class="paragraph">
<p>When a request is rejected, the security filter emits an <a href="../api/io/micronaut/security/authentication/AuthorizationException.html">AuthorizationException</a>. The default implementation (<a href="../api/io/micronaut/security/authentication/DefaultAuthorizationExceptionHandler.html">DefaultAuthorizationExceptionHandler</a>) redirects based on the redirect configuration only if the request accepts text/html:</p>
</div>
<a id="io.micronaut.security.config.RedirectConfigurationProperties" href="#io.micronaut.security.config.RedirectConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/config/RedirectConfigurationProperties.html">RedirectConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.login-success</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the user is redirected to after a successful login. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.login-failure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where the user is redirected to after a failed login. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.logout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL where the user is redirected after logout. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.prior-to-login</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the user should be redirected back to the unauthorized
 request that initiated the login flow. Supersedes the &lt;code&gt;login-success&lt;/code&gt;
 configuration for those cases. Default value false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.redirect.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether Redirection configuration enabled. Default value (true).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For an unauthorized request, a 401 http response will be sent if <code>unauthorized.enabled</code> is false, or the request does not accept text/html.</p>
</div>
<div class="paragraph">
<p>For a rejected request, a 403 http response will be sent if <code>forbidden.enabled</code> is false, or the request does not accept text/html.</p>
</div>
<div class="paragraph">
<p>To fully customize the behavior, replace the relevant bean with your own implementation.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Replaces;
import io.micronaut.context.annotation.Requires;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.server.exceptions.response.ErrorResponseProcessor;
import io.micronaut.security.authentication.AuthorizationException;
import io.micronaut.security.authentication.DefaultAuthorizationExceptionHandler;
import io.micronaut.security.config.RedirectConfiguration;
import io.micronaut.security.config.RedirectService;
import io.micronaut.security.errors.PriorToLoginPersistence;
import jakarta.inject.Singleton;

@Singleton
@Replaces(DefaultAuthorizationExceptionHandler.class)
public class MyRejectionHandler extends DefaultAuthorizationExceptionHandler {

    public MyRejectionHandler(ErrorResponseProcessor&lt;?&gt; errorResponseProcessor,
                              RedirectConfiguration redirectConfiguration,
                              RedirectService redirectService,
                              @Nullable PriorToLoginPersistence priorToLoginPersistence) {
        super(errorResponseProcessor, redirectConfiguration, redirectService, priorToLoginPersistence);
    }

    @Override
    public MutableHttpResponse&lt;?&gt; handle(HttpRequest request, AuthorizationException exception) {
        //Let the DefaultAuthorizationExceptionHandler create the initial response
        //then add a header
        return super.handle(request, exception).header("X-Reason", "Example Header");
    }
}</code></pre>
</div>
</div>

<h1 id="tokenPropagation"><a class="anchor" href="#tokenPropagation"></a>13 Token Propagation</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/tokenPropagation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Imagine you have a Gateway microservice which consumes three other microservices:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/tokenpropagation.svg" alt="tokenpropagation">
</div>
</div>
<div class="paragraph">
<p>If the incoming request <code>localhost:8080/api/books</code> contains a valid JWT token, you may want to propagate
that token to other requests in your network.</p>
</div>
<div class="paragraph">
<p>You can configure token propagation to achieve that.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.application.name=gateway
micronaut.security.token.jwt.signatures.secret.generator.secret=pleaseChangeThisSecretForANewOne
micronaut.security.token.jwt.signatures.secret.generator.jws-algorithm=HS256
micronaut.security.token.propagation.header.enabled=true
micronaut.security.token.propagation.header.headerName=Authorization
micronaut.security.token.propagation.header.prefix=Bearer
micronaut.security.token.propagation.enabled=true
micronaut.security.token.propagation.service-id-regex=http://localhost:(8083|8081|8082)</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    application:
        name: gateway
    security:
        token:
            jwt:
                signatures:
                    secret:
                        generator:
                            secret: "pleaseChangeThisSecretForANewOne"
                            jws-algorithm: HS256
            propagation:
                header:
                    enabled: true
                    headerName: "Authorization"
                    prefix: "Bearer "
                enabled: true
                service-id-regex: "http://localhost:(8083|8081|8082)"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.application]
    name="gateway"
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.signatures]
          [micronaut.security.token.jwt.signatures.secret]
            [micronaut.security.token.jwt.signatures.secret.generator]
              secret="pleaseChangeThisSecretForANewOne"
              jws-algorithm="HS256"
      [micronaut.security.token.propagation]
        enabled=true
        service-id-regex="http://localhost:(8083|8081|8082)"
        [micronaut.security.token.propagation.header]
          enabled=true
          headerName="Authorization"
          prefix="Bearer "</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  application {
    name = "gateway"
  }
  security {
    token {
      jwt {
        signatures {
          secret {
            generator {
              secret = "pleaseChangeThisSecretForANewOne"
              jwsAlgorithm = "HS256"
            }
          }
        }
      }
      propagation {
        header {
          enabled = true
          headerName = "Authorization"
          prefix = "Bearer "
        }
        enabled = true
        serviceIdRegex = "http://localhost:(8083|8081|8082)"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    application {
      name = "gateway"
    }
    security {
      token {
        jwt {
          signatures {
            secret {
              generator {
                secret = "pleaseChangeThisSecretForANewOne"
                jws-algorithm = "HS256"
              }
            }
          }
        }
        propagation {
          header {
            enabled = true
            headerName = "Authorization"
            prefix = "Bearer "
          }
          enabled = true
          service-id-regex = "http://localhost:(8083|8081|8082)"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "application": {
      "name": "gateway"
    },
    "security": {
      "token": {
        "jwt": {
          "signatures": {
            "secret": {
              "generator": {
                "secret": "pleaseChangeThisSecretForANewOne",
                "jws-algorithm": "HS256"
              }
            }
          }
        },
        "propagation": {
          "header": {
            "enabled": true,
            "headerName": "Authorization",
            "prefix": "Bearer "
          },
          "enabled": true,
          "service-id-regex": "http://localhost:(8083|8081|8082)"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The previous configuration, configures a <a href="../api/io/micronaut/security/token/propagation/HttpHeaderTokenPropagator.html">HttpHeaderTokenPropagator</a> and a
and a propagation filter, <a href="../api/io/micronaut/security/token/propagation/TokenPropagationHttpClientFilter.html">TokenPropagationHttpClientFilter</a>, which
will propagate the security token seamlessly.</p>
</div>
<div class="paragraph">
<p>If you use <a href="https://micronaut-projects.github.io/micronaut-core/latest/guide/#serviceDiscovery">Service Discovery</a> features, you can use the service id in your service id regular expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">micronaut.security.token.propagation.service-id-regex="catalogue|recommendations|inventory"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Several configuration options are available:</p>
</div>
<a id="io.micronaut.security.token.propagation.TokenPropagationConfigurationProperties" href="#io.micronaut.security.token.propagation.TokenPropagationConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/propagation/TokenPropagationConfigurationProperties.html">TokenPropagationConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.service-id-regex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.uri-regex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.service-id-pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.regex.Pattern</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.uri-pattern</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.regex.Pattern</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables <a href="../api/io/micronaut/security/token/propagation/TokenPropagationHttpClientFilter.html">TokenPropagationHttpClientFilter</a>. Default value false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For propagation via an HTTP Header, you can configure:</p>
</div>
<a id="io.micronaut.security.token.propagation.HttpHeaderTokenPropagatorConfigurationProperties" href="#io.micronaut.security.token.propagation.HttpHeaderTokenPropagatorConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/token/propagation/HttpHeaderTokenPropagatorConfigurationProperties.html">HttpHeaderTokenPropagatorConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.header.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable <a href="../api/io/micronaut/security/token/propagation/HttpHeaderTokenPropagator.html">HttpHeaderTokenPropagator</a>. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.header.prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.propagation.header.header-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <a href="https://guides.micronaut.io/latest/micronaut-token-propagation.html">Token Propagation tutorial</a> to learn more.
</td>
</tr>
</table>
</div>

<h1 id="tokenendpoints"><a class="anchor" href="#tokenendpoints"></a>14 Built-In Security Token Controllers</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/tokenendpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="refresh"><a class="anchor" href="#refresh"></a>14.1 Refresh Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/tokenendpoints/refresh.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The refresh token functionality has changed dramatically starting in Micronaut Security 2.0. Please read this section if you are upgrading as it now behaves differently.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Refresh tokens can be used to obtain a new access token. By default, refresh tokens are not generated.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/token/generator/RefreshTokenGenerator.html">RefreshTokenGenerator</a> API is responsible for generating the token that gets included in the response. The <a href="../api/io/micronaut/security/token/validator/RefreshTokenValidator.html">RefreshTokenValidator</a> is responsible for validating the refresh token. Note that this validation step is not related to the persistence of the token, but instead is intended to verify the token is not a random/guessed value.</p>
</div>
<div class="paragraph">
<p>An implementation of both <a href="../api/io/micronaut/security/token/generator/RefreshTokenGenerator.html">RefreshTokenGenerator</a> and  <a href="../api/io/micronaut/security/token/validator/RefreshTokenValidator.html">RefreshTokenValidator</a> has been provided by default. The <a href="../api/io/micronaut/security/token/jwt/generator/SignedRefreshTokenGenerator.html">SignedRefreshTokenGenerator</a> creates and verifies a JWS (JSON web signature) encoded object whose payload is a UUID with a hash-based message authentication code (HMAC). See the following configuration options:</p>
</div>
<a id="io.micronaut.security.token.jwt.generator.RefreshTokenConfigurationProperties" href="#io.micronaut.security.token.jwt.generator.RefreshTokenConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/jwt/generator/RefreshTokenConfigurationProperties.html">RefreshTokenConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.generator.refresh-token.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether <a href="../api/io/micronaut/security/token/jwt/generator/SignedRefreshTokenGenerator.html">SignedRefreshTokenGenerator</a> is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.generator.refresh-token.jws-algorithm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">com.nimbusds.jose.JWSAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{@link com.nimbusds.jose.JWSAlgorithm}. Defaults to HS256</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.generator.refresh-token.secret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">shared secret. For HS256 must be at least 256 bits.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.token.jwt.generator.refresh-token.base64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the supplied secret is base64 encoded. Default value false.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To enable it, you must provide a secret:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.token.jwt.generator.refresh-token.secret=pleaseChangeThisSecretForANewOne</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    security:
        token:
            jwt:
                generator:
                    refresh-token:
                        secret: 'pleaseChangeThisSecretForANewOne'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.token]
      [micronaut.security.token.jwt]
        [micronaut.security.token.jwt.generator]
          [micronaut.security.token.jwt.generator.refresh-token]
            secret="pleaseChangeThisSecretForANewOne"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    token {
      jwt {
        generator {
          refreshToken {
            secret = "pleaseChangeThisSecretForANewOne"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      token {
        jwt {
          generator {
            refresh-token {
              secret = "pleaseChangeThisSecretForANewOne"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "token": {
        "jwt": {
          "generator": {
            "refresh-token": {
              "secret": "pleaseChangeThisSecretForANewOne"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>After a token is generated, this library has no knowledge of it. The value is not cached or stored anywhere. It is up to each application to decide how to store the token, support revocation, and retrieve user details when given a token.</p>
</div>
<div class="paragraph">
<p>In addition to the above requirements, each application must provide an implementation of <a href="../api/io/micronaut/security/token/refresh/RefreshTokenPersistence.html">RefreshTokenPersistence</a>.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/token/refresh/RefreshTokenPersistence.html">RefreshTokenPersistence</a> implementation will receive an event when a refresh token is generated and then is responsible for persisting the token along with a link to the user that it was generated for. The user information and the token are both available in the <a href="../api/io/micronaut/security/token/event/RefreshTokenGeneratedEvent.html">RefreshTokenGeneratedEvent</a>.</p>
</div>
<div class="sect2">
<h3 id="_refreshing_the_token">Refreshing the Token</h3>
<div class="paragraph">
<p>Micronaut security comes with a controller to allow for the refresh of access tokens. The context loads the <a href="../api/io/micronaut/security/token/jwt/endpoints/OauthController.html">OauthController</a> if your context contains beans of type: <a href="../api/io/micronaut/security/token/jwt/generator/AccessRefreshTokenGenerator.html">AccessRefreshTokenGenerator</a>, <a href="../api/io/micronaut/security/token/refresh/RefreshTokenPersistence.html">RefreshTokenPersistence</a>, <a href="../api/io/micronaut/security/token/validator/RefreshTokenValidator.html">RefreshTokenValidator</a></p>
</div>
<div class="paragraph">
<p>Moreover, the controller can be configured with:</p>
</div>
<a id="io.micronaut.security.endpoints.OauthControllerConfigurationProperties" href="#io.micronaut.security.endpoints.OauthControllerConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/endpoints/OauthControllerConfigurationProperties.html">OauthControllerConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.oauth.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.oauth.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the path to map the {@link OauthController} to. Default value ("/oauth/access_token").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.oauth.get-allowed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The controller exposes an endpoint as defined by <a href="https://tools.ietf.org/html/rfc6749#section-6">section 6 of the OAuth 2.0 spec</a> - Refreshing an Access Token.</p>
</div>
<div class="paragraph">
<p>The refresh token endpoint uses the <a href="../api/io/micronaut/security/token/validator/RefreshTokenValidator.html">RefreshTokenValidator</a> API to verify the token matches the format that is expected. <a href="../api/io/micronaut/security/token/jwt/generator/SignedRefreshTokenGenerator.html">SignedRefreshTokenGenerator</a> attempts to verify the signature and returns the payload. Any validator implementations should not be concerned with revocation status, existence, or any other persistence related validation.</p>
</div>
<div class="paragraph">
<p>If the validator successfully validates the token, it is then passed to a <a href="../api/io/micronaut/security/token/refresh/RefreshTokenPersistence.html">RefreshTokenPersistence</a> implementation, which each application must provide. A new access token is then created from the user details returned by <code>RefreshTokenPersistence::getAuthentication</code> and then sent in the response.</p>
</div>
<div class="paragraph">
<p>Here is an example of a refresh token request. Send a POST request to the <code>/oauth/access_token</code> endpoint:</p>
</div>
<div class="listingblock">
<div class="title">Sample HTTP request to obtain an access token</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">POST /oauth/access_token HTTP/1.1
Host: micronaut.example
Content-Type: application/x-www-form-urlencoded

grant_type=refresh_token&amp;refresh_token=eyJhbGciOiJSU0EtT0FFUCIsImVuYyI6IkEyNTZHQ00ifQ....</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, is a form request with 2 parameters:</p>
</div>
<div class="paragraph">
<p><code>grant_type</code>: must be <code>refresh_token</code> always.</p>
</div>
<div class="paragraph">
<p><code>refresh_token</code>: the refresh token obtained previously.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Refresh tokens must be securely stored in your client application.
See <a href="https://tools.ietf.org/html/rfc6749#section-10.4">section 10.4 of the OAuth 2.0 spec</a> for more information.
</td>
</tr>
</table>
</div>
</div>

<h2 id="keys"><a class="anchor" href="#keys"></a>14.2 Keys Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/tokenendpoints/keys.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This controller can only be enabled if you are using JWT authentication.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A <a href="https://tools.ietf.org/html/rfc7517">JSON Web Key (JWK)</a> is a JSON object that represents a cryptographic key. The members of the object represent properties of the key, including its value.</p>
</div>
<div class="paragraph">
<p>Meanwhile, a JWK Set is a JSON object that represents a set of JWKs. The JSON object MUST have a "keys" member, which is an array of JWKs.</p>
</div>
<div class="paragraph">
<p>To enable the <a href="../api/io/micronaut/security/token/jwt/endpoints/KeysController.html">KeysController</a> you have to provide at least a bean of type: <a href="../api/io/micronaut/security/token/jwt/endpoints/JwkProvider.html">JwkProvider</a>.</p>
</div>
<div class="paragraph">
<p>Moreover, you can configure it with:</p>
</div>
<a id="io.micronaut.security.token.jwt.endpoints.KeysControllerConfigurationProperties" href="#io.micronaut.security.token.jwt.endpoints.KeysControllerConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/token/jwt/endpoints/KeysControllerConfigurationProperties.html">KeysControllerConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.keys.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.keys.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the <a href="../api/io/micronaut/security/token/jwt/endpoints/KeysController.html">KeysController</a>. Default value "/keys".</p></td>
</tr>
</tbody>
</table>

<h2 id="introspectionendpoint"><a class="anchor" href="#introspectionendpoint"></a>14.3 Introspection Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/tokenendpoints/introspectionendpoint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The <a href="https://tools.ietf.org/html/rfc7662#section-5.1">Introspection endpoint</a> exposes an endpoint to inquire the current state of a token.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">POST /token_info
Accept: application/json
Content-Type: application/x-www-form-urlencoded
Authorization: Basic dXNlcjpwYXNzd29yZA==
token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImp0aSI6IjM1NjhjM2EzLWFlMmMtNDFiMy1hYzU5LTU0ZTkxODVkM2ViOCIsImlhdCI6MTYwMTA0OTU5OCwiZXhwIjoxNjAxMDUzMTk4fQ.Sc5Xh7jI6e_F3FAUo3n3AUCHNSxWH8t-WlM6JxeHZGI&amp;token_type_hint=access_token</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, you can access a secured GET endpoint which responds the introspection response for the authenticated user:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">GET /token_info
Accept: application/json
Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImp0aSI6IjM1NjhjM2EzLWFlMmMtNDFiMy1hYzU5LTU0ZTkxODVkM2ViOCIsImlhdCI6MTYwMTA0OTU5OCwiZXhwIjoxNjAxMDUzMTk4fQ.Sc5Xh7jI6e_F3FAUo3n3AUCHNSxWH8t-WlM6JxeHZGI</code></pre>
</div>
</div>
<div class="paragraph">
<p>responds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
 "active": false
 "username": "1234567890",
 "sub": "1234567890",
 "name": "John Doe",
 "admin": true,
 "jti": "3568c3a3-ae2c-41b3-ac59-54e9185d3eb8",
 "iat": 1601049598,
 "exp": 1601053198
}</code></pre>
</div>
</div>
<a id="io.micronaut.security.endpoints.introspection.IntrospectionConfigurationProperties" href="#io.micronaut.security.endpoints.introspection.IntrospectionConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/endpoints/introspection/IntrospectionConfigurationProperties.html">IntrospectionConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.introspection.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.endpoints.introspection.path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the <a href="../api/io/micronaut/security/endpoints/introspection/IntrospectionController.html">IntrospectionController</a>. Default value "/token_info"</p></td>
</tr>
</tbody>
</table>

<h1 id="retrievingAuthenticatedUser"><a class="anchor" href="#retrievingAuthenticatedUser"></a>15 Retrieve the authenticated user</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/retrievingAuthenticatedUser.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Often you may want to retrieve the authenticated user.</p>
</div>
<div class="paragraph">
<p>You can bind <code>java.security.Principal</code> as a method&#8217;s parameter in a controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Nullable
import io.micronaut.core.util.CollectionUtils
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.security.annotation.Secured

import java.security.Principal


@Controller("/user")
public class UserController {

    @Secured("isAnonymous()")
    @Get("/myinfo")
    public Map myinfo(@Nullable Principal principal) {
        if (principal == null) {
            return Collections.singletonMap("isLoggedIn", false);
        }
        return CollectionUtils.mapOf("isLoggedIn", true, "username", principal.getName());
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need a greater level of detail, you can bind <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>  as a method&#8217;s parameter in a controller.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Nullable
import io.micronaut.core.util.CollectionUtils
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.micronaut.security.annotation.Secured
import io.micronaut.security.authentication.Authentication


@Controller("/user")
class UserController {

    @Secured("isAnonymous()")
    @Get("/myinfo")
    Map myinfo(@Nullable Authentication authentication) {
        if (authentication == null) {
            return Collections.singletonMap("isLoggedIn", false);
        }
        return CollectionUtils.mapOf("isLoggedIn", true,
                "username", authentication.getName(),
                "roles", authentication.getRoles()
        );
    }
}</code></pre>
</div>
</div>

<h2 id="customAuthenticatedUser"><a class="anchor" href="#customAuthenticatedUser"></a>15.1 Custom Binding</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/retrievingAuthenticatedUser/customAuthenticatedUser.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can create a custom argument binder to bind the authenticated user to a custom class tailored to your application needs.</p>
</div>
<div class="paragraph">
<p>If, in your application, the authenticated user has an email address, you can create a class such as:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.micronaut.security.docs.customauthentication;

import io.micronaut.security.authentication.Authentication;
import io.micronaut.serde.annotation.Serdeable;

@Serdeable
public record AuthenticationWithEmail(String username,
                                      String email) {
    public static AuthenticationWithEmail of(Authentication authentication) {
        Object obj = authentication.getAttributes().get("email");
        String email = obj == null ? null : obj.toString();
        return new AuthenticationWithEmail(authentication.getName(), email);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package io.micronaut.security.docs.customauthentication

import groovy.transform.Canonical
import io.micronaut.security.authentication.Authentication
import io.micronaut.serde.annotation.Serdeable

@Canonical
@Serdeable
class AuthenticationWithEmail {
    String username
    String email

    static AuthenticationWithEmail of(Authentication authentication) {
        new AuthenticationWithEmail(authentication.getName(), authentication.getAttributes().get("email")?.toString())
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package io.micronaut.security.docs.customauthentication

import io.micronaut.security.authentication.Authentication
import io.micronaut.serde.annotation.Serdeable

@Serdeable
data class AuthenticationWithEmail(val username: String, val email: String?) {
    companion object {
        fun of(authentication: Authentication): AuthenticationWithEmail {
            val obj = authentication.getAttributes()["email"]
            val email = obj?.toString()
            return AuthenticationWithEmail(authentication.name, email)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then a <code>TypedRequestArgumentBinder</code>:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package io.micronaut.security.docs.customauthentication;

import io.micronaut.context.annotation.Requires;
import io.micronaut.core.convert.ArgumentConversionContext;
import io.micronaut.core.type.Argument;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.bind.binders.TypedRequestArgumentBinder;
import io.micronaut.security.authentication.Authentication;
import io.micronaut.security.filters.SecurityFilter;
import jakarta.inject.Singleton;
import java.util.Optional;

@Requires(property = "spec.name", value = "CustomAuthenticationTest")
@Singleton
public class AuthenticationWithEmailArgumentBinder implements TypedRequestArgumentBinder&lt;AuthenticationWithEmail&gt; {
    private final Argument&lt;AuthenticationWithEmail&gt; argumentType;
    public AuthenticationWithEmailArgumentBinder() {
        argumentType = Argument.of(AuthenticationWithEmail.class);
    }

    @Override
    public Argument&lt;AuthenticationWithEmail&gt; argumentType() {
        return argumentType;
    }

    @Override
    public BindingResult&lt;AuthenticationWithEmail&gt; bind(ArgumentConversionContext&lt;AuthenticationWithEmail&gt; context, HttpRequest&lt;?&gt; source) {
        if (!source.getAttributes().contains(SecurityFilter.KEY)) {
            return BindingResult.UNSATISFIED;
        }
        final Optional&lt;Authentication&gt; existing = source.getUserPrincipal(Authentication.class);
        return existing.isPresent() ? (() -&gt; existing.map(AuthenticationWithEmail::of)) : BindingResult.EMPTY;
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package io.micronaut.security.docs.customauthentication

import io.micronaut.context.annotation.Requires
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.bind.binders.TypedRequestArgumentBinder
import io.micronaut.security.authentication.Authentication
import io.micronaut.security.filters.SecurityFilter
import jakarta.inject.Singleton

@Requires(property = "spec.name", value = "CustomAuthenticationTest")
@Singleton
class AuthenticationWithEmailArgumentBinder implements TypedRequestArgumentBinder&lt;AuthenticationWithEmail&gt; {
    private final Argument&lt;AuthenticationWithEmail&gt; argumentType;
    AuthenticationWithEmailArgumentBinder() {
        argumentType = Argument.of(AuthenticationWithEmail.class);
    }

    @Override
    Argument&lt;AuthenticationWithEmail&gt; argumentType() {
        return argumentType;
    }

    @Override
    BindingResult&lt;AuthenticationWithEmail&gt; bind(ArgumentConversionContext&lt;AuthenticationWithEmail&gt; context, HttpRequest&lt;?&gt; source) {
        if (!source.getAttributes().contains(SecurityFilter.KEY)) {
            return BindingResult.UNSATISFIED
        }
        final Optional&lt;Authentication&gt; existing = source.getUserPrincipal(Authentication.class)
        existing.isPresent() ? (() -&gt; existing.map(AuthenticationWithEmail::of)) : BindingResult.EMPTY
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">package io.micronaut.security.docs.customauthentication

import io.micronaut.context.annotation.Requires
import io.micronaut.core.bind.ArgumentBinder
import io.micronaut.core.convert.ArgumentConversionContext
import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.bind.binders.TypedRequestArgumentBinder
import io.micronaut.security.authentication.Authentication
import io.micronaut.security.filters.SecurityFilter
import jakarta.inject.Singleton

@Requires(property = "spec.name", value = "CustomAuthenticationTest")
@Singleton
class AuthenticationWithEmailArgumentBinder : TypedRequestArgumentBinder&lt;AuthenticationWithEmail&gt; {
    override fun bind(context: ArgumentConversionContext&lt;AuthenticationWithEmail&gt;, source: HttpRequest&lt;*&gt;): ArgumentBinder.BindingResult&lt;AuthenticationWithEmail&gt; {
        if (!source.attributes.contains(SecurityFilter.KEY)) {
            return ArgumentBinder.BindingResult.unsatisfied()
        }
        val existing = source.getUserPrincipal(Authentication::class.java)
        return if (existing.isPresent) ArgumentBinder.BindingResult {
            existing.map(AuthenticationWithEmail::of)
        } else ArgumentBinder.BindingResult.empty()
    }

    override fun argumentType(): Argument&lt;AuthenticationWithEmail&gt; {
        return Argument.of(AuthenticationWithEmail::class.java)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you can bind it in a controller method parameter:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">        @Secured(SecurityRule.IS_AUTHENTICATED)
        @Produces(MediaType.TEXT_PLAIN)
        @Get("/custom-authentication")
        String index(AuthenticationWithEmail authentication) {
            return authentication.email();
        }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">        @Secured(SecurityRule.IS_AUTHENTICATED)
        @Produces(MediaType.TEXT_PLAIN)
        @Get("/custom-authentication")
        String index(AuthenticationWithEmail authentication) {
            authentication.email
        }</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">        @Secured(SecurityRule.IS_AUTHENTICATED)
        @Produces(MediaType.TEXT_PLAIN)
        @Get("/custom-authentication")
        fun index(authentication: AuthenticationWithEmail) = authentication.email</code></pre>
</div>
</div>

<h2 id="securityService"><a class="anchor" href="#securityService"></a>15.2 User outside of a controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/retrievingAuthenticatedUser/securityService.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you need to access the currently authenticated user outside of a controller, you can inject <a href="../api/io/micronaut/security/utils/SecurityService.html">SecurityService</a> bean, which provides a set of convenient methods related to authentication and authorization.</p>
</div>
<div class="sect2">
<h3 id="_securityservice_with_project_reactor">SecurityService with Project Reactor</h3>
<div class="paragraph">
<p>If you use Micronaut Reactor and access <a href="../api/io/micronaut/security/utils/SecurityService.html">SecurityService</a> within a reactive chain,  add the following dependencies to handle the <a href="https://docs.micronaut.io/latest/guide/#reactorContextPropagation">Reactor Context Propagation</a>.</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.reactor:micronaut-security-reactor")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.reactor&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-security-reactor&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micrometer:context-propagation")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;context-propagation&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</div>

<h1 id="dataAuditing"><a class="anchor" href="#dataAuditing"></a>16 Data Change Auditing</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/dataAuditing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Security provides integration with <a href="https://micronaut-projects.github.io/micronaut-data/latest/guide/">Micronaut Data</a> for automatically capturing the identity of the user that created or updated a particular entity.</p>
</div>

<h2 id="annotations"><a class="anchor" href="#annotations"></a>16.1 Auditing Annotations</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/dataAuditing/annotations.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The annotations <a href="../api/io/micronaut/security/annotation/CreatedBy.html">@CreatedBy</a> and <a href="../api/io/micronaut/security/annotation/UpdatedBy.html">@UpdatedBy</a> annotations are provided for application to your Micronaut Data entities. The annotated fields will be automatically populated with the currently authenticated user&#8217;s identity. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.Nullable;
import io.micronaut.data.annotation.GeneratedValue;
import io.micronaut.data.annotation.Id;
import io.micronaut.data.annotation.MappedEntity;
import io.micronaut.security.annotation.CreatedBy;
import io.micronaut.security.annotation.UpdatedBy;
import jakarta.validation.constraints.NotBlank;

@MappedEntity //1
public record Book(
    @Id
    @GeneratedValue
    @Nullable
    Long id,

    @NotBlank
    String title,

    @NotBlank
    String author,

    @Nullable
    @CreatedBy //2
    String creator,

    @Nullable
    @UpdatedBy //3
    String editor) {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.core.annotation.Nullable
import io.micronaut.data.annotation.GeneratedValue
import io.micronaut.data.annotation.Id
import io.micronaut.data.annotation.MappedEntity
import io.micronaut.security.annotation.CreatedBy
import io.micronaut.security.annotation.UpdatedBy
import jakarta.validation.constraints.NotBlank

@MappedEntity //1
class Book {

    @Id
    @GeneratedValue
    @Nullable
    Long id

    @NotBlank
    String title

    @NotBlank
    String author

    @CreatedBy //2
    String creator

    @UpdatedBy //3
    String editor
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.data.annotation.GeneratedValue
import io.micronaut.data.annotation.Id
import io.micronaut.data.annotation.MappedEntity
import io.micronaut.security.annotation.CreatedBy
import io.micronaut.security.annotation.UpdatedBy

@MappedEntity //1
data class Book(
    @field:Id
    @field:GeneratedValue(GeneratedValue.Type.AUTO)
    var id: Long? = null,
    var title: String,
    var author: String,
    @field:CreatedBy //2
    var creator: String? = null,
    @UpdatedBy //3
    var editor: String? = null
)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is mapped and persisted by Micronaut Data</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The creator field will be populated on <code>save()</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The editor field will be populated on both <code>save()</code> and <code>update()</code></td>
</tr>
</table>
</div>

<h2 id="identityMapping"><a class="anchor" href="#identityMapping"></a>16.2 Custom Authentication Mapping</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/dataAuditing/identityMapping.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A <a href="../api/io/micronaut/security/audit/PrincipalToStringConverter.html">PrincipalToStringConverter</a> is provided to map the current <a href="../api/io/micronaut/security/Authentication.html">Authentication</a> object to the annotated String fields. The default implementation maps the value of <code>Principal.getName()</code> to the fields. To customize this mapping, you can provide your own <code>TypeConverter</code> implementation that replaces <code>PrincipalToStringConverter</code>. For example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.core.convert.ConversionContext;
import io.micronaut.core.convert.TypeConverter;
import io.micronaut.security.authentication.Authentication;
import jakarta.inject.Singleton;

import java.util.Optional;

@Singleton
public class AuthenticationToStringConverter implements TypeConverter&lt;Authentication, String&gt; { // <b class="conum">(1)</b>
    @Override
    public Optional&lt;String&gt; convert(Authentication authentication, Class&lt;String&gt; targetType, ConversionContext context) {
        return Optional.ofNullable(authentication.getAttributes().get("CUSTOM_ID_ATTR")).map(Object::toString); // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.TypeConverter
import io.micronaut.security.authentication.Authentication
import jakarta.inject.Singleton

@Singleton
class AuthenticationToStringConverter implements TypeConverter&lt;Authentication, String&gt; { // <b class="conum">(1)</b>
    @Override
    Optional&lt;String&gt; convert(Authentication authentication, Class&lt;String&gt; targetType, ConversionContext context) {
        Optional.ofNullable(authentication.attributes.get("CUSTOM_ID_ATTR")).map(Object::toString) // <b class="conum">(2)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.core.convert.ConversionContext
import io.micronaut.core.convert.TypeConverter
import io.micronaut.security.authentication.Authentication
import jakarta.inject.Singleton
import java.util.*

@Singleton
class AuthenticationToStringConverter : TypeConverter&lt;Authentication, String&gt; { // <b class="conum">(1)</b>
    override fun convert(
        authentication: Authentication,
        targetType: Class&lt;String&gt;,
        context: ConversionContext
    ): Optional&lt;String&gt; {
        return Optional.ofNullable(authentication.getAttributes()["CUSTOM_ID_ATTR"]).map { obj -&gt; obj.toString() } // <b class="conum">(3)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Conversion between <code>Authentication</code> and <code>String</code> is implemented</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The implementation maps a custom attribute to the auto-populated identity</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The type conversion mechanism could also be used to map <code>Authentication</code> to more complex field types other than String, such as a custom domain-specific <code>User</code> object.</p>
</div>

<h1 id="securityEvents"><a class="anchor" href="#securityEvents"></a>17 Security Events</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/securityEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut security classes generate several <a href="https://micronaut-projects.github.io/micronaut-core/latest/api/io/micronaut/context/event/ApplicationEvent.html">ApplicationEvent</a>s which you can subscribe to.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event Name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/LoginFailedEvent.html">LoginFailedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when an unsuccessful login takes place.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/LoginSuccessfulEvent.html">LoginSuccessfulEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a successful login takes place.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/LogoutEvent.html">LogoutEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when the user logs out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/event/TokenValidatedEvent.html">TokenValidatedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a token is validated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/event/AccessTokenGeneratedEvent.html">AccessTokenGeneratedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a JWT access token is generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/token/event/RefreshTokenGeneratedEvent.html">RefreshTokenGeneratedEvent</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triggered when a JWT refresh token is generated.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To learn how to listen for events, see the <a href="https://docs.micronaut.io/latest/guide/index.html#contextEvents">Context Events</a> section of the documentation.</p>
</div>

<h1 id="oauth"><a class="anchor" href="#oauth"></a>18 OAuth 2.0</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports authentication with OAuth 2.0 servers, including support for the OpenID standard.</p>
</div>
<div class="paragraph">
<p>The easiest way to get started is by configuring a provider that supports OpenID. Platforms such as <a href="https://developer.okta.com">Okta</a>, <a href="https://auth0.com">Auth0</a>, <a href="https://aws.amazon.com/cognito">AWS Cognito</a>, <a href="https://www.keycloak.org">Keycloak</a>, and <a href="https://developers.google.com/identity/protocols/OpenIDConnect">Google</a> are common examples.</p>
</div>
<div class="paragraph">
<p>Once you create an application client with a provider, you will get a client id and a client secret. The client id and secret combined with the issuer URL is all that is needed to enable the authentication code grant flow with an OpenID provider.</p>
</div>
<div class="paragraph">
<p>For example, to configure Google as a provider:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.clients.google.client-secret=&lt;&lt;your client secret&gt;&gt;
micronaut.security.oauth2.clients.google.client-id=&lt;&lt;your client id&gt;&gt;
micronaut.security.oauth2.clients.google.openid.issuer=https://accounts.google.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    oauth2:
      clients:
        google:
          client-secret: &lt;&lt;your client secret&gt;&gt;
          client-id: &lt;&lt;your client id&gt;&gt;
          openid:
            issuer: https://accounts.google.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.clients]
        [micronaut.security.oauth2.clients.google]
          client-secret="&lt;&lt;your client secret&gt;&gt;"
          client-id="&lt;&lt;your client id&gt;&gt;"
          [micronaut.security.oauth2.clients.google.openid]
            issuer="https://accounts.google.com"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      clients {
        google {
          clientSecret = "&lt;&lt;your client secret&gt;&gt;"
          clientId = "&lt;&lt;your client id&gt;&gt;"
          openid {
            issuer = "https://accounts.google.com"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        clients {
          google {
            client-secret = "&lt;&lt;your client secret&gt;&gt;"
            client-id = "&lt;&lt;your client id&gt;&gt;"
            openid {
              issuer = "https://accounts.google.com"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "clients": {
          "google": {
            "client-secret": "&lt;&lt;your client secret&gt;&gt;",
            "client-id": "&lt;&lt;your client id&gt;&gt;",
            "openid": {
              "issuer": "https://accounts.google.com"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>For normal OAuth 2.0, different steps are required to allow for the authorization code grant flow.</p>
</div>
<div class="paragraph">
<p>For the full authorization code flow to work there are also some additional requirements. A <a href="../api/io/micronaut/security/handlers/LoginHandler.html">LoginHandler</a> must be in the context to determine how to respond after a failed or successful login. A custom implementation can, of course, be provided. However, several <a href="#loginHandler">Login Handlers</a> implementations are available out of the box.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the following guides to learn more <strong>Secure a Micronaut app with <a href="https://guides.micronaut.io/latest/micronaut-oauth2-okta.html">Okta</a>, <a href="https://guides.micronaut.io/latest/micronaut-oauth2-cognito.html">Cognito</a>, <a href="https://guides.micronaut.io/latest/micronaut-oauth2-oidc-google.html">Google</a></strong>.
</td>
</tr>
</table>
</div>

<h2 id="installation"><a class="anchor" href="#installation"></a>18.1 Installation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/installation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-security-oauth2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-security-oauth2&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>To use the <code>BUILD-SNAPSHOT</code> version of this library, check the <a href="https://docs.micronaut.io/latest/guide/index.html#usingsnapshots">documentation to use snapshots</a>.</p>
</div>
<div class="paragraph">
<p>Code can be found at the <a href="https://github.com/micronaut-projects/micronaut-security/tree/master/security-oauth2">micronaut-security</a> repository.</p>
</div>

<h2 id="openid"><a class="anchor" href="#openid"></a>18.2 OpenID Connect</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/openid.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><a href="https://openid.net/connect/">OpenID Connect 1.0</a> is a simple identity layer on top of the OAuth 2.0 protocol. It allows Clients to verify the identity of the End-User based on the authentication performed by an Authorization Server, as well as to obtain basic profile information about the End-User in an interoperable and REST-like manner.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>If you are new to OpenID Connect, we recommend watching <a href="https://www.youtube.com/watch?v=996OiexHze0">OAuth 2.0 and OpenID Connect</a> to get a better understanding.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use OpenID client flows, the <code>security-jwt</code> dependency must be in your build because OpenID relies on JWT tokens.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-security-jwt")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-security-jwt&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Even though OpenID providers return JWT tokens, that token is not used directly to authorize requests with Micronaut by default. Instead a new token is created if the application is using JWT. This allows for authorization to be standardized across custom authentication providers, normal OAuth 2.0 flows, and OpenID flows. It also allows for purely session based authorization as a result of OpenID authentication. To use the provider token directly, set the authentication mode to <code>idtoken</code>.
</td>
</tr>
</table>
</div>

<h2 id="flows"><a class="anchor" href="#flows"></a>18.3 Flows</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="authorization-code"><a class="anchor" href="#authorization-code"></a>18.3.1 Authorization Code</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The authorization code grant flow is the most typical authentication flow with OAuth 2.0 and OpenID providers. The same main steps apply to the flow whether or not the provider supports OpenID, and is described in <a href="https://tools.ietf.org/html/rfc6749#section-4.1">RFC6749 - Authorization Code Grant</a>.</p>
</div>
<div class="paragraph">
<p>The OAuth 2.0 authorization code flow requires a callback endpoint. In addition, a login endpoint is available to trigger the flow. The URIs are configurable.</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthConfigurationProperties.html">OauthConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the OAuth 2.0 support is enabled. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.login-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI template that is used to initiate an OAuth 2.0
 authorization code grant flow. Default value ("/oauth/login{/provider}").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.callback-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI template that OAuth 2.0 providers can use to
 submit an authorization callback request. Default value ("/oauth/callback{/provider}").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.default-provider</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default authentication provider for an OAuth 2.0 authorization code grant flow.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The URI templates for login and callback have a template variable in them <code>{provider}</code>. That variable is used by the route builder to build routes for each provider that is configured. The name <code>provider</code> is special in this context and cannot be changed. The URI may be manipulated however in any way as long as the provider variable is part of the <strong>path</strong> of the URI.</p>
</div>
<div class="paragraph">
<p>For example <code>/oauth/login{?provider}</code> is not a valid configuration because Micronaut does not consider the query segment of a URL when routing requests. The provider variable must be part of the <strong>path</strong>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is possible to designate a default provider. The value of the configuration must match one of the client names. The default provider will have the same uri template, but with <code>null</code> passed as the provider parameter. By default that will result in <code>/oauth/login</code> being redirected to the default provider authentication page.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_oauth_login_and_csrf">OAuth Login and CSRF</h4>
<div class="paragraph">
<p>In order to prevent forced login attacks, you must implement CSRF protection on the oauth login endpoints. Because this library is not in control of the forms where login may originate from, we cannot ensure that CSRF is applied. In addition, there is no sensible defaults with regards to how the token is stored or how it should be retrieved. Implementing CSRF is relatively simple.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When rendering the login form where users can choose to login via OAuth, the server should store a value either in state on the server specific to that user (session), or state on the client (http-only cookies, etc), or some other mechanism.</p>
</li>
<li>
<p>That value gets sent with the response and subsequently included in the request to login with OAuth. The value could be sent as a query parameter, or sent as a cookie, etc.</p>
</li>
<li>
<p>A server filter is written to compare the value in the user specific state and the value sent in the request. If they do not match, the request is rejected.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Here is an example:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.core.async.publisher.Publishers;
import io.micronaut.http.HttpRequest;
import io.micronaut.http.HttpResponse;
import io.micronaut.http.HttpStatus;
import io.micronaut.http.MutableHttpResponse;
import io.micronaut.http.annotation.Filter;
import io.micronaut.http.cookie.Cookie;
import io.micronaut.http.filter.HttpServerFilter;
import io.micronaut.http.filter.ServerFilterChain;
import org.reactivestreams.Publisher;


@Filter(value = {"/oauth/login", "/oauth/login/*"})
public class OAuthCsrfFilter implements HttpServerFilter {

    @Override
    public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        String requestParameter = request.getParameters().get("_csrf");
        String cookieValue = request.getCookies().findCookie("_csrf").map(Cookie::getValue).orElse(null);

        if (cookieValue == null || !cookieValue.equals(requestParameter)) {
            return Publishers.just(HttpResponse.status(HttpStatus.FORBIDDEN));
        }

        return chain.proceed(request);
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.context.annotation.Requires
import io.micronaut.core.async.publisher.Publishers
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher


@Filter(value = ["/oauth/login", "/oauth/login/*"])
class OAuthCsrfFilter implements HttpServerFilter {

    @Override
    public Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; doFilter(HttpRequest&lt;?&gt; request, ServerFilterChain chain) {
        String requestParameter = request.parameters.get("_csrf")
        String cookieValue = request.cookies.findCookie("_csrf").map({c -&gt; c.getValue()}).orElse(null)

        if (cookieValue == null || cookieValue != requestParameter) {
            return Publishers.just(HttpResponse.status(HttpStatus.FORBIDDEN))
        }

        return chain.proceed(request)
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.core.async.publisher.Publishers
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpResponse
import io.micronaut.http.HttpStatus
import io.micronaut.http.MutableHttpResponse
import io.micronaut.http.annotation.Filter
import io.micronaut.http.cookie.Cookie
import io.micronaut.http.filter.HttpServerFilter
import io.micronaut.http.filter.ServerFilterChain
import org.reactivestreams.Publisher


@Filter(value = ["/oauth/login", "/oauth/login/*"])
class OAuthCsrfFilter : HttpServerFilter {

    override fun doFilter(request: HttpRequest&lt;*&gt;, chain: ServerFilterChain): Publisher&lt;MutableHttpResponse&lt;*&gt;&gt; {
        val requestParameter = request.parameters["_csrf"]
        val cookieValue = request.cookies.findCookie("_csrf").map { obj: Cookie -&gt; obj.value }.orElse(null)

        return if (cookieValue == null || cookieValue != requestParameter) {
            Publishers.just(HttpResponse.status&lt;Any&gt;(HttpStatus.FORBIDDEN))
        } else {
            chain.proceed(request)
        }
    }
}</code></pre>
</div>
</div>
</div>

<h2 id="oauth2-authorization-code"><a class="anchor" href="#oauth2-authorization-code"></a>18.3.1.1 OAuth 2.0</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/oauth2-authorization-code.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It&#8217;s possible to configure authorization with an OpenID provider simply with this library because OpenID standardizes how to retrieve user information from the provider. Because a user information endpoint is not part of the OAuth 2.0 specification, it is up to you to provide an implementation to retrieve that information.</p>
</div>
<div class="paragraph">
<p>Here is a high level diagram of how the authorization code grant flow works with an OAuth 2.0 provider.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/standard-oauth.svg" alt="standard oauth">
</div>
</div>

<h2 id="oauth2-configuration"><a class="anchor" href="#oauth2-configuration"></a>18.3.1.1.1 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/oauth2-authorization-code/oauth2-configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The minimum requirements to allow authorization with an OAuth 2.0 provider are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration of the authorization endpoint</p>
</li>
<li>
<p>Configuration of the token endpoint</p>
</li>
<li>
<p>Configuration of the client id and secret</p>
</li>
<li>
<p>An implementation of <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/OauthAuthenticationMapper.html">OauthAuthenticationMapper</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration is quite simple. For example to configure authorization with Github:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.clients.github.client-id=&lt;&lt;my client id&gt;&gt;
micronaut.security.oauth2.clients.github.client-secret=&lt;&lt;my client secret&gt;&gt;
micronaut.security.oauth2.clients.github.scopes[0]=user:email
micronaut.security.oauth2.clients.github.scopes[1]=read:user
micronaut.security.oauth2.clients.github.authorization.url=https://github.com/login/oauth/authorize
micronaut.security.oauth2.clients.github.token.url=https://github.com/login/oauth/access_token
micronaut.security.oauth2.clients.github.token.auth-method=client-secret-post</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    oauth2:
      clients:
        github:
          client-id: &lt;&lt;my client id&gt;&gt;
          client-secret: &lt;&lt;my client secret&gt;&gt;
          scopes:
            - user:email
            - read:user
          authorization:
            url: https://github.com/login/oauth/authorize
          token:
            url: https://github.com/login/oauth/access_token
            auth-method: client-secret-post</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.clients]
        [micronaut.security.oauth2.clients.github]
          client-id="&lt;&lt;my client id&gt;&gt;"
          client-secret="&lt;&lt;my client secret&gt;&gt;"
          scopes=[
            "user:email",
            "read:user"
          ]
          [micronaut.security.oauth2.clients.github.authorization]
            url="https://github.com/login/oauth/authorize"
          [micronaut.security.oauth2.clients.github.token]
            url="https://github.com/login/oauth/access_token"
            auth-method="client-secret-post"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      clients {
        github {
          clientId = "&lt;&lt;my client id&gt;&gt;"
          clientSecret = "&lt;&lt;my client secret&gt;&gt;"
          scopes = ["user:email", "read:user"]
          authorization {
            url = "https://github.com/login/oauth/authorize"
          }
          token {
            url = "https://github.com/login/oauth/access_token"
            authMethod = "client-secret-post"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        clients {
          github {
            client-id = "&lt;&lt;my client id&gt;&gt;"
            client-secret = "&lt;&lt;my client secret&gt;&gt;"
            scopes = ["user:email", "read:user"]
            authorization {
              url = "https://github.com/login/oauth/authorize"
            }
            token {
              url = "https://github.com/login/oauth/access_token"
              auth-method = "client-secret-post"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "clients": {
          "github": {
            "client-id": "&lt;&lt;my client id&gt;&gt;",
            "client-secret": "&lt;&lt;my client secret&gt;&gt;",
            "scopes": ["user:email", "read:user"],
            "authorization": {
              "url": "https://github.com/login/oauth/authorize"
            },
            "token": {
              "url": "https://github.com/login/oauth/access_token",
              "auth-method": "client-secret-post"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a client. The name <code>github</code> is arbitrary</p>
</li>
<li>
<p>Provide values for <code>client-id</code> and <code>client-secret</code></p>
</li>
<li>
<p>Optionally specify desired <code>scopes</code></p>
</li>
<li>
<p>Provide an <code>authorization</code> endpoint URL</p>
</li>
<li>
<p>Additionally, the <code>token</code> endpoint URL and authentication method</p>
</li>
<li>
<p><code>auth-method</code> is one of <a href="../api/io/micronaut/security/oauth2/endpoint/AuthenticationMethod.html">AuthenticationMethod</a>. Choose the one your provider requires.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Authentication methods are not clearly defined in <a href="https://tools.ietf.org/html/rfc6749#section-3.2.1">RFC 6749</a>, however most OAuth 2.0 providers either accept <code>client-secret-basic</code> (basic authentication with id and secret), or <code>client-secret-post</code> (client id and secret are sent in the request body).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To disable a specific client for any given environment, set <code>enabled: false</code> within the client configuration.
</td>
</tr>
</table>
</div>

<h2 id="oauth2-user-details"><a class="anchor" href="#oauth2-user-details"></a>18.3.1.1.2 User Details Mapper</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/oauth2-authorization-code/oauth2-user-details.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Beyond configuration, an implementation of <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/OauthAuthenticationMapper.html">OauthAuthenticationMapper</a> is required by the user to be implemented. The implementation must be qualified by name that matches the name present in the client configuration.</p>
</div>
<div class="paragraph">
<p>The purpose of the user details mapper is to transform the <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/TokenResponse.html">TokenResponse</a> into a <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>. That will entail calling some endpoint the provider exposes to retrieve the user&#8217;s information. Once that information is received, the user details can be populated per your requirements.</p>
</div>
<div class="paragraph">
<p>Common requirements of a user details mapper may be to combine data from the OAuth 2.0 provider with data from a remote database and/or create new user records. The <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a> object stores three basic properties: <code>username</code>, <code>roles</code>, and arbitrary <code>attributes</code>. All data stored in the user details will be retrievable in controllers that accept an <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>.</p>
</div>
<div class="paragraph">
<p>For example, here is how it might be implemented for Github.</p>
</div>
<div class="paragraph">
<p>Create a class to store the response data:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.fasterxml.jackson.databind.PropertyNamingStrategies;
import com.fasterxml.jackson.databind.annotation.JsonNaming;
import io.micronaut.core.annotation.Introspected;

@Introspected
@JsonNaming(PropertyNamingStrategies.SnakeCaseStrategy.class)
public class GithubUser {

    private String login;
    private String name;
    private String email;

    // getters and setters ...
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import com.fasterxml.jackson.databind.PropertyNamingStrategies;
import com.fasterxml.jackson.databind.annotation.JsonNaming
import io.micronaut.core.annotation.Introspected

@Introspected
@JsonNaming(PropertyNamingStrategies.SnakeCaseStrategy.class)
class GithubUser {

    String login
    String name
    String email
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import com.fasterxml.jackson.databind.PropertyNamingStrategies
import com.fasterxml.jackson.databind.annotation.JsonNaming
import io.micronaut.core.annotation.Introspected

@Introspected
@JsonNaming(PropertyNamingStrategies.SnakeCaseStrategy::class)
class GithubUser {

    lateinit var login: String
    var name: String? = null
    var email: String? = null
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create an HTTP client to make the request:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.http.annotation.Get;
import io.micronaut.http.annotation.Header;
import io.micronaut.http.client.annotation.Client;
import org.reactivestreams.Publisher;

@Header(name = "User-Agent", value = "Micronaut")
@Client("https://api.github.com")
public interface GithubApiClient {

    @Get("/user")
    Publisher&lt;GithubUser&gt; getUser(@Header("Authorization") String authorization);
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.http.annotation.Header
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher

@Header(name = "User-Agent", value = "Micronaut")
@Client("https://api.github.com")
interface GithubApiClient {

    @Get("/user")
    Publisher&lt;GithubUser&gt; getUser(@Header("Authorization") String authorization)
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Header
import io.micronaut.http.client.annotation.Client
import org.reactivestreams.Publisher

@Header(name = "User-Agent", value = "Micronaut")
@Client("https://api.github.com")
interface GithubApiClient {

    @Get("/user")
    fun getUser(@Header("Authorization") authorization: String): Publisher&lt;GithubUser&gt;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the user details mapper that pulls it together:</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Requires;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.security.authentication.AuthenticationResponse;
import io.micronaut.security.oauth2.endpoint.authorization.state.State;
import io.micronaut.security.oauth2.endpoint.token.response.OauthAuthenticationMapper;
import io.micronaut.security.oauth2.endpoint.token.response.TokenResponse;
import jakarta.inject.Named;
import jakarta.inject.Singleton;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;

import java.util.Collections;
import java.util.List;

@Named("github") // <b class="conum">(1)</b>
@Singleton
class GithubAuthenticationMapper implements OauthAuthenticationMapper {

    private final GithubApiClient apiClient;

    GithubAuthenticationMapper(GithubApiClient apiClient) { // <b class="conum">(2)</b>
        this.apiClient = apiClient;
    }

    @Override
    public Publisher&lt;AuthenticationResponse&gt; createAuthenticationResponse(TokenResponse tokenResponse, @Nullable State state) { // <b class="conum">(3)</b>
        return Flux.from(apiClient.getUser("token " + tokenResponse.getAccessToken()))
                .map(user -&gt; {
                    List&lt;String&gt; roles = Collections.singletonList("ROLE_GITHUB");
                    return AuthenticationResponse.success(user.getLogin(), roles); // <b class="conum">(4)</b>
                });
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.security.authentication.AuthenticationResponse
import io.micronaut.security.oauth2.endpoint.authorization.state.State
import io.micronaut.security.oauth2.endpoint.token.response.OauthAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.TokenResponse
import jakarta.inject.Named
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Named("github") // <b class="conum">(1)</b>
@Singleton
class GithubAuthenticationMapper implements OauthAuthenticationMapper {

    private final GithubApiClient apiClient

    GithubAuthenticationMapper(GithubApiClient apiClient) { // <b class="conum">(2)</b>
        this.apiClient = apiClient
    }

    @Override
    Publisher&lt;AuthenticationResponse&gt; createAuthenticationResponse(TokenResponse tokenResponse, @Nullable State state) { // <b class="conum">(3)</b>
        Flux.from(apiClient.getUser("token ${tokenResponse.accessToken}"))
            .map({ user -&gt;
                AuthenticationResponse.success(user.login, ["ROLE_GITHUB"]) // <b class="conum">(4)</b>
            })
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Requires
import io.micronaut.security.authentication.AuthenticationResponse
import io.micronaut.security.oauth2.endpoint.authorization.state.State
import io.micronaut.security.oauth2.endpoint.token.response.OauthAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.TokenResponse
import jakarta.inject.Named
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Named("github") // <b class="conum">(1)</b>
@Singleton
internal class GithubAuthenticationMapper(private val apiClient: GithubApiClient) // <b class="conum">(2)</b>
    : OauthAuthenticationMapper {

    override fun createAuthenticationResponse(tokenResponse: TokenResponse, state: State?): Publisher&lt;AuthenticationResponse&gt; { // <b class="conum">(3)</b>
        return Flux.from(apiClient.getUser("token " + tokenResponse.accessToken))
                .map { user -&gt;
                    AuthenticationResponse.success(user.login, listOf("ROLE_GITHUB")) // <b class="conum">(4)</b>
                }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The bean must have a named qualifier that matches the name in configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>How the request is made to retrieve the user information is totally up to you, however in this example we&#8217;re using a declarative client.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The token endpoint response is passed to the method.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The user information is converted to a <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Read the <strong>secure a Micronaut app with <a href="https://guides.micronaut.io/latest/micronaut-oauth2-github.html">Github</a> and <a href="https://guides.micronaut.io/latest/micronaut-oauth2-linkedin.html">LinkedIn</a></strong> guides for examples.
</td>
</tr>
</table>
</div>

<h2 id="openid-authorization-code"><a class="anchor" href="#openid-authorization-code"></a>18.3.1.2 OpenID Connect</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Adding support for authorization code flow with an OpenID provider is extremely easy with Micronaut.</p>
</div>
<div class="paragraph">
<p>Here is a high level diagram of how the authorization code grant flow works with an OpenID provider.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/openid-oauth.svg" alt="openid oauth">
</div>
</div>

<h2 id="openid-configuration"><a class="anchor" href="#openid-configuration"></a>18.3.1.2.1 Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/openid-configuration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The requirements to allow authorization with an OpenID provider are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration of the client id and secret</p>
</li>
<li>
<p>Configuration of the issuer</p>
</li>
</ul>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.clients.okta.client-id=&lt;&lt;my client id&gt;&gt;
micronaut.security.oauth2.clients.okta.client-secret=&lt;&lt;my client secret&gt;&gt;
micronaut.security.oauth2.clients.okta.openid.issuer=&lt;&lt;my openid issuer&gt;&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
    security:
        oauth2:
            clients:
                okta:
                    client-id: &lt;&lt;my client id&gt;&gt;
                    client-secret: &lt;&lt;my client secret&gt;&gt;
                    openid:
                        issuer: &lt;&lt;my openid issuer&gt;&gt;</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.clients]
        [micronaut.security.oauth2.clients.okta]
          client-id="&lt;&lt;my client id&gt;&gt;"
          client-secret="&lt;&lt;my client secret&gt;&gt;"
          [micronaut.security.oauth2.clients.okta.openid]
            issuer="&lt;&lt;my openid issuer&gt;&gt;"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      clients {
        okta {
          clientId = "&lt;&lt;my client id&gt;&gt;"
          clientSecret = "&lt;&lt;my client secret&gt;&gt;"
          openid {
            issuer = "&lt;&lt;my openid issuer&gt;&gt;"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        clients {
          okta {
            client-id = "&lt;&lt;my client id&gt;&gt;"
            client-secret = "&lt;&lt;my client secret&gt;&gt;"
            openid {
              issuer = "&lt;&lt;my openid issuer&gt;&gt;"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "clients": {
          "okta": {
            "client-id": "&lt;&lt;my client id&gt;&gt;",
            "client-secret": "&lt;&lt;my client secret&gt;&gt;",
            "openid": {
              "issuer": "&lt;&lt;my openid issuer&gt;&gt;"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure a client. The name <code>okta</code> is arbitrary</p>
</li>
<li>
<p>Provide values for <code>client-id</code> and <code>client-secret</code></p>
</li>
<li>
<p>Specify an OpenID provider issuer url</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The issuer URL will be used to discover the endpoints exposed by the provider.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To disable a specific client for any given environment, set <code>enabled: false</code> within the client configuration.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the following tables for the configuration options:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.issuer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.net.URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL using the https scheme with no query or fragment component that the
 Open ID provider asserts as its issuer identifier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.configuration-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The configuration path to discover openid configuration. Default ("/.well-known/openid-configuration").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.jwks-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The JWKS signature URI.</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$AuthorizationEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$AuthorizationEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.AuthorizationEndpointConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$AuthorizationEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.response-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/ResponseType.html">ResponseType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the authorization processing flow to be used. Default value (code).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.response-mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mechanism to be used for returning authorization response parameters from the
 authorization endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.display</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/Display.html">Display</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls how the authentication interface is displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.prompt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/Prompt.html">Prompt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls how the authentication server prompts the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum authentication age.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.ui-locales</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferred locales for authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.acr-values</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication class reference values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.code-challenge-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code Challenge Method to use for PKCE.</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$TokenEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$TokenEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.TokenEndpointConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$TokenEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.token.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.token.auth-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/AuthenticationMethod.html">AuthenticationMethod</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.token.authentication-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.token.content-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/http/MediaType.html">MediaType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The content type of token endpoint requests. Default value (application/x-www-form-urlencoded).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$EndSessionConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$EndSessionConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.EndSessionConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$EndSessionConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.end-session.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.end-session.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The end session enabled flag. Default value (true).</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$RegistrationEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$RegistrationEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.RegistrationEndpointConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$RegistrationEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.registration.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$UserInfoEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$UserInfoEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.UserInfoEndpointConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$UserInfoEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.user-info.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
</tbody>
</table>

<h2 id="openid-user-details"><a class="anchor" href="#openid-user-details"></a>18.3.1.2.2 OAuth 2.0 Authentication Mapper</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/openid-user-details.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Because the OpenID standard returns a JWT token in the token response, it is possible to retrieve information about the user without having to make an additional call. In addition, the data stored in the JWT is standardized so you can use the same code to retrieve that information across providers.</p>
</div>
<div class="paragraph">
<p>A default implementation of <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/OpenIdAuthenticationMapper.html">OpenIdAuthenticationMapper</a> has been provided for you to map the JWT token to a <a href="../api/io/micronaut/security/authentication/Authentication.html">Authentication</a>. The default implementation will carry over any of the specific OpenID JWT claims, as well as potentially include other claims based on configuration. The original provider name will always be included in the JWT with the claim key "oauth2Provider". The following table explains the additional claims.</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthConfigurationProperties$OpenIdConfigurationProperties$AdditionalClaimsConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthConfigurationProperties$OpenIdConfigurationProperties$AdditionalClaimsConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthConfigurationProperties.OpenIdConfigurationProperties.AdditionalClaimsConfigurationProperties.html">OauthConfigurationProperties$OpenIdConfigurationProperties$AdditionalClaimsConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.additional-claims.jwt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true if the original JWT from the provider should be included in the Micronaut JWT.
 Default value (false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.additional-claims.access-token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true if the original access token from the provider should be included in the Micronaut JWT.
 Default value (false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.additional-claims.refresh-token</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to true if the original refresh token from the provider should be included in the Micronaut JWT.
 Default value (false).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Enabling all of the above with cookie JWT storage has been known to cause issues with Keycloak due to their tokens being very large and causing the resulting cookie to be larger than what browsers allow.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the default implementation is not sufficient, it is possible to override the global default or provide an implementation specific to a provider.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You cannot use <code>micronaut.security.authentication</code> = <code>idtoken</code>, if you wish to use a custom <code>OpenIdAuthenticationMapper</code>. You should use  <code>micronaut.security.authentication</code> = <code>cookie</code> or provide your own implementation of <a href="#loginHandler">Login Handler</a> and <a href="#logoutHandler">Logout Handler</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To override the global default mapper, register a bean that replaces <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/DefaultOpenIdAuthenticationMapper.html">DefaultOpenIdAuthenticationMapper</a>.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.context.annotation.Replaces;
import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.security.authentication.AuthenticationResponse;
import io.micronaut.security.oauth2.endpoint.authorization.state.State;
import io.micronaut.security.oauth2.endpoint.token.response.DefaultOpenIdAuthenticationMapper;
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper;
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdClaims;
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdTokenResponse;
import jakarta.inject.Singleton;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;

@Singleton
@Replaces(DefaultOpenIdAuthenticationMapper.class)
public class GlobalOpenIdAuthenticationMapper implements OpenIdAuthenticationMapper {

    @Override
    @NonNull
    public Publisher&lt;AuthenticationResponse&gt; createAuthenticationResponse(String providerName, OpenIdTokenResponse tokenResponse, OpenIdClaims openIdClaims, @Nullable State state) {
        return Flux.just(AuthenticationResponse.success("name"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.security.authentication.AuthenticationResponse
import io.micronaut.security.oauth2.endpoint.authorization.state.State
import io.micronaut.security.oauth2.endpoint.token.response.DefaultOpenIdAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdClaims
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdTokenResponse
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Singleton
@Replaces(DefaultOpenIdAuthenticationMapper.class)
class GlobalOpenIdAuthenticationMapper implements OpenIdAuthenticationMapper {

    @Override
    @NonNull
    Publisher&lt;AuthenticationResponse&gt; createAuthenticationResponse(String providerName, OpenIdTokenResponse tokenResponse, OpenIdClaims openIdClaims, @Nullable State state) {
        return Flux.just(AuthenticationResponse.success("name"));
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.context.annotation.Replaces
import io.micronaut.security.authentication.AuthenticationResponse
import io.micronaut.security.oauth2.endpoint.authorization.state.State
import io.micronaut.security.oauth2.endpoint.token.response.DefaultOpenIdAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdClaims
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdTokenResponse
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Singleton
@Replaces(DefaultOpenIdAuthenticationMapper::class)
class GlobalOpenIdAuthenticationMapper : OpenIdAuthenticationMapper {

    override fun createAuthenticationResponse(providerName: String, tokenResponse: OpenIdTokenResponse, openIdClaims: OpenIdClaims, state: State?): Publisher&lt;AuthenticationResponse&gt; {
        return Flux.just(AuthenticationResponse.success("name"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To override the user detail mapping behavior for a specific provider, register a bean with a named qualifier with a value equal to the name specified in the client configuration.</p>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.micronaut.core.annotation.NonNull;
import io.micronaut.core.annotation.Nullable;
import io.micronaut.security.authentication.AuthenticationResponse;
import io.micronaut.security.oauth2.endpoint.authorization.state.State;
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper;
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdClaims;
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdTokenResponse;
import jakarta.inject.Named;
import jakarta.inject.Singleton;
import org.reactivestreams.Publisher;
import reactor.core.publisher.Flux;

@Singleton
@Named("okta") // <b class="conum">(1)</b>
public class OktaAuthenticationMapper implements OpenIdAuthenticationMapper {

    @Override
    @NonNull
    public Publisher&lt;AuthenticationResponse&gt; createAuthenticationResponse(String providerName, // <b class="conum">(2)</b>
                                                                          OpenIdTokenResponse tokenResponse, // <b class="conum">(3)</b>
                                                                          OpenIdClaims openIdClaims, // <b class="conum">(4)</b>
                                                                          @Nullable State state) { // <b class="conum">(5)</b>
        return Flux.just(AuthenticationResponse.success("name")); // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdClaims
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdTokenResponse
import jakarta.inject.Named
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Singleton
@Named("okta") // <b class="conum">(1)</b>
class OktaAuthenticationMapper implements OpenIdAuthenticationMapper {

    @Override
    @NonNull
    Publisher&lt;AuthenticationResponse&gt; createAuthenticationResponse(String providerName, // <b class="conum">(2)</b>
                                                                   OpenIdTokenResponse tokenResponse, // <b class="conum">(3)</b>
                                                                   OpenIdClaims openIdClaims, // <b class="conum">(4)</b>
                                                                   @Nullable State state) { // <b class="conum">(5)</b>
        Flux.just(AuthenticationResponse.success("name")); // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="kotlin">import io.micronaut.security.authentication.AuthenticationResponse
import io.micronaut.security.oauth2.endpoint.authorization.state.State
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdAuthenticationMapper
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdClaims
import io.micronaut.security.oauth2.endpoint.token.response.OpenIdTokenResponse
import jakarta.inject.Named
import jakarta.inject.Singleton
import org.reactivestreams.Publisher
import reactor.core.publisher.Flux

@Singleton
@Named("okta") // <b class="conum">(1)</b>
class OktaAuthenticationMapper : OpenIdAuthenticationMapper {

    override fun createAuthenticationResponse(providerName: String, // <b class="conum">(2)</b>
                                              tokenResponse: OpenIdTokenResponse, // <b class="conum">(3)</b>
                                              openIdClaims: OpenIdClaims, // <b class="conum">(4)</b>
                                              state: State?) // <b class="conum">(5)</b>
            : Publisher&lt;AuthenticationResponse&gt; {
        return Flux.just(AuthenticationResponse.success("name")) // <b class="conum">(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The named qualifier is added that matches the name in configuration</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The provider name is passed to the method. Only useful for the global version</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The full token response is available</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The JWT claims are available</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The state object used during OAuth authentication</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>An instance of <a href="../api/io/micronaut/security/authentication/AuthenticationResponse.html">AuthenticationResponse</a> is returned</td>
</tr>
</table>
</div>

<h2 id="openid-auth-parameters"><a class="anchor" href="#openid-auth-parameters"></a>18.3.1.2.3 Parameters</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/openid-auth-parameters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The OpenID specification for <a href="https://openid.net/specs/openid-connect-core-1_0.html#AuthRequest">authorization requests</a> allows for additional parameters beyond what is included in the OAuth 2.0 specification. Some of those parameters make sense to be provided by a bean and are described in this section. Other parameters are able to be controlled through configuration.</p>
</div>
<div class="paragraph">
<p>Here are the configuration option for authorization request parameters:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$AuthorizationEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$AuthorizationEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.AuthorizationEndpointConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$AuthorizationEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.response-type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/ResponseType.html">ResponseType</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines the authorization processing flow to be used. Default value (code).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.response-mode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mechanism to be used for returning authorization response parameters from the
 authorization endpoint.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.display</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/Display.html">Display</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls how the authentication interface is displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.prompt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/Prompt.html">Prompt</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls how the authentication server prompts the user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Integer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum authentication age.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.ui-locales</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferred locales for authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.acr-values</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication class reference values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.authorization.code-challenge-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code Challenge Method to use for PKCE.</p></td>
</tr>
</tbody>
</table>

<h2 id="nonce"><a class="anchor" href="#nonce"></a>18.3.1.2.3.1 Nonce</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/openid-auth-parameters/nonce.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default, this library will include a <code>nonce</code> parameter as described in the <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken">OpenID Connect</a> specification in authentication requests.</p>
</div>
<div class="paragraph">
<p>Because the validation of the nonce requires the nonce to be stored somewhere temporarily, a <a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/NoncePersistence.html">NoncePersistence</a> bean must be present to retrieve the nonce for validation.</p>
</div>
<div class="paragraph">
<p>Micronaut ships with two implementations of <code>NoncePersistence</code>. One implementation to store it in a HTTP cookie (<a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/cookie/CookieNoncePersistence.html">CookieNoncePersistence</a><code>) and another one to persist it with a HTTP Session (<a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/session/SessionNoncePersistence.html">SessionNoncePersistence</a></code>).</p>
</div>
<div class="paragraph">
<p>You can configure which implementation to use:</p>
</div>
<a id="io.micronaut.security.oauth2.endpoint.nonce.DefaultNonceConfiguration" href="#io.micronaut.security.oauth2.endpoint.nonce.DefaultNonceConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/endpoint/nonce/DefaultNonceConfiguration.html">DefaultNonceConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.persistence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the mechanism to persist the nonce for later retrieval for validation.
 Supported values ("session", "cookie"). Default value ("cookie").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether a nonce parameter will be sent. Default (true).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you use the default implementation, which stores the nonce in a HTTP cookie, you can  configure how the cookie is built. See the following configuration options:</p>
</div>
<a id="io.micronaut.security.oauth2.endpoint.nonce.persistence.cookie.CookieNoncePersistenceConfiguration" href="#io.micronaut.security.oauth2.endpoint.nonce.persistence.cookie.CookieNoncePersistenceConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/cookie/CookieNoncePersistenceConfiguration.html">CookieNoncePersistenceConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the domain name of this Cookie. Default value (null).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-secure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the cookie is secured. Defaults to the secure status of the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cookie Name. Default value <code>{@link #DEFAULT_COOKIENAME}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the path of the cookie. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-http-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the Cookie can only be accessed via HTTP. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.nonce.cookie.cookie-max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum age of the cookie. Default value (5 minutes).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To use (<a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/session/SessionNoncePersistence.html">SessionNoncePersistence</a>`). which stores the nonce in a HTTP session:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a dependency to <code>micronaut-session</code></p>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-session")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-session&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</li>
<li>
<p>Set the nonce persistence to <code>session</code></p>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.nonce.persistence=session</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    oauth2:
      nonce:
        persistence: session</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.nonce]
        persistence="session"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      nonce {
        persistence = "session"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        nonce {
          persistence = "session"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "nonce": {
          "persistence": "session"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can provide your own implementation of <a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/NoncePersistence.html">NoncePersistence</a>
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If nonce validation fails, the user will not be authenticated.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_customization">Customization</h3>
<div class="paragraph">
<p>There are several interfaces that implementations can be provided for to override how the nonce parameter is handled.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responsibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Implementation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/nonce/NonceFactory.html">NonceFactory</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Builds a <code>java.lang.String</code> nonce value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/nonce/DefaultNonceFactory.html">DefaultNonceFactory</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/token/response/validation/OpenIdTokenResponseValidator.html">OpenIdTokenResponseValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates an OpenID token response (including the nonce).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/token/response/validation/DefaultOpenIdTokenResponseValidator.html">DefaultOpenIdTokenResponseValidator</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates the nonce claim in the token response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/token/response/validation/NonceClaimValidator.html">NonceClaimValidator</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/NoncePersistence.html">NoncePersistence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the nonce to be retrieved later to allow validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/nonce/persistence/cookie/CookieNoncePersistence.html">CookieNoncePersistence</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To override the behavior of any of those beans, provide an implementation and replace the default one.</p>
</div>
</div>

<h2 id="login-hint"><a class="anchor" href="#login-hint"></a>18.3.1.2.3.2 Login Hint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/openid-auth-parameters/login-hint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This library does not include an <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken">login hint</a> by default with authorization requests. A <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/LoginHintResolver.html">LoginHintResolver</a> bean can be registered that will be called when the authorization request is being built.</p>
</div>

<h2 id="id-token-hint"><a class="anchor" href="#id-token-hint"></a>18.3.1.2.3.3 ID Token Hint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/openid-auth-parameters/id-token-hint.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This library does not include an <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDToken">ID Token hint</a> by default with authorization requests. A <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/request/IdTokenHintResolver.html">IdTokenHintResolver</a> bean can be registered that will be called when the authorization request is being built.</p>
</div>

<h2 id="token-validation"><a class="anchor" href="#token-validation"></a>18.3.1.2.4 Token Validation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/openid-authorization-code/token-validation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>A <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/validation/OpenIdTokenResponseValidator.html">OpenIdTokenResponseValidator</a> bean is responsible for validating the JWT token. The default implementation follows the guidelines described in the OpenID Connect specification regarding <a href="https://openid.net/specs/openid-connect-core-1_0.html#IDTokenValidation">token validation</a> where possible.</p>
</div>
<div class="paragraph">
<p>By default all implementations of <a href="../api/io/micronaut/security/token/jwt/validator/GenericJwtClaimsValidator.html">GenericJwtClaimsValidator</a> and <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/validation/OpenIdClaimsValidator.html">OpenIdClaimsValidator</a> are used to validate the token.</p>
</div>
<div class="paragraph">
<p>To allow for additional or custom  validations, register an <a href="../api/io/micronaut/security/oauth2/endpoint/token/response/validation/OpenIdClaimsValidator.html">OpenIdClaimsValidator</a> bean.</p>
</div>

<h2 id="state"><a class="anchor" href="#state"></a>18.3.1.3 State Parameter</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/state.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>By default, this library will include a <code>state</code> parameter as described in <a href="https://tools.ietf.org/html/rfc6749#section-4.1.1">RFC 6749</a> to authentication requests. A JSON serialized object is stored that contains a nonce value used for validation.</p>
</div>
<div class="paragraph">
<p>Because the validation of the state requires the state to be stored somewhere temporarily, a <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/persistence/StatePersistence.html">StatePersistence</a> bean must be present to retrieve the state for validation. The default implementation stores the state in an HTTP cookie. To configure how the cookie is built, see the following configuration options:</p>
</div>
<a id="io.micronaut.security.oauth2.endpoint.authorization.state.persistence.cookie.CookieStatePersistenceConfiguration" href="#io.micronaut.security.oauth2.endpoint.authorization.state.persistence.cookie.CookieStatePersistenceConfiguration">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/persistence/cookie/CookieStatePersistenceConfiguration.html">CookieStatePersistenceConfiguration</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.state.cookie.cookie-domain</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the domain name of this Cookie. Default value (null).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.state.cookie.cookie-secure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets whether the cookie is secured. Defaults to the secure status of the request.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.state.cookie.cookie-name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cookie Name. Default value <code>{@link #DEFAULT_COOKIENAME}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.state.cookie.cookie-path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the path of the cookie. Default value ("/").</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.state.cookie.cookie-http-only</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether the Cookie can only be accessed via HTTP. Default value (true).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.state.cookie.cookie-max-age</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the maximum age of the cookie. Default value (5 minutes).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can provide your own implementation, however an implementation of state persistence that stores the state in an http session has also been provided.</p>
</div>
<div class="paragraph">
<p>To enable state persistence with an http session:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a dependency to <code>micronaut-session</code></p>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.security:micronaut-session")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-session&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
</li>
<li>
<p>Set the state persistence to <code>session</code></p>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.state.persistence=session</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut.security.oauth2.state.persistence: session</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">"micronaut.security.oauth2.state.persistence"="session"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut.security.oauth2.state.persistence = "session"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  "micronaut.security.oauth2.state.persistence" = "session"
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut.security.oauth2.state.persistence": "session"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>If state validation fails, the user will not be authenticated.</p>
</div>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_customization">Customization</h3>
<div class="paragraph">
<p>There are several interfaces that implementations can be provided for to override how the state parameter is handled.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Responsibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Implementation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/StateFactory.html">StateFactory</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Builds a <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/State.html">State</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/DefaultStateFactory.html">DefaultStateFactory</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/StateSerDes.html">StateSerDes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serializes and de-serializes the state object for use in the authorization request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/JacksonStateSerDes.html">JacksonStateSerDes</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/validation/StateValidator.html">StateValidator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validates the state received in the authorization response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/validation/DefaultStateValidator.html">DefaultStateValidator</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/persistence/StatePersistence.html">StatePersistence</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stores the state to be retrieved later to allow validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/authorization/state/persistence/cookie/CookieStatePersistence.html">CookieStatePersistence</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To override the behavior of any of those beans, provide an implementation and replace the default one.</p>
</div>
</div>

<h2 id="pkce"><a class="anchor" href="#pkce"></a>18.3.1.4 PKCE</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/authorization-code/pkce.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Using OpenID Connect <a href="#openid-configuration">Discovery</a> by setting <code>micronaut.security.oauth2.clients.*.openid.issuer</code> and the Authorization server specifies via
<code>code_challenge_methods</code> either <code>plain</code>, <code>S256</code>, or both, Micronaut security automatically sends a code challenge in the authorization request as specified in <a href="https://www.rfc-editor.org/rfc/rfc7636">Proof Key for Code Exchange (PKCE) Spec</a>.</p>
</div>
<div class="paragraph">
<p>Using manual OAuth 2.0 Client configuration, you can specify the challenge method supported by setting <code>micronaut.security.oauth2.clients.*.authorization.code-challenge-method</code>.</p>
</div>
<div class="paragraph">
<p>If the built-in implementation does not fulfill your needs, you can  provide a <a href="https://micronaut-projects.github.io/micronaut-core/latest/guide/#replaces">replacement</a> of bean <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/pkce/CodeVerifierGenerator.html">CodeVerifierGenerator</a> or <a href="../api/io/micronaut/security/oauth2/endpoint/authorization/pkce/PkceGenerator.html">PkceGenerator</a>.</p>
</div>

<h2 id="clientcredentials"><a class="anchor" href="#clientcredentials"></a>18.3.2 Client Credentials</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/clientcredentials.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can obtain a bean of type <a href="../api/io/micronaut/security/oauth2/client/clientcredentials/ClientCredentialsClient.html">ClientCredentialsClient</a> to request an access token via a <a href="https://tools.ietf.org/html/rfc6749#section-4.4">Client Credentials Grant</a> for your OAuth 2.0 Clients.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.clients.companyauthserver.client-id=XXX
micronaut.security.oauth2.clients.companyauthserver.client-secret=YYY
micronaut.security.oauth2.clients.companyauthserver.token.url=https://foo.bar/token
micronaut.security.oauth2.clients.companyauthserver.token.auth-method=client_secret_basic
micronaut.security.oauth2.clients.google.client-id=ZZZZ
micronaut.security.oauth2.clients.google.client-secret=PPPP
micronaut.security.oauth2.clients.google.openid.issuer=https://accounts.google.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    oauth2:
      clients:
        companyauthserver:
          client-id: 'XXX'
          client-secret: 'YYY'
          token:
            url: "https://foo.bar/token"
            auth-method: "client_secret_basic"
        google:
          client-id: 'ZZZZ'
          client-secret: 'PPPP'
          openid:
            issuer: https://accounts.google.com</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.clients]
        [micronaut.security.oauth2.clients.companyauthserver]
          client-id="XXX"
          client-secret="YYY"
          [micronaut.security.oauth2.clients.companyauthserver.token]
            url="https://foo.bar/token"
            auth-method="client_secret_basic"
        [micronaut.security.oauth2.clients.google]
          client-id="ZZZZ"
          client-secret="PPPP"
          [micronaut.security.oauth2.clients.google.openid]
            issuer="https://accounts.google.com"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      clients {
        companyauthserver {
          clientId = "XXX"
          clientSecret = "YYY"
          token {
            url = "https://foo.bar/token"
            authMethod = "client_secret_basic"
          }
        }
        google {
          clientId = "ZZZZ"
          clientSecret = "PPPP"
          openid {
            issuer = "https://accounts.google.com"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        clients {
          companyauthserver {
            client-id = "XXX"
            client-secret = "YYY"
            token {
              url = "https://foo.bar/token"
              auth-method = "client_secret_basic"
            }
          }
          google {
            client-id = "ZZZZ"
            client-secret = "PPPP"
            openid {
              issuer = "https://accounts.google.com"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "clients": {
          "companyauthserver": {
            "client-id": "XXX",
            "client-secret": "YYY",
            "token": {
              "url": "https://foo.bar/token",
              "auth-method": "client_secret_basic"
            }
          },
          "google": {
            "client-id": "ZZZZ",
            "client-secret": "PPPP",
            "openid": {
              "issuer": "https://accounts.google.com"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>You can obtain a bean of type <a href="../api/io/micronaut/security/oauth2/client/clientcredentials/ClientCredentialsClient.html">ClientCredentialsClient</a> for any of the OAuth 2.0 clients using a <a href="https://docs.micronaut.io/latest/guide/index.html#qualifiers">Name Qualifier</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public MyClass(@Named("google") ClientCredentialsClient googleClientCredentialclient) {
    ...

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">...
beanContext.getBean(ClientCredentialsClient.class, Qualifiers.byName("companyauthserver"))</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="../api/io/micronaut/security/oauth2/client/clientcredentials/ClientCredentialsClient.html">ClientCredentialsClient</a> caches the token response. If the cached access token is expired, they renew it automatically.</p>
</div>

<h2 id="clientecredentialshttpclient"><a class="anchor" href="#clientecredentialshttpclient"></a>18.3.2.1 HTTP Client Filter for Client Credentials</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/clientcredentials/clientecredentialshttpclient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut Security includes <a href="../api/io/micronaut/security/oauth2/client/clientcredentials/propagation/ClientCredentialsHttpClientFilter.html">ClientCredentialsHttpClientFilter</a>. This <a href="https://docs.micronaut.io/latest/guide/index.html#clientFilter">HTTP Client Filter</a> allows you to automatically include an access token to an outgoing request HTTP Header. It obtains the access token via a Client Credentials request.</p>
</div>
<div class="paragraph">
<p>For example, the next configuration adds an access token to the requests' HTTP Headers done via the HTTP Client <code>inventory</code>. It obtains the access token with a Client Credentials request with the OAuth 2.0 client <code>companyauthserver</code>.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.clients.companyauthserver.client-id=XXX
micronaut.security.oauth2.clients.companyauthserver.client-secret=YYY
micronaut.security.oauth2.clients.companyauthserver.client-credentials.service-id-regex=inventory
micronaut.security.oauth2.clients.companyauthserver.token.url=https://foo.bar/token
micronaut.security.oauth2.clients.companyauthserver.token.auth-method=client_secret_basic</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    oauth2:
      clients:
        companyauthserver:
          client-id: 'XXX'
          client-secret: 'YYY'
          client-credentials:
            service-id-regex: 'inventory'
          token:
            url: "https://foo.bar/token"
            auth-method: client_secret_basic</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.clients]
        [micronaut.security.oauth2.clients.companyauthserver]
          client-id="XXX"
          client-secret="YYY"
          [micronaut.security.oauth2.clients.companyauthserver.client-credentials]
            service-id-regex="inventory"
          [micronaut.security.oauth2.clients.companyauthserver.token]
            url="https://foo.bar/token"
            auth-method="client_secret_basic"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      clients {
        companyauthserver {
          clientId = "XXX"
          clientSecret = "YYY"
          clientCredentials {
            serviceIdRegex = "inventory"
          }
          token {
            url = "https://foo.bar/token"
            authMethod = "client_secret_basic"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        clients {
          companyauthserver {
            client-id = "XXX"
            client-secret = "YYY"
            client-credentials {
              service-id-regex = "inventory"
            }
            token {
              url = "https://foo.bar/token"
              auth-method = "client_secret_basic"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "clients": {
          "companyauthserver": {
            "client-id": "XXX",
            "client-secret": "YYY",
            "client-credentials": {
              "service-id-regex": "inventory"
            },
            "token": {
              "url": "https://foo.bar/token",
              "auth-method": "client_secret_basic"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The following configuration options are available per OAuth 2.0 client:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$ClientCredentialsConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$ClientCredentialsConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.ClientCredentialsConfigurationProperties.html">OauthClientConfigurationProperties$ClientCredentialsConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.client-credentials.service-id-regex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.client-credentials.uri-regex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.client-credentials.advanced-expiration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.time.Duration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds for a token obtained via client credentials grant to be considered expired
                           prior to its expiration date. Default value (30 seconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.client-credentials.scope</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scope to be requested in the client credentials request. Defaults to none.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.client-credentials.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables <a href="../api/io/micronaut/security/oauth2/client/clientcredentials/ClientCredentialsClient.html">ClientCredentialsClient</a>. Default value true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.client-credentials.additional-request-params</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.util.Map</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>

<h2 id="clientCredentialGuides"><a class="anchor" href="#clientCredentialGuides"></a>18.3.2.2 Guides</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/clientcredentials/clientCredentialGuides.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Read the following guides to learn more abut Client Credentials Flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-client-credentials-auth0.html">Client Credentials Flow with Micronaut and Auth0</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-client-credentials-cognito.html">Client Credentials Flow with Micronaut and Amazon Cognito</a></p>
</li>
</ul>
</div>

<h2 id="password"><a class="anchor" href="#password"></a>18.3.3 Password</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/flows/password.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The resource owner password credentials grant is described in <a href="https://tools.ietf.org/html/rfc6749#section-4.3">RFC 6749</a>. In short, credentials are passed directly to the token endpoint and if authentication succeeds, the token endpoint responds with the appropriate token.</p>
</div>
<div class="paragraph">
<p>The process that handles the token response onward is the same for both authorization code and password grants. See the following high level flow diagrams:</p>
</div>
<div class="paragraph">
<p>OAuth 2.0 Provider</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/oauth-password.svg" alt="oauth password">
</div>
</div>
<div class="paragraph">
<p>OpenID Provider</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/openid-password.svg" alt="openid password">
</div>
</div>
<div class="paragraph">
<p>In Micronaut, the password grant is supported by setting the <code>grant-type</code> configuration option in the client configuration. For example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">micronaut.security.oauth2.clients.github.grant-type=password</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">micronaut:
  security:
    oauth2:
      clients:
        github:
          grant-type: password</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[micronaut]
  [micronaut.security]
    [micronaut.security.oauth2]
      [micronaut.security.oauth2.clients]
        [micronaut.security.oauth2.clients.github]
          grant-type="password"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">micronaut {
  security {
    oauth2 {
      clients {
        github {
          grantType = "password"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  micronaut {
    security {
      oauth2 {
        clients {
          github {
            grant-type = "password"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "micronaut": {
    "security": {
      "oauth2": {
        "clients": {
          "github": {
            "grant-type": "password"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This example above is not intended to be a complete configuration reference
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a client is configured for the password grant type, the authorization code endpoints will not be available and instead an <a href="../api/io/micronaut/security/authentication/AuthenticationProvider.html">AuthenticationProvider</a> will be created that will participate in the <a href="#login">normal login flow</a>.</p>
</div>

<h2 id="oauth-endpoints"><a class="anchor" href="#oauth-endpoints"></a>18.4 Endpoints</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/oauth-endpoints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<h2 id="endsession"><a class="anchor" href="#endsession"></a>18.4.1 OpenID End Session</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/oauth-endpoints/endsession.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Part of the OpenID Connect specification includes a draft document titled <a href="https://openid.net/specs/openid-connect-session-1_0.html">Session Management</a>. Because the specification is a draft, some providers have implemented it differently or not at all. See the following diagram for how end session works with default configuration:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/openid-end-session.svg" alt="openid end session">
</div>
</div>
<div class="paragraph">
<p>If any configured OpenID provider supports end session behavior, a route will be registered that responds to <code>/oauth/logout</code> and redirects to the provider to log the user out. A parameter is also sent to the provider that indicates what URL the provider should redirect the user to after logging out. The default URL is <code>/logout</code> which will cause the local authentication to also be cleared and a final redirect issued according to the <a href="../api/io/micronaut/security/handlers/LogoutHandler.html">LogoutHandler</a>.</p>
</div>
<div class="paragraph">
<p>All of the above is configurable through <code>micronaut.security.oauth2.openid</code>:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthConfigurationProperties$OpenIdConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthConfigurationProperties$OpenIdConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthConfigurationProperties.OpenIdConfigurationProperties.html">OauthConfigurationProperties$OpenIdConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.logout-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI used to log out of an OpenID provider. Default value ("/oauth/logout").</p></td>
</tr>
</tbody>
</table>
<a id="io.micronaut.security.oauth2.configuration.OauthConfigurationProperties$OpenIdConfigurationProperties$EndSessionConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthConfigurationProperties$OpenIdConfigurationProperties$EndSessionConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthConfigurationProperties.OpenIdConfigurationProperties.EndSessionConfigurationProperties.html">OauthConfigurationProperties$OpenIdConfigurationProperties$EndSessionConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.openid.end-session.redirect-uri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URI the OpenID provider should redirect to after logging out. Default value ("/logout").</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To enable the usage of the <code>/logout</code> endpoint, see the section on the <a href="#logout">Logout Endpoint</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>get-allowed</code> configuration option must be set to <code>true</code> because the OpenID provider will issue a redirect which is a GET request.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This library supports end session for Auth0, AWS Cognito, and Okta out of the box. The <a href="../api/io/micronaut/security/oauth2/endpoint/endsession/request/EndSessionEndpointResolver.html">EndSessionEndpointResolver</a> is responsible for determining which <a href="../api/io/micronaut/security/oauth2/endpoint/endsession/request/EndSessionEndpoint.html">EndSessionEndpoint</a> will be used for a given provider, if any.</p>
</div>
<div class="paragraph">
<p>Before choosing any of the default providers, the endpoint resolver will first look for an <a href="../api/io/micronaut/security/oauth2/endpoint/endsession/request/EndSessionEndpoint.html">EndSessionEndpoint</a> bean with a named qualifier that matches the name of the client in configuration. If no bean is found then the default endpoints will be matched against the issuer URL.</p>
</div>
<div class="paragraph">
<p>If for example you are using one of the providers that is supported out of the box and you don&#8217;t want the end session support, it is possible to disable it per client.</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$EndSessionConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$EndSessionConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.EndSessionConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$EndSessionConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.end-session.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.end-session.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The end session enabled flag. Default value (true).</p></td>
</tr>
</tbody>
</table>

<h2 id="introspection"><a class="anchor" href="#introspection"></a>18.4.2 Introspection</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/oauth-endpoints/introspection.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is possible to configure the introspection endpoint URL for OAuth 2.0 and OpenID providers, however Micronaut currently does not use this configuration in any way.</p>
</div>
<div class="paragraph">
<p>See the following configuration table:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$IntrospectionEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$IntrospectionEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.IntrospectionEndpointConfigurationProperties.html">OauthClientConfigurationProperties$IntrospectionEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.introspection.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.introspection.auth-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/AuthenticationMethod.html">AuthenticationMethod</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.introspection.authentication-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Method</p></td>
</tr>
</tbody>
</table>

<h2 id="revocation"><a class="anchor" href="#revocation"></a>18.4.3 Revocation</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/oauth-endpoints/revocation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is possible to configure the revocation endpoint URL for OAuth 2.0 and OpenID providers, however Micronaut currently does not use this configuration in any way.</p>
</div>
<div class="paragraph">
<p>See the following configuration table:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$RevocationEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$RevocationEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.RevocationEndpointConfigurationProperties.html">OauthClientConfigurationProperties$RevocationEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.revocation.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.revocation.auth-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../api/io/micronaut/security/oauth2/endpoint/AuthenticationMethod.html">AuthenticationMethod</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.revocation.authentication-method</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication Method</p></td>
</tr>
</tbody>
</table>

<h2 id="user-info"><a class="anchor" href="#user-info"></a>18.4.4 OpenID User Info</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/oauth-endpoints/user-info.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It is possible to configure the user info endpoint URL for OpenID providers, however Micronaut currently does not use this configuration in any way.</p>
</div>
<div class="paragraph">
<p>See the following configuration table:</p>
</div>
<a id="io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$UserInfoEndpointConfigurationProperties" href="#io.micronaut.security.oauth2.configuration.OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$UserInfoEndpointConfigurationProperties">&#128279;</a>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Configuration Properties for <a href="../api/io/micronaut/security/oauth2/configuration/OauthClientConfigurationProperties.OpenIdClientConfigurationProperties.UserInfoEndpointConfigurationProperties.html">OauthClientConfigurationProperties$OpenIdClientConfigurationProperties$UserInfoEndpointConfigurationProperties</a></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>micronaut.security.oauth2.clients.*.openid.user-info.url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">java.lang.String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The endpoint URL</p></td>
</tr>
</tbody>
</table>

<h2 id="custom-client"><a class="anchor" href="#custom-client"></a>18.5 Custom Clients</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/custom-client.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The center of the OAuth 2.0 authorization code grant support is the <a href="../api/io/micronaut/security/oauth2/client/OauthClient.html">OauthClient</a> for standard OAuth 2.0 and <a href="../api/io/micronaut/security/oauth2/client/OpenIdClient.html">OpenIdClient</a> for OpenID. The current implementation builds clients based on configuration. It is possible however to register a custom client and that client will automatically have the routes associated with it to enable the authorization code grant flow.</p>
</div>
<div class="paragraph">
<p>The <a href="../api/io/micronaut/security/oauth2/client/OauthClient.html">OauthClient</a> interface is simple and only requires three methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface OauthClient {

    /**
     * @return The provider name
     */
    String getName();

    /**
     * Responsible for redirecting to the authorization endpoint.
     *
     * @param originating The originating request
     * @return A response publisher
     */
    Publisher&lt;MutableHttpResponse&lt;?&gt;&gt; authorizationRedirect(HttpRequest&lt;?&gt; originating);

    /**
     * Responsible for receiving the authorization callback request and returning
     * an authentication response.
     *
     * @param request The callback request
     * @return The authentication response
     */
    Publisher&lt;AuthenticationResponse&gt; onCallback(HttpRequest&lt;Map&lt;String, Object&gt;&gt; request);

}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>getName</code> method is used to build the URLs used to trigger the client methods</p>
</li>
<li>
<p>The <code>authorizationRedirect</code> method returns a response that redirects to the provider</p>
</li>
<li>
<p>The <code>onCallback</code> method receives a callback authorization response and returns a response including either an authentication failure or the user details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because of how generic this interface is, it is possible to implement authentication for any provider that follows the redirect / redirect back pattern. For example one could implement support for OAuth 1.0a providers (looking at you, twitter).</p>
</div>

<h2 id="oauthGuides"><a class="anchor" href="#oauthGuides"></a>18.6 Guides</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/oauth/oauthGuides.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Read the following guides to learn more abut OAuth:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-auth0.html">Secure a Micronaut application with Auth0</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-cognito.html">Secure a Micronaut application with Cognito</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-github.html">Secure a Micronaut application with Github</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-oidc-google.html">Secure a Micronaut application with Google</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-keycloak.html">Secure a Micronaut application with Keycloak</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-linkedin.html">Secure a Micronaut application with LinkedIn</a></p>
</li>
<li>
<p><a href="https://guides.micronaut.io/latest/micronaut-oauth2-okta.html">Secure a Micronaut application with Okta</a></p>
</li>
</ul>
</div>

<h1 id="aot"><a class="anchor" href="#aot"></a>19 Ahead-of-time optimizations</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/aot.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><a href="https://micronaut-projects.github.io/micronaut-aot/latest/guide/">Micronaut AOT</a> is a framework which implements ahead-of-time (AOT) optimizations for Micronaut application and libraries. Those optimizations consist of computing at build time things which would normally be done at runtime]</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Micronaut Security offers several ahead-of-time optimizations.</p>
</div>

<h2 id="aotConfiguration"><a class="anchor" href="#aotConfiguration"></a>19.1 Micronaut Security AOT Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/aot/aotConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>With <a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/#_configuration">Micronaut Gradle Plugin</a>, you can use <code>aotPlugins</code> configuration to declare additional AOT modules to be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
...
..
//http://github.com/micronaut-projects/micronaut-security/releases
aotPlugins("io.micronaut.security:micronaut-security-aot:3.9.0")
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>for <a href="https://micronaut-projects.github.io/micronaut-maven-plugin/latest/examples/aot.html">Micronaut Maven Plugin</a> you will need to do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;io.micronaut.build&lt;/groupId&gt;
        &lt;artifactId&gt;micronaut-maven-plugin&lt;/artifactId&gt;
        &lt;configuration&gt;
          &lt;aotDependencies&gt;
            &lt;dependency&gt;
              &lt;groupId&gt;io.micronaut.security&lt;/groupId&gt;
              &lt;artifactId&gt;micronaut-security-aot&lt;/artifactId&gt;
              &lt;version&gt;3.9.0&lt;/version&gt;
            &lt;/dependency&gt;
            ...
          &lt;/aotDependencies&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;</code></pre>
</div>
</div>

<h2 id="aotOpenidConfiguration"><a class="anchor" href="#aotOpenidConfiguration"></a>19.2 OpenID Configuration Optimization</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/aot/aotOpenidConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When you use <a href="#oauth">OpenID Connect</a> in a Micronaut application, the application constructs a URL by appending <code>.well-known/openid-configuration</code> to the value you specify for each OAuth 2.0 client via
<code>micronaut.security.oauth2.clients.*.openid.issuer</code>. It visits the URL to fetch OpenID Connect metadata related to the specified authorization server and configure itself.</p>
</div>
<div class="paragraph">
<p>However, this is a network request which may be slow. Moreover, the application will probably need to execute this network request to serve the first request.</p>
</div>
<div class="paragraph">
<p>You can use Micronaut Security ahead-of-time build optimizations to do the request at build-time.</p>
</div>
<div class="paragraph">
<p>To enable this optimization, add
<code>micronaut.security.openid-configuration.enabled=true</code> to <code>aot.properties</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The application uses the configuration present at the authorization server at build time. The configuration may be out-of-date if the authorization server changes the configuration between the build time and the application startup.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Learn about <a href="https://micronaut-projects.github.io/micronaut-maven-plugin/latest/examples/aot.html#configuration">Micronaut Maven Plugin AOT configuration</a> and <a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/#_configuration">Micronaut Gradle Plugin AOT Configuration</a>.</p>
</div>

<h2 id="aotJwks"><a class="anchor" href="#aotJwks"></a>19.3 JWKS Optimization</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/aot/aotJwks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut security supports JWKS (JSON Web Key Sets) either specifying them <a href="#jwks">directly</a> or via the <code>jwks_uri</code> obtained when fetching the OpenID Connect metadata. Micronaut security uses JWKS to validate the signature of tokens issued by another application or an authorization server.</p>
</div>
<div class="paragraph">
<p>Micronaut applications need to make a network request to fetch JWKS.   You can use Micronaut Security ahead-of-time build optimizations to make the request at build-time.</p>
</div>
<div class="paragraph">
<p>To enable this optimization, add
<code>micronaut.security.jwks.enabled.enabled=true</code> to <code>aot.properties</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The application uses the JWKS exposed by the authorization server at build time. The JWKS may be out-of-date if the authorization server changes them between build time and the application startup. You can clear keys with <code>JwksSignature::clear</code> or <code>JwkSetFetcher::clearCache</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Learn about <a href="https://micronaut-projects.github.io/micronaut-maven-plugin/latest/examples/aot.html#configuration">Micronaut Maven Plugin AOT configuration</a> and <a href="https://micronaut-projects.github.io/micronaut-gradle-plugin/latest/#_configuration">Micronaut Gradle Plugin AOT Configuration</a>.</p>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>20 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-security/edit/4.10.x/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-security">https://github.com/micronaut-projects/micronaut-security</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>
